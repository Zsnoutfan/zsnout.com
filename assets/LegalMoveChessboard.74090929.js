import{_ as cn,d as xe,e as ln,l as sn,x as an,o as _e,c as De,w as ne,h as Ae,a as dn,D as un,C as fn,u as pn}from"./index.58aa87e2.js";const hn=["white","black"],te=["a","b","c","d","e","f","g","h"],ce=["1","2","3","4","5","6","7","8"],mn=[...ce].reverse(),le=Array.prototype.concat(...te.map(e=>ce.map(n=>e+n))),y=e=>le[8*e[0]+e[1]],g=e=>[e.charCodeAt(0)-97,e.charCodeAt(1)-49],qe=le.map(g);function gn(e){let n;const o=()=>(n===void 0&&(n=e()),n);return o.clear=()=>{n=void 0},o}const vn=()=>{let e;return{start(){e=performance.now()},cancel(){e=void 0},stop(){if(!e)return 0;const n=performance.now()-e;return e=void 0,n}}},se=e=>e==="white"?"black":"white",I=(e,n)=>{const o=e[0]-n[0],r=e[1]-n[1];return o*o+r*r},oe=(e,n)=>e.role===n.role&&e.color===n.color,F=e=>(n,o)=>[(o?n[0]:7-n[0])*e.width/8,(o?7-n[1]:n[1])*e.height/8],_=(e,n)=>{e.style.transform=`translate(${n[0]}px,${n[1]}px)`},$e=(e,n,o=1)=>{e.style.transform=`translate(${n[0]}px,${n[1]}px) scale(${o})`},ae=(e,n)=>{e.style.visibility=n?"visible":"hidden"},R=e=>{var n;if(e.clientX||e.clientX===0)return[e.clientX,e.clientY];if(!((n=e.targetTouches)===null||n===void 0)&&n[0])return[e.targetTouches[0].clientX,e.targetTouches[0].clientY]},Ke=e=>e.buttons===2||e.button===2,D=(e,n)=>{const o=document.createElement(e);return n&&(o.className=n),o};function Te(e,n,o){const r=g(e);return n||(r[0]=7-r[0],r[1]=7-r[1]),[o.left+o.width*r[0]/8+o.width/16,o.top+o.height*(7-r[1])/8+o.height/16]}function N(e,n){return Math.abs(e-n)}function bn(e){return(n,o,r,i)=>N(n,r)<2&&(e==="white"?i===o+1||o<=1&&i===o+2&&n===r:i===o-1||o>=6&&i===o-2&&n===r)}const Ee=(e,n,o,r)=>{const i=N(e,o),t=N(n,r);return i===1&&t===2||i===2&&t===1},Ne=(e,n,o,r)=>N(e,o)===N(n,r),Re=(e,n,o,r)=>e===o||n===r,Oe=(e,n,o,r)=>Ne(e,n,o,r)||Re(e,n,o,r);function wn(e,n,o){return(r,i,t,c)=>N(r,t)<2&&N(i,c)<2||o&&i===c&&i===(e==="white"?0:7)&&(r===4&&(t===2&&n.includes(0)||t===6&&n.includes(7))||n.includes(t))}function yn(e,n){const o=n==="white"?"1":"8",r=[];for(const[i,t]of e)i[1]===o&&t.color===n&&t.role==="rook"&&r.push(g(i)[0]);return r}function Le(e,n,o){const r=e.get(n);if(!r)return[];const i=g(n),t=r.role,c=t==="pawn"?bn(r.color):t==="knight"?Ee:t==="bishop"?Ne:t==="rook"?Re:t==="queen"?Oe:wn(r.color,yn(e,r.color),o);return qe.filter(l=>(i[0]!==l[0]||i[1]!==l[1])&&c(i[0],i[1],l[0],l[1])).map(y)}function b(e,...n){e&&setTimeout(()=>e(...n),1)}function kn(e){e.orientation=se(e.orientation),e.animation.current=e.draggable.current=e.selected=void 0}function Cn(e,n){for(const[o,r]of n)r?e.pieces.set(o,r):e.pieces.delete(o)}function Pn(e,n){if(e.check=void 0,n===!0&&(n=e.turnColor),n)for(const[o,r]of e.pieces)r.role==="king"&&r.color===n&&(e.check=o)}function Sn(e,n,o,r){T(e),e.premovable.current=[n,o],b(e.premovable.events.set,n,o,r)}function K(e){e.premovable.current&&(e.premovable.current=void 0,b(e.premovable.events.unset))}function Mn(e,n,o){K(e),e.predroppable.current={role:n,key:o},b(e.predroppable.events.set,n,o)}function T(e){const n=e.predroppable;n.current&&(n.current=void 0,b(n.events.unset))}function xn(e,n,o){if(!e.autoCastle)return!1;const r=e.pieces.get(n);if(!r||r.role!=="king")return!1;const i=g(n),t=g(o);if(i[1]!==0&&i[1]!==7||i[1]!==t[1])return!1;i[0]===4&&!e.pieces.has(o)&&(t[0]===6?o=y([7,t[1]]):t[0]===2&&(o=y([0,t[1]])));const c=e.pieces.get(o);return!c||c.color!==r.color||c.role!=="rook"?!1:(e.pieces.delete(n),e.pieces.delete(o),i[0]<t[0]?(e.pieces.set(y([6,t[1]]),r),e.pieces.set(y([5,t[1]]),c)):(e.pieces.set(y([2,t[1]]),r),e.pieces.set(y([3,t[1]]),c)),!0)}function Be(e,n,o){const r=e.pieces.get(n),i=e.pieces.get(o);if(n===o||!r)return!1;const t=i&&i.color!==r.color?i:void 0;return o===e.selected&&k(e),b(e.events.move,n,o,t),xn(e,n,o)||(e.pieces.set(o,r),e.pieces.delete(n)),e.lastMove=[n,o],e.check=void 0,b(e.events.change),t||!0}function de(e,n,o,r){if(e.pieces.has(o))if(r)e.pieces.delete(o);else return!1;return b(e.events.dropNewPiece,n,o),e.pieces.set(o,n),e.lastMove=[o],e.check=void 0,b(e.events.change),e.movable.dests=void 0,e.turnColor=se(e.turnColor),!0}function He(e,n,o){const r=Be(e,n,o);return r&&(e.movable.dests=void 0,e.turnColor=se(e.turnColor),e.animation.current=void 0),r}function We(e,n,o){if(ue(e,n,o)){const r=He(e,n,o);if(r){const i=e.hold.stop();k(e);const t={premove:!1,ctrlKey:e.stats.ctrlKey,holdTime:i};return r!==!0&&(t.captured=r),b(e.movable.events.after,n,o,t),!0}}else if(Dn(e,n,o))return Sn(e,n,o,{ctrlKey:e.stats.ctrlKey}),k(e),!0;return k(e),!1}function ze(e,n,o,r){const i=e.pieces.get(n);i&&(_n(e,n,o)||r)?(e.pieces.delete(n),de(e,i,o,r),b(e.movable.events.afterNewPiece,i.role,o,{premove:!1,predrop:!1})):i&&An(e,n,o)?Mn(e,i.role,o):(K(e),T(e)),e.pieces.delete(n),k(e)}function re(e,n,o){if(b(e.events.select,n),e.selected){if(e.selected===n&&!e.draggable.enabled){k(e),e.hold.cancel();return}else if((e.selectable.enabled||o)&&e.selected!==n&&We(e,e.selected,n)){e.stats.dragged=!1;return}}(Fe(e,n)||fe(e,n))&&(Ie(e,n),e.hold.start())}function Ie(e,n){e.selected=n,fe(e,n)?e.premovable.dests=Le(e.pieces,n,e.premovable.castle):e.premovable.dests=void 0}function k(e){e.selected=void 0,e.premovable.dests=void 0,e.hold.cancel()}function Fe(e,n){const o=e.pieces.get(n);return!!o&&(e.movable.color==="both"||e.movable.color===o.color&&e.turnColor===o.color)}function ue(e,n,o){var r,i;return n!==o&&Fe(e,n)&&(e.movable.free||!!(!((i=(r=e.movable.dests)===null||r===void 0?void 0:r.get(n))===null||i===void 0)&&i.includes(o)))}function _n(e,n,o){const r=e.pieces.get(n);return!!r&&(n===o||!e.pieces.has(o))&&(e.movable.color==="both"||e.movable.color===r.color&&e.turnColor===r.color)}function fe(e,n){const o=e.pieces.get(n);return!!o&&e.premovable.enabled&&e.movable.color===o.color&&e.turnColor!==o.color}function Dn(e,n,o){return n!==o&&fe(e,n)&&Le(e.pieces,n,e.premovable.castle).includes(o)}function An(e,n,o){const r=e.pieces.get(n),i=e.pieces.get(o);return!!r&&(!i||i.color!==e.movable.color)&&e.predroppable.enabled&&(r.role!=="pawn"||o[1]!=="1"&&o[1]!=="8")&&e.movable.color===r.color&&e.turnColor!==r.color}function qn(e,n){const o=e.pieces.get(n);return!!o&&e.draggable.enabled&&(e.movable.color==="both"||e.movable.color===o.color&&(e.turnColor===o.color||e.premovable.enabled))}function $n(e){const n=e.premovable.current;if(!n)return!1;const o=n[0],r=n[1];let i=!1;if(ue(e,o,r)){const t=He(e,o,r);if(t){const c={premove:!0};t!==!0&&(c.captured=t),b(e.movable.events.after,o,r,c),i=!0}}return K(e),i}function Kn(e,n){const o=e.predroppable.current;let r=!1;if(!o)return!1;if(n(o)){const i={role:o.role,color:e.movable.color};de(e,i,o.key)&&(b(e.movable.events.afterNewPiece,o.role,o.key,{premove:!1,predrop:!0}),r=!0)}return T(e),r}function pe(e){K(e),T(e),k(e)}function ge(e){e.movable.color=e.movable.dests=e.animation.current=void 0,pe(e)}function O(e,n,o){let r=Math.floor(8*(e[0]-o.left)/o.width);n||(r=7-r);let i=7-Math.floor(8*(e[1]-o.top)/o.height);return n||(i=7-i),r>=0&&r<8&&i>=0&&i<8?y([r,i]):void 0}function Tn(e,n,o,r){const i=g(e),t=qe.filter(s=>Oe(i[0],i[1],s[0],s[1])||Ee(i[0],i[1],s[0],s[1])),l=t.map(s=>Te(y(s),o,r)).map(s=>I(n,s)),[,d]=l.reduce((s,p,a)=>s[0]<p?s:[p,a],[l[0],0]);return y(t[d])}function w(e){return e.orientation==="white"}const Ve="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR",En={p:"pawn",r:"rook",n:"knight",b:"bishop",q:"queen",k:"king"},Nn={pawn:"p",rook:"r",knight:"n",bishop:"b",queen:"q",king:"k"};function je(e){e==="start"&&(e=Ve);const n=new Map;let o=7,r=0;for(const i of e)switch(i){case" ":case"[":return n;case"/":if(--o,o<0)return n;r=0;break;case"~":{const t=n.get(y([r-1,o]));t&&(t.promoted=!0);break}default:{const t=i.charCodeAt(0);if(t<57)r+=t-48;else{const c=i.toLowerCase();n.set(y([r,o]),{role:En[c],color:i===c?"black":"white"}),++r}}}return n}function Rn(e){return mn.map(n=>te.map(o=>{const r=e.get(o+n);if(r){let i=Nn[r.role];return r.color==="white"&&(i=i.toUpperCase()),r.promoted&&(i+="~"),i}else return"1"}).join("")).join("/").replace(/1{2,}/g,n=>n.length.toString())}function Ze(e,n){n.animation&&(he(e.animation,n.animation),(e.animation.duration||0)<70&&(e.animation.enabled=!1))}function Ue(e,n){var o,r;if(!((o=n.movable)===null||o===void 0)&&o.dests&&(e.movable.dests=void 0),!((r=n.drawable)===null||r===void 0)&&r.autoShapes&&(e.drawable.autoShapes=[]),he(e,n),n.fen&&(e.pieces=je(n.fen),e.drawable.shapes=[]),"check"in n&&Pn(e,n.check||!1),"lastMove"in n&&!n.lastMove?e.lastMove=void 0:n.lastMove&&(e.lastMove=n.lastMove),e.selected&&Ie(e,e.selected),Ze(e,n),!e.movable.rookCastle&&e.movable.dests){const i=e.movable.color==="white"?"1":"8",t="e"+i,c=e.movable.dests.get(t),l=e.pieces.get(t);if(!c||!l||l.role!=="king")return;e.movable.dests.set(t,c.filter(d=>!(d==="a"+i&&c.includes("c"+i))&&!(d==="h"+i&&c.includes("g"+i))))}}function he(e,n){for(const o in n)ve(e[o])&&ve(n[o])?he(e[o],n[o]):e[o]=n[o]}function ve(e){return typeof e=="object"}function E(e,n){return n.animation.enabled?Bn(e,n):q(e,n)}function q(e,n){const o=e(n);return n.dom.redraw(),o}function Q(e,n){return{key:e,pos:g(e),piece:n}}function On(e,n){return n.sort((o,r)=>I(e.pos,o.pos)-I(e.pos,r.pos))[0]}function Ln(e,n){const o=new Map,r=[],i=new Map,t=[],c=[],l=new Map;let d,s,p;for(const[a,h]of e)l.set(a,Q(a,h));for(const a of le)d=n.pieces.get(a),s=l.get(a),d?s?oe(d,s.piece)||(t.push(s),c.push(Q(a,d))):c.push(Q(a,d)):s&&t.push(s);for(const a of c)s=On(a,t.filter(h=>oe(a.piece,h.piece))),s&&(p=[s.pos[0]-a.pos[0],s.pos[1]-a.pos[1]],o.set(a.key,p.concat(p)),r.push(s.key));for(const a of t)r.includes(a.key)||i.set(a.key,a.piece);return{anims:o,fadings:i}}function Ge(e,n){const o=e.animation.current;if(o===void 0){e.dom.destroyed||e.dom.redrawNow();return}const r=1-(n-o.start)*o.frequency;if(r<=0)e.animation.current=void 0,e.dom.redrawNow();else{const i=Hn(r);for(const t of o.plan.anims.values())t[2]=t[0]*i,t[3]=t[1]*i;e.dom.redrawNow(!0),requestAnimationFrame((t=performance.now())=>Ge(e,t))}}function Bn(e,n){const o=new Map(n.pieces),r=e(n),i=Ln(o,n);if(i.anims.size||i.fadings.size){const t=n.animation.current&&n.animation.current.start;n.animation.current={start:performance.now(),frequency:1/n.animation.duration,plan:i},t||Ge(n,performance.now())}else n.dom.redraw();return r}function Hn(e){return e<.5?4*e*e*e:(e-1)*(2*e-2)*(2*e-2)+1}const Wn=["green","red","blue","yellow"];function zn(e,n){if(n.touches&&n.touches.length>1)return;n.stopPropagation(),n.preventDefault(),n.ctrlKey?k(e):pe(e);const o=R(n),r=O(o,w(e),e.dom.bounds());!r||(e.drawable.current={orig:r,pos:o,brush:jn(n),snapToValidMove:e.drawable.defaultSnapToValidMove},Xe(e))}function Xe(e){requestAnimationFrame(()=>{const n=e.drawable.current;if(n){const o=O(n.pos,w(e),e.dom.bounds());o||(n.snapToValidMove=!1);const r=n.snapToValidMove?Tn(n.orig,n.pos,w(e),e.dom.bounds()):o;r!==n.mouseSq&&(n.mouseSq=r,n.dest=r!==n.orig?r:void 0,e.dom.redrawNow()),Xe(e)}})}function In(e,n){e.drawable.current&&(e.drawable.current.pos=R(n))}function Fn(e){const n=e.drawable.current;n&&(n.mouseSq&&Zn(e.drawable,n),Ye(e))}function Ye(e){e.drawable.current&&(e.drawable.current=void 0,e.dom.redraw())}function Vn(e){e.drawable.shapes.length&&(e.drawable.shapes=[],e.dom.redraw(),Qe(e.drawable))}function jn(e){var n;const o=(e.shiftKey||e.ctrlKey)&&Ke(e),r=e.altKey||e.metaKey||((n=e.getModifierState)===null||n===void 0?void 0:n.call(e,"AltGraph"));return Wn[(o?1:0)+(r?2:0)]}function Zn(e,n){const o=i=>i.orig===n.orig&&i.dest===n.dest,r=e.shapes.find(o);r&&(e.shapes=e.shapes.filter(i=>!o(i))),(!r||r.brush!==n.brush)&&e.shapes.push(n),Qe(e)}function Qe(e){e.onChange&&e.onChange(e.shapes)}function Un(e,n){if(!n.isTrusted||n.button!==void 0&&n.button!==0||n.touches&&n.touches.length>1)return;const o=e.dom.bounds(),r=R(n),i=O(r,w(e),o);if(!i)return;const t=e.pieces.get(i),c=e.selected;!c&&e.drawable.enabled&&(e.drawable.eraseOnClick||!t||t.color!==e.turnColor)&&Vn(e),n.cancelable!==!1&&(!n.touches||e.blockTouchScroll||t||c||Gn(e,r))&&n.preventDefault();const l=!!e.premovable.current,d=!!e.predroppable.current;e.stats.ctrlKey=n.ctrlKey,e.selected&&ue(e,e.selected,i)?E(a=>re(a,i),e):re(e,i);const s=e.selected===i,p=en(e,i);if(t&&p&&s&&qn(e,i)){e.draggable.current={orig:i,piece:t,origPos:r,pos:r,started:e.draggable.autoDistance&&e.stats.dragged,element:p,previouslySelected:c,originTarget:n.target,keyHasChanged:!1},p.cgDragging=!0,p.classList.add("dragging");const a=e.dom.elements.ghost;a&&(a.className=`ghost ${t.color} ${t.role}`,_(a,F(o)(g(i),w(e))),ae(a,!0)),me(e)}else l&&K(e),d&&T(e);e.dom.redraw()}function Gn(e,n){const o=w(e),r=e.dom.bounds(),i=Math.pow(r.width/8,2);for(const t of e.pieces.keys()){const c=Te(t,o,r);if(I(c,n)<=i)return!0}return!1}function Xn(e,n,o,r){const i="a0";e.pieces.set(i,n),e.dom.redraw();const t=R(o);e.draggable.current={orig:i,piece:n,origPos:t,pos:t,started:!0,element:()=>en(e,i),originTarget:o.target,newPiece:!0,force:!!r,keyHasChanged:!1},me(e)}function me(e){requestAnimationFrame(()=>{var n;const o=e.draggable.current;if(!o)return;!((n=e.animation.current)===null||n===void 0)&&n.plan.anims.has(o.orig)&&(e.animation.current=void 0);const r=e.pieces.get(o.orig);if(!r||!oe(r,o.piece))U(e);else if(!o.started&&I(o.pos,o.origPos)>=Math.pow(e.draggable.distance,2)&&(o.started=!0),o.started){if(typeof o.element=="function"){const t=o.element();if(!t)return;t.cgDragging=!0,t.classList.add("dragging"),o.element=t}const i=e.dom.bounds();_(o.element,[o.pos[0]-i.left-i.width/16,o.pos[1]-i.top-i.height/16]),o.keyHasChanged||(o.keyHasChanged=o.orig!==O(o.pos,w(e),i))}me(e)})}function Yn(e,n){e.draggable.current&&(!n.touches||n.touches.length<2)&&(e.draggable.current.pos=R(n))}function Qn(e,n){const o=e.draggable.current;if(!o)return;if(n.type==="touchend"&&n.cancelable!==!1&&n.preventDefault(),n.type==="touchend"&&o.originTarget!==n.target&&!o.newPiece){e.draggable.current=void 0;return}K(e),T(e);const r=R(n)||o.pos,i=O(r,w(e),e.dom.bounds());i&&o.started&&o.orig!==i?o.newPiece?ze(e,o.orig,i,o.force):(e.stats.ctrlKey=n.ctrlKey,We(e,o.orig,i)&&(e.stats.dragged=!0)):o.newPiece?e.pieces.delete(o.orig):e.draggable.deleteOnDropOff&&!i&&(e.pieces.delete(o.orig),b(e.events.change)),(o.orig===o.previouslySelected||o.keyHasChanged)&&(o.orig===i||!i)?k(e):e.selectable.enabled||k(e),Je(e),e.draggable.current=void 0,e.dom.redraw()}function U(e){const n=e.draggable.current;n&&(n.newPiece&&e.pieces.delete(n.orig),e.draggable.current=void 0,k(e),Je(e),e.dom.redraw())}function Je(e){const n=e.dom.elements;n.ghost&&ae(n.ghost,!1)}function en(e,n){let o=e.dom.elements.board.firstChild;for(;o;){if(o.cgKey===n&&o.tagName==="PIECE")return o;o=o.nextSibling}}function Jn(e,n){e.exploding={stage:1,keys:n},e.dom.redraw(),setTimeout(()=>{be(e,2),setTimeout(()=>be(e,void 0),120)},120)}function be(e,n){e.exploding&&(n?e.exploding.stage=n:e.exploding=void 0,e.dom.redraw())}function eo(e,n){function o(){kn(e),n()}return{set(r){r.orientation&&r.orientation!==e.orientation&&o(),Ze(e,r),(r.fen?E:q)(i=>Ue(i,r),e)},state:e,getFen:()=>Rn(e.pieces),toggleOrientation:o,setPieces(r){E(i=>Cn(i,r),e)},selectSquare(r,i){r?E(t=>re(t,r,i),e):e.selected&&(k(e),e.dom.redraw())},move(r,i){E(t=>Be(t,r,i),e)},newPiece(r,i){E(t=>de(t,r,i),e)},playPremove(){if(e.premovable.current){if(E($n,e))return!0;e.dom.redraw()}return!1},playPredrop(r){if(e.predroppable.current){const i=Kn(e,r);return e.dom.redraw(),i}return!1},cancelPremove(){q(K,e)},cancelPredrop(){q(T,e)},cancelMove(){q(r=>{pe(r),U(r)},e)},stop(){q(r=>{ge(r),U(r)},e)},explode(r){Jn(e,r)},setAutoShapes(r){q(i=>i.drawable.autoShapes=r,e)},setShapes(r){q(i=>i.drawable.shapes=r,e)},getKeyAtDomPos(r){return O(r,w(e),e.dom.bounds())},redrawAll:n,dragNewPiece(r,i,t){Xn(e,r,i,t)},destroy(){ge(e),e.dom.unbind&&e.dom.unbind(),e.dom.destroyed=!0}}}function no(){return{pieces:je(Ve),orientation:"white",turnColor:"white",coordinates:!0,ranksPosition:"right",autoCastle:!0,viewOnly:!1,disableContextMenu:!1,addPieceZIndex:!1,addDimensionsCssVars:!1,blockTouchScroll:!1,pieceKey:!1,highlight:{lastMove:!0,check:!0},animation:{enabled:!0,duration:200},movable:{free:!0,color:"both",showDests:!0,events:{},rookCastle:!0},premovable:{enabled:!0,showDests:!0,castle:!0,events:{}},predroppable:{enabled:!1,events:{}},draggable:{enabled:!0,distance:3,autoDistance:!0,showGhost:!0,deleteOnDropOff:!1},dropmode:{active:!1},selectable:{enabled:!0},stats:{dragged:!("ontouchstart"in window)},events:{},drawable:{enabled:!0,visible:!0,defaultSnapToValidMove:!0,eraseOnClick:!0,shapes:[],autoShapes:[],brushes:{green:{key:"g",color:"#15781B",opacity:1,lineWidth:10},red:{key:"r",color:"#882020",opacity:1,lineWidth:10},blue:{key:"b",color:"#003088",opacity:1,lineWidth:10},yellow:{key:"y",color:"#e68f00",opacity:1,lineWidth:10},paleBlue:{key:"pb",color:"#003088",opacity:.4,lineWidth:15},paleGreen:{key:"pg",color:"#15781B",opacity:.4,lineWidth:15},paleRed:{key:"pr",color:"#882020",opacity:.4,lineWidth:15},paleGrey:{key:"pgr",color:"#4a4a4a",opacity:.35,lineWidth:15}},prevSvgHash:""},hold:vn()}}function ie(e,n,o){const r=new Map,i=[];for(const l of e)r.set(l.hash,!1);let t=n.firstChild,c;for(;t;)c=t.getAttribute("cgHash"),r.has(c)?r.set(c,!0):i.push(t),t=t.nextSibling;for(const l of i)n.removeChild(l);for(const l of e)r.get(l.hash)||n.appendChild(o(l))}function P(e){return document.createElementNS("http://www.w3.org/2000/svg",e)}function oo(e,n,o){const r=e.drawable,i=r.current,t=i&&i.mouseSq?i:void 0,c=new Map,l=e.dom.bounds(),d=r.autoShapes.filter(u=>!u.piece);for(const u of r.shapes.concat(d).concat(t?[t]:[]))u.dest&&c.set(u.dest,(c.get(u.dest)||0)+1);const s=r.shapes.concat(d).map(u=>({shape:u,current:!1,hash:we(u,c,!1,l)}));t&&s.push({shape:t,current:!0,hash:we(t,c,!0,l)});const p=s.map(u=>u.hash).join(";");if(p===e.drawable.prevSvgHash)return;e.drawable.prevSvgHash=p;const a=n.querySelector("defs"),h=n.querySelector("g"),v=o.querySelector("g");ro(r,s,a),ie(s.filter(u=>!u.shape.customSvg),h,u=>ye(e,u,r.brushes,c,l)),ie(s.filter(u=>u.shape.customSvg),v,u=>ye(e,u,r.brushes,c,l))}function ro(e,n,o){const r=new Map;let i;for(const l of n)l.shape.dest&&(i=e.brushes[l.shape.brush],l.shape.modifiers&&(i=nn(i,l.shape.modifiers)),r.set(i.key,i));const t=new Set;let c=o.firstChild;for(;c;)t.add(c.getAttribute("cgKey")),c=c.nextSibling;for(const[l,d]of r.entries())t.has(l)||o.appendChild(uo(d))}function we({orig:e,dest:n,brush:o,piece:r,modifiers:i,customSvg:t},c,l,d){return[d.width,d.height,l,e,n,o,n&&(c.get(n)||0)>1,r&&io(r),i&&to(i),t&&co(t)].filter(s=>s).join(",")}function io(e){return[e.color,e.role,e.scale].filter(n=>n).join(",")}function to(e){return""+(e.lineWidth||"")}function co(e){let n=0;for(let o=0;o<e.length;o++)n=(n<<5)-n+e.charCodeAt(o)>>>0;return"custom-"+n.toString()}function ye(e,{shape:n,current:o,hash:r},i,t,c){let l;const d=ke(g(n.orig),e.orientation);if(n.customSvg)l=lo(n.customSvg,d,c);else if(n.dest){let s=i[n.brush];n.modifiers&&(s=nn(s,n.modifiers)),l=ao(s,d,ke(g(n.dest),e.orientation),o,(t.get(n.dest)||0)>1,c)}else l=so(i[n.brush],d,o,c);return l.setAttribute("cgHash",r),l}function lo(e,n,o){const[r,i]=G(n,o),t=$(P("g"),{transform:`translate(${r},${i})`}),c=$(P("svg"),{width:1,height:1,viewBox:"0 0 100 100"});return t.appendChild(c),c.innerHTML=e,t}function so(e,n,o,r){const i=G(n,r),t=fo(),c=(r.width+r.height)/(4*Math.max(r.width,r.height));return $(P("circle"),{stroke:e.color,"stroke-width":t[o?0:1],fill:"none",opacity:on(e,o),cx:i[0],cy:i[1],r:c-t[1]/2})}function ao(e,n,o,r,i,t){const c=ho(i&&!r),l=G(n,t),d=G(o,t),s=d[0]-l[0],p=d[1]-l[1],a=Math.atan2(p,s),h=Math.cos(a)*c,v=Math.sin(a)*c;return $(P("line"),{stroke:e.color,"stroke-width":po(e,r),"stroke-linecap":"round","marker-end":"url(#arrowhead-"+e.key+")",opacity:on(e,r),x1:l[0],y1:l[1],x2:d[0]-h,y2:d[1]-v})}function uo(e){const n=$(P("marker"),{id:"arrowhead-"+e.key,orient:"auto",markerWidth:4,markerHeight:8,refX:2.05,refY:2.01});return n.appendChild($(P("path"),{d:"M0,0 V4 L3,2 Z",fill:e.color})),n.setAttribute("cgKey",e.key),n}function $(e,n){for(const o in n)e.setAttribute(o,n[o]);return e}function ke(e,n){return n==="white"?e:[7-e[0],7-e[1]]}function nn(e,n){return{color:e.color,opacity:Math.round(e.opacity*10)/10,lineWidth:Math.round(n.lineWidth||e.lineWidth),key:[e.key,n.lineWidth].filter(o=>o).join("")}}function fo(){return[3/64,4/64]}function po(e,n){return(e.lineWidth||10)*(n?.85:1)/64}function on(e,n){return(e.opacity||1)*(n?.9:1)}function ho(e){return(e?20:10)/64}function G(e,n){const o=Math.min(1,n.width/n.height),r=Math.min(1,n.height/n.width);return[(e[0]-3.5)*o,(3.5-e[1])*r]}function mo(e,n){e.innerHTML="",e.classList.add("cg-wrap");for(const d of hn)e.classList.toggle("orientation-"+d,n.orientation===d);e.classList.toggle("manipulable",!n.viewOnly);const o=D("cg-container");e.appendChild(o);const r=D("cg-board");o.appendChild(r);let i,t,c;if(n.drawable.visible&&(i=$(P("svg"),{class:"cg-shapes",viewBox:"-4 -4 8 8",preserveAspectRatio:"xMidYMid slice"}),i.appendChild(P("defs")),i.appendChild(P("g")),t=$(P("svg"),{class:"cg-custom-svgs",viewBox:"-3.5 -3.5 8 8",preserveAspectRatio:"xMidYMid slice"}),t.appendChild(P("g")),c=D("cg-auto-pieces"),o.appendChild(i),o.appendChild(t),o.appendChild(c)),n.coordinates){const d=n.orientation==="black"?" black":"",s=n.ranksPosition==="left"?" left":"";o.appendChild(Ce(ce,"ranks"+d+s)),o.appendChild(Ce(te,"files"+d))}let l;return n.draggable.showGhost&&(l=D("piece","ghost"),ae(l,!1),o.appendChild(l)),{board:r,container:o,wrap:e,ghost:l,svg:i,customSvg:t,autoPieces:c}}function Ce(e,n){const o=D("coords",n);let r;for(const i of e)r=D("coord"),r.textContent=i,o.appendChild(r);return o}function go(e,n){if(!e.dropmode.active)return;K(e),T(e);const o=e.dropmode.piece;if(o){e.pieces.set("a0",o);const r=R(n),i=r&&O(r,w(e),e.dom.bounds());i&&ze(e,"a0",i)}e.dom.redraw()}function vo(e,n){const o=e.dom.elements.board;if("ResizeObserver"in window&&new ResizeObserver(n).observe(e.dom.elements.wrap),e.viewOnly)return;const r=wo(e);o.addEventListener("touchstart",r,{passive:!1}),o.addEventListener("mousedown",r,{passive:!1}),(e.disableContextMenu||e.drawable.enabled)&&o.addEventListener("contextmenu",i=>i.preventDefault())}function bo(e,n){const o=[];if("ResizeObserver"in window||o.push(W(document.body,"chessground.resize",n)),!e.viewOnly){const r=Pe(e,Yn,In),i=Pe(e,Qn,Fn);for(const c of["touchmove","mousemove"])o.push(W(document,c,r));for(const c of["touchend","mouseup"])o.push(W(document,c,i));const t=()=>e.dom.bounds.clear();o.push(W(document,"scroll",t,{capture:!0,passive:!0})),o.push(W(window,"resize",t,{passive:!0}))}return()=>o.forEach(r=>r())}function W(e,n,o,r){return e.addEventListener(n,o,r),()=>e.removeEventListener(n,o,r)}function wo(e){return n=>{e.draggable.current?U(e):e.drawable.current?Ye(e):n.shiftKey||Ke(n)?e.drawable.enabled&&zn(e,n):e.viewOnly||(e.dropmode.active?go(e,n):Un(e,n))}}function Pe(e,n,o){return r=>{e.drawable.current?e.drawable.enabled&&o(e,r):e.viewOnly||n(e,r)}}function yo(e){const n=w(e),o=F(e.dom.bounds()),r=e.dom.elements.board,i=e.pieces,t=e.animation.current,c=t?t.plan.anims:new Map,l=t?t.plan.fadings:new Map,d=e.draggable.current,s=Co(e),p=new Set,a=new Set,h=new Map,v=new Map;let u,f,V,L,C,B,X,S,Y,j;for(f=r.firstChild;f;){if(u=f.cgKey,rn(f))if(V=i.get(u),C=c.get(u),B=l.get(u),L=f.cgPiece,f.cgDragging&&(!d||d.orig!==u)&&(f.classList.remove("dragging"),_(f,o(g(u),n)),f.cgDragging=!1),!B&&f.cgFading&&(f.cgFading=!1,f.classList.remove("fading")),V){if(C&&f.cgAnimating&&L===z(V)){const m=g(u);m[0]+=C[2],m[1]+=C[3],f.classList.add("anim"),_(f,o(m,n))}else f.cgAnimating&&(f.cgAnimating=!1,f.classList.remove("anim"),_(f,o(g(u),n)),e.addPieceZIndex&&(f.style.zIndex=J(g(u),n)));L===z(V)&&(!B||!f.cgFading)?p.add(u):B&&L===z(B)?(f.classList.add("fading"),f.cgFading=!0):ee(h,L,f)}else ee(h,L,f);else if(tn(f)){const m=f.className;s.get(u)===m?a.add(u):ee(v,m,f)}f=f.nextSibling}for(const[m,H]of s)if(!a.has(m)){Y=v.get(H),j=Y&&Y.pop();const M=o(g(m),n);if(j)j.cgKey=m,_(j,M);else{const x=D("square",H);x.cgKey=m,_(x,M),r.insertBefore(x,r.firstChild)}}for(const[m,H]of i)if(C=c.get(m),!p.has(m))if(X=h.get(z(H)),S=X&&X.pop(),S){S.cgKey=m,S.cgFading&&(S.classList.remove("fading"),S.cgFading=!1);const M=g(m);e.addPieceZIndex&&(S.style.zIndex=J(M,n)),C&&(S.cgAnimating=!0,S.classList.add("anim"),M[0]+=C[2],M[1]+=C[3]),_(S,o(M,n))}else{const M=z(H),x=D("piece",M),Z=g(m);x.cgPiece=M,x.cgKey=m,C&&(x.cgAnimating=!0,Z[0]+=C[2],Z[1]+=C[3]),_(x,o(Z,n)),e.addPieceZIndex&&(x.style.zIndex=J(Z,n)),r.appendChild(x)}for(const m of h.values())Me(e,m);for(const m of v.values())Me(e,m)}function ko(e){const n=w(e),o=F(e.dom.bounds());let r=e.dom.elements.board.firstChild;for(;r;)(rn(r)&&!r.cgAnimating||tn(r))&&_(r,o(g(r.cgKey),n)),r=r.nextSibling}function Se(e){const n=e.dom.elements.wrap.getBoundingClientRect(),o=e.dom.elements.container,r=n.height/n.width,i=Math.floor(n.width*window.devicePixelRatio/8)*8/window.devicePixelRatio,t=i*r;o.style.width=i+"px",o.style.height=t+"px",e.dom.bounds.clear(),e.addDimensionsCssVars&&(document.documentElement.style.setProperty("--cg-width",i+"px"),document.documentElement.style.setProperty("--cg-height",t+"px"))}function rn(e){return e.tagName==="PIECE"}function tn(e){return e.tagName==="SQUARE"}function Me(e,n){for(const o of n)e.dom.elements.board.removeChild(o)}function J(e,n){const r=e[1];return`${n?3+7-r:3+r}`}function z(e){return`${e.color} ${e.role}`}function Co(e){var n;const o=new Map;if(e.lastMove&&e.highlight.lastMove)for(const t of e.lastMove)A(o,t,"last-move");if(e.check&&e.highlight.check&&A(o,e.check,"check"),e.selected&&(A(o,e.selected,"selected"),e.movable.showDests)){const t=(n=e.movable.dests)===null||n===void 0?void 0:n.get(e.selected);if(t)for(const l of t)A(o,l,"move-dest"+(e.pieces.has(l)?" oc":""));const c=e.premovable.dests;if(c)for(const l of c)A(o,l,"premove-dest"+(e.pieces.has(l)?" oc":""))}const r=e.premovable.current;if(r)for(const t of r)A(o,t,"current-premove");else e.predroppable.current&&A(o,e.predroppable.current.key,"current-premove");const i=e.exploding;if(i)for(const t of i.keys)A(o,t,"exploding"+i.stage);return o}function A(e,n,o){const r=e.get(n);r?e.set(n,`${r} ${o}`):e.set(n,o)}function ee(e,n,o){const r=e.get(n);r?r.push(o):e.set(n,[o])}function Po(e,n){const r=e.drawable.autoShapes.filter(i=>i.piece).map(i=>({shape:i,hash:xo(i),current:!1}));ie(r,n,i=>Mo(e,i,e.dom.bounds()))}function So(e){var n;const o=w(e),r=F(e.dom.bounds());let i=(n=e.dom.elements.autoPieces)===null||n===void 0?void 0:n.firstChild;for(;i;)$e(i,r(g(i.cgKey),o),i.cgScale),i=i.nextSibling}function Mo(e,{shape:n,hash:o},r){var i,t,c;const l=n.orig,d=(i=n.piece)===null||i===void 0?void 0:i.role,s=(t=n.piece)===null||t===void 0?void 0:t.color,p=(c=n.piece)===null||c===void 0?void 0:c.scale,a=D("piece",`${d} ${s}`);return a.setAttribute("cgHash",o),a.cgKey=l,a.cgScale=p,$e(a,F(r)(g(l),w(e)),p),a}function xo(e){var n,o,r;return[e.orig,(n=e.piece)===null||n===void 0?void 0:n.role,(o=e.piece)===null||o===void 0?void 0:o.color,(r=e.piece)===null||r===void 0?void 0:r.scale].join(",")}function _o(e,n){const o=no();Ue(o,n||{});function r(){const i="dom"in o?o.dom.unbind:void 0,t=mo(e,o),c=gn(()=>t.board.getBoundingClientRect()),l=p=>{yo(s),t.autoPieces&&Po(s,t.autoPieces),!p&&t.svg&&oo(s,t.svg,t.customSvg)},d=()=>{Se(s),ko(s),t.autoPieces&&So(s)},s=o;return s.dom={elements:t,bounds:c,redraw:Do(l),redrawNow:l,unbind:i},s.drawable.prevSvgHash="",Se(s),l(!1),vo(s,d),i||(s.dom.unbind=bo(s,d)),s.events.insert&&s.events.insert(t),s}return eo(r(),r)}function Do(e){let n=!1;return()=>{n||(n=!0,requestAnimationFrame(()=>{e(),n=!1}))}}const Ao=xe({props:{config:null},emits:["ready"],setup(e,{emit:n}){const{config:o}=e;let r=ln(null);function i(){let{value:t}=r;if(t){let c=t.parentElement;c.removeChild(t);let{width:l,height:d}=c.getBoundingClientRect();t.style.width=Math.min(l,d)+"px",t.style.height=Math.min(l,d)+"px",c.appendChild(t)}}return sn(()=>{if(r.value){i(),window.addEventListener("resize",i);let t=_o(r.value,o);n("ready",t)}}),an(()=>{window.removeEventListener("resize",i)}),(t,c)=>(_e(),De(un,{"explicit-height":"",flexbox:""},{nav:ne(()=>[Ae(t.$slots,"nav",{},void 0,!0)]),default:ne(()=>[dn("div",{ref_key:"boardEl",ref:r,class:"chessboard"},null,512)]),_:3}))}});var qo=cn(Ao,[["__scopeId","data-v-7122605e"]]);const Ko=xe({props:{position:null,orientation:null,destinations:null},emits:["ready","move"],setup(e,{emit:n}){const{position:o,orientation:r="white",destinations:i}=e;async function t(a,h){if(a=="a0"||h=="a0"||!c)return;if(i){let f=c.state.pieces.get(a);f&&(c.state.pieces.delete(a),c.state.pieces.set(h,f)),l.load(`${c.getFen()} ${l.turn()=="w"?"b":"w"} - - 0 1`)}else l.move({from:a,to:h,promotion:"q"},{sloppy:!0});c.set({turnColor:l.turn()==="w"?"white":"black",fen:l.fen(),check:l.in_check(),lastMove:[a,h],movable:{color:l.turn()==="w"?"white":"black",dests:new Map}});let v;n("move",f=>v=f,l,c);let u=await v;u?setTimeout(()=>t(u.from,u.to)):c.set({movable:{dests:s()}})}let c,l=fn(o),d={fen:l.fen().split(" ")[0],orientation:r,premovable:{enabled:!1},turnColor:l.turn()==="w"?"white":"black",movable:{free:!1,color:l.turn()==="w"?"white":"black",dests:new Map,events:{after:t}}};function s(){if(i)return i(l);let a=new Map;for(let h of l.SQUARES){let v=l.moves({square:h,verbose:!0});v.length&&a.set(h,v.map(({to:u})=>u))}return a}async function p(a){c=a,n("ready",c,l);let h;n("move",u=>h=u,l,c);let v=await h;v?setTimeout(()=>t(v.from,v.to)):c.set({turnColor:l.turn()==="w"?"white":"black",check:l.in_check(),movable:{color:l.turn()==="w"?"white":"black",dests:s()}})}return(a,h)=>(_e(),De(qo,{config:pn(d),onReady:p},{nav:ne(()=>[Ae(a.$slots,"nav")]),_:3},8,["config"]))}});export{Ko as _};
