import{_ as Mn,D as Rn}from"./index.79d2d8ae.js";import{d as Qr,f as xn,m as Nn,q as In,o as Wr,c as Hr,w as ir,r as Fr,g as Ln,u as On}from"./vendor.8108f6cd.js";const Dn=["white","black"],ur=["a","b","c","d","e","f","g","h"],sr=["1","2","3","4","5","6","7","8"],Kn=[...sr].reverse(),fr=Array.prototype.concat(...ur.map(e=>sr.map(r=>e+r))),Y=e=>fr[8*e[0]+e[1]],L=e=>[e.charCodeAt(0)-97,e.charCodeAt(1)-49],zr=fr.map(L);function qn(e){let r;const n=()=>(r===void 0&&(r=e()),r);return n.clear=()=>{r=void 0},n}const $n=()=>{let e;return{start(){e=performance.now()},cancel(){e=void 0},stop(){if(!e)return 0;const r=performance.now()-e;return e=void 0,r}}},dr=e=>e==="white"?"black":"white",Ue=(e,r)=>{const n=e[0]-r[0],o=e[1]-r[1];return n*n+o*o},ar=(e,r)=>e.role===r.role&&e.color===r.color,Qe=e=>(r,n)=>[(n?r[0]:7-r[0])*e.width/8,(n?7-r[1]:r[1])*e.height/8],ie=(e,r)=>{e.style.transform=`translate(${r[0]}px,${r[1]}px)`},jr=(e,r,n=1)=>{e.style.transform=`translate(${r[0]}px,${r[1]}px) scale(${n})`},pr=(e,r)=>{e.style.visibility=r?"visible":"hidden"},Ae=e=>{var r;if(e.clientX||e.clientX===0)return[e.clientX,e.clientY];if((r=e.targetTouches)===null||r===void 0?void 0:r[0])return[e.targetTouches[0].clientX,e.targetTouches[0].clientY]},Gr=e=>e.buttons===2||e.button===2,ue=(e,r)=>{const n=document.createElement(e);return r&&(n.className=r),n};function Zr(e,r,n){const o=L(e);return r||(o[0]=7-o[0],o[1]=7-o[1]),[n.left+n.width*o[0]/8+n.width/16,n.top+n.height*(7-o[1])/8+n.height/16]}function Ee(e,r){return Math.abs(e-r)}function Bn(e){return(r,n,o,t)=>Ee(r,o)<2&&(e==="white"?t===n+1||n<=1&&t===n+2&&r===o:t===n-1||n>=6&&t===n-2&&r===o)}const Vr=(e,r,n,o)=>{const t=Ee(e,n),a=Ee(r,o);return t===1&&a===2||t===2&&a===1},Yr=(e,r,n,o)=>Ee(e,n)===Ee(r,o),Xr=(e,r,n,o)=>e===n||r===o,Jr=(e,r,n,o)=>Yr(e,r,n,o)||Xr(e,r,n,o);function Un(e,r,n){return(o,t,a,u)=>Ee(o,a)<2&&Ee(t,u)<2||n&&t===u&&t===(e==="white"?0:7)&&(o===4&&(a===2&&r.includes(0)||a===6&&r.includes(7))||r.includes(a))}function Qn(e,r){const n=r==="white"?"1":"8",o=[];for(const[t,a]of e)t[1]===n&&a.color===r&&a.role==="rook"&&o.push(L(t)[0]);return o}function en(e,r,n){const o=e.get(r);if(!o)return[];const t=L(r),a=o.role,u=a==="pawn"?Bn(o.color):a==="knight"?Vr:a==="bishop"?Yr:a==="rook"?Xr:a==="queen"?Jr:Un(o.color,Qn(e,o.color),n);return zr.filter(p=>(t[0]!==p[0]||t[1]!==p[1])&&u(t[0],t[1],p[0],p[1])).map(Y)}function F(e,...r){e&&setTimeout(()=>e(...r),1)}function Wn(e){e.orientation=dr(e.orientation),e.animation.current=e.draggable.current=e.selected=void 0}function Hn(e,r){for(const[n,o]of r)o?e.pieces.set(n,o):e.pieces.delete(n)}function Fn(e,r){if(e.check=void 0,r===!0&&(r=e.turnColor),r)for(const[n,o]of e.pieces)o.role==="king"&&o.color===r&&(e.check=n)}function zn(e,r,n,o){we(e),e.premovable.current=[r,n],F(e.premovable.events.set,r,n,o)}function be(e){e.premovable.current&&(e.premovable.current=void 0,F(e.premovable.events.unset))}function jn(e,r,n){be(e),e.predroppable.current={role:r,key:n},F(e.predroppable.events.set,r,n)}function we(e){const r=e.predroppable;r.current&&(r.current=void 0,F(r.events.unset))}function Gn(e,r,n){if(!e.autoCastle)return!1;const o=e.pieces.get(r);if(!o||o.role!=="king")return!1;const t=L(r),a=L(n);if(t[1]!==0&&t[1]!==7||t[1]!==a[1])return!1;t[0]===4&&!e.pieces.has(n)&&(a[0]===6?n=Y([7,a[1]]):a[0]===2&&(n=Y([0,a[1]])));const u=e.pieces.get(n);return!u||u.color!==o.color||u.role!=="rook"?!1:(e.pieces.delete(r),e.pieces.delete(n),t[0]<a[0]?(e.pieces.set(Y([6,a[1]]),o),e.pieces.set(Y([5,a[1]]),u)):(e.pieces.set(Y([2,a[1]]),o),e.pieces.set(Y([3,a[1]]),u)),!0)}function rn(e,r,n){const o=e.pieces.get(r),t=e.pieces.get(n);if(r===n||!o)return!1;const a=t&&t.color!==o.color?t:void 0;return n===e.selected&&X(e),F(e.events.move,r,n,a),Gn(e,r,n)||(e.pieces.set(n,o),e.pieces.delete(r)),e.lastMove=[r,n],e.check=void 0,F(e.events.change),a||!0}function vr(e,r,n,o){if(e.pieces.has(n))if(o)e.pieces.delete(n);else return!1;return F(e.events.dropNewPiece,r,n),e.pieces.set(n,r),e.lastMove=[n],e.check=void 0,F(e.events.change),e.movable.dests=void 0,e.turnColor=dr(e.turnColor),!0}function nn(e,r,n){const o=rn(e,r,n);return o&&(e.movable.dests=void 0,e.turnColor=dr(e.turnColor),e.animation.current=void 0),o}function on(e,r,n){if(hr(e,r,n)){const o=nn(e,r,n);if(o){const t=e.hold.stop();X(e);const a={premove:!1,ctrlKey:e.stats.ctrlKey,holdTime:t};return o!==!0&&(a.captured=o),F(e.movable.events.after,r,n,a),!0}}else if(Vn(e,r,n))return zn(e,r,n,{ctrlKey:e.stats.ctrlKey}),X(e),!0;return X(e),!1}function tn(e,r,n,o){const t=e.pieces.get(r);t&&(Zn(e,r,n)||o)?(e.pieces.delete(r),vr(e,t,n,o),F(e.movable.events.afterNewPiece,t.role,n,{premove:!1,predrop:!1})):t&&Yn(e,r,n)?jn(e,t.role,n):(be(e),we(e)),e.pieces.delete(r),X(e)}function lr(e,r,n){if(F(e.events.select,r),e.selected){if(e.selected===r&&!e.draggable.enabled){X(e),e.hold.cancel();return}else if((e.selectable.enabled||n)&&e.selected!==r&&on(e,e.selected,r)){e.stats.dragged=!1;return}}(ln(e,r)||gr(e,r))&&(an(e,r),e.hold.start())}function an(e,r){e.selected=r,gr(e,r)?e.premovable.dests=en(e.pieces,r,e.premovable.castle):e.premovable.dests=void 0}function X(e){e.selected=void 0,e.premovable.dests=void 0,e.hold.cancel()}function ln(e,r){const n=e.pieces.get(r);return!!n&&(e.movable.color==="both"||e.movable.color===n.color&&e.turnColor===n.color)}function hr(e,r,n){var o,t;return r!==n&&ln(e,r)&&(e.movable.free||!!((t=(o=e.movable.dests)===null||o===void 0?void 0:o.get(r))===null||t===void 0?void 0:t.includes(n)))}function Zn(e,r,n){const o=e.pieces.get(r);return!!o&&(r===n||!e.pieces.has(n))&&(e.movable.color==="both"||e.movable.color===o.color&&e.turnColor===o.color)}function gr(e,r){const n=e.pieces.get(r);return!!n&&e.premovable.enabled&&e.movable.color===n.color&&e.turnColor!==n.color}function Vn(e,r,n){return r!==n&&gr(e,r)&&en(e.pieces,r,e.premovable.castle).includes(n)}function Yn(e,r,n){const o=e.pieces.get(r),t=e.pieces.get(n);return!!o&&(!t||t.color!==e.movable.color)&&e.predroppable.enabled&&(o.role!=="pawn"||n[1]!=="1"&&n[1]!=="8")&&e.movable.color===o.color&&e.turnColor!==o.color}function Xn(e,r){const n=e.pieces.get(r);return!!n&&e.draggable.enabled&&(e.movable.color==="both"||e.movable.color===n.color&&(e.turnColor===n.color||e.premovable.enabled))}function Jn(e){const r=e.premovable.current;if(!r)return!1;const n=r[0],o=r[1];let t=!1;if(hr(e,n,o)){const a=nn(e,n,o);if(a){const u={premove:!0};a!==!0&&(u.captured=a),F(e.movable.events.after,n,o,u),t=!0}}return be(e),t}function eo(e,r){const n=e.predroppable.current;let o=!1;if(!n)return!1;if(r(n)){const t={role:n.role,color:e.movable.color};vr(e,t,n.key)&&(F(e.movable.events.afterNewPiece,n.role,n.key,{premove:!1,predrop:!0}),o=!0)}return we(e),o}function mr(e){be(e),we(e),X(e)}function Nr(e){e.movable.color=e.movable.dests=e.animation.current=void 0,mr(e)}function Te(e,r,n){let o=Math.floor(8*(e[0]-n.left)/n.width);r||(o=7-o);let t=7-Math.floor(8*(e[1]-n.top)/n.height);return r||(t=7-t),o>=0&&o<8&&t>=0&&t<8?Y([o,t]):void 0}function ro(e,r,n,o){const t=L(e),a=zr.filter(v=>Jr(t[0],t[1],v[0],v[1])||Vr(t[0],t[1],v[0],v[1])),p=a.map(v=>Zr(Y(v),n,o)).map(v=>Ue(r,v)),[,m]=p.reduce((v,S,g)=>v[0]<S?v:[S,g],[p[0],0]);return Y(a[m])}function z(e){return e.orientation==="white"}const cn="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR",no={p:"pawn",r:"rook",n:"knight",b:"bishop",q:"queen",k:"king"},oo={pawn:"p",rook:"r",knight:"n",bishop:"b",queen:"q",king:"k"};function un(e){e==="start"&&(e=cn);const r=new Map;let n=7,o=0;for(const t of e)switch(t){case" ":case"[":return r;case"/":if(--n,n<0)return r;o=0;break;case"~":{const a=r.get(Y([o-1,n]));a&&(a.promoted=!0);break}default:{const a=t.charCodeAt(0);if(a<57)o+=a-48;else{const u=t.toLowerCase();r.set(Y([o,n]),{role:no[u],color:t===u?"black":"white"}),++o}}}return r}function to(e){return Kn.map(r=>ur.map(n=>{const o=e.get(n+r);if(o){let t=oo[o.role];return o.color==="white"&&(t=t.toUpperCase()),o.promoted&&(t+="~"),t}else return"1"}).join("")).join("/").replace(/1{2,}/g,r=>r.length.toString())}function sn(e,r){r.animation&&(br(e.animation,r.animation),(e.animation.duration||0)<70&&(e.animation.enabled=!1))}function fn(e,r){var n,o;if(((n=r.movable)===null||n===void 0?void 0:n.dests)&&(e.movable.dests=void 0),((o=r.drawable)===null||o===void 0?void 0:o.autoShapes)&&(e.drawable.autoShapes=[]),br(e,r),r.fen&&(e.pieces=un(r.fen),e.drawable.shapes=[]),"check"in r&&Fn(e,r.check||!1),"lastMove"in r&&!r.lastMove?e.lastMove=void 0:r.lastMove&&(e.lastMove=r.lastMove),e.selected&&an(e,e.selected),sn(e,r),!e.movable.rookCastle&&e.movable.dests){const t=e.movable.color==="white"?"1":"8",a="e"+t,u=e.movable.dests.get(a),p=e.pieces.get(a);if(!u||!p||p.role!=="king")return;e.movable.dests.set(a,u.filter(m=>!(m==="a"+t&&u.includes("c"+t))&&!(m==="h"+t&&u.includes("g"+t))))}}function br(e,r){for(const n in r)Ir(e[n])&&Ir(r[n])?br(e[n],r[n]):e[n]=r[n]}function Ir(e){return typeof e=="object"}function Pe(e,r){return r.animation.enabled?lo(e,r):ge(e,r)}function ge(e,r){const n=e(r);return r.dom.redraw(),n}function nr(e,r){return{key:e,pos:L(e),piece:r}}function io(e,r){return r.sort((n,o)=>Ue(e.pos,n.pos)-Ue(e.pos,o.pos))[0]}function ao(e,r){const n=new Map,o=[],t=new Map,a=[],u=[],p=new Map;let m,v,S;for(const[g,R]of e)p.set(g,nr(g,R));for(const g of fr)m=r.pieces.get(g),v=p.get(g),m?v?ar(m,v.piece)||(a.push(v),u.push(nr(g,m))):u.push(nr(g,m)):v&&a.push(v);for(const g of u)v=io(g,a.filter(R=>ar(g.piece,R.piece))),v&&(S=[v.pos[0]-g.pos[0],v.pos[1]-g.pos[1]],n.set(g.key,S.concat(S)),o.push(v.key));for(const g of a)o.includes(g.key)||t.set(g.key,g.piece);return{anims:n,fadings:t}}function dn(e,r){const n=e.animation.current;if(n===void 0){e.dom.destroyed||e.dom.redrawNow();return}const o=1-(r-n.start)*n.frequency;if(o<=0)e.animation.current=void 0,e.dom.redrawNow();else{const t=co(o);for(const a of n.plan.anims.values())a[2]=a[0]*t,a[3]=a[1]*t;e.dom.redrawNow(!0),requestAnimationFrame((a=performance.now())=>dn(e,a))}}function lo(e,r){const n=new Map(r.pieces),o=e(r),t=ao(n,r);if(t.anims.size||t.fadings.size){const a=r.animation.current&&r.animation.current.start;r.animation.current={start:performance.now(),frequency:1/r.animation.duration,plan:t},a||dn(r,performance.now())}else r.dom.redraw();return o}function co(e){return e<.5?4*e*e*e:(e-1)*(2*e-2)*(2*e-2)+1}const uo=["green","red","blue","yellow"];function so(e,r){if(r.touches&&r.touches.length>1)return;r.stopPropagation(),r.preventDefault(),r.ctrlKey?X(e):mr(e);const n=Ae(r),o=Te(n,z(e),e.dom.bounds());!o||(e.drawable.current={orig:o,pos:n,brush:ho(r),snapToValidMove:e.drawable.defaultSnapToValidMove},pn(e))}function pn(e){requestAnimationFrame(()=>{const r=e.drawable.current;if(r){const n=Te(r.pos,z(e),e.dom.bounds());n||(r.snapToValidMove=!1);const o=r.snapToValidMove?ro(r.orig,r.pos,z(e),e.dom.bounds()):n;o!==r.mouseSq&&(r.mouseSq=o,r.dest=o!==r.orig?o:void 0,e.dom.redrawNow()),pn(e)}})}function fo(e,r){e.drawable.current&&(e.drawable.current.pos=Ae(r))}function po(e){const r=e.drawable.current;r&&(r.mouseSq&&go(e.drawable,r),vn(e))}function vn(e){e.drawable.current&&(e.drawable.current=void 0,e.dom.redraw())}function vo(e){e.drawable.shapes.length&&(e.drawable.shapes=[],e.dom.redraw(),hn(e.drawable))}function ho(e){var r;const n=(e.shiftKey||e.ctrlKey)&&Gr(e),o=e.altKey||e.metaKey||((r=e.getModifierState)===null||r===void 0?void 0:r.call(e,"AltGraph"));return uo[(n?1:0)+(o?2:0)]}function go(e,r){const n=t=>t.orig===r.orig&&t.dest===r.dest,o=e.shapes.find(n);o&&(e.shapes=e.shapes.filter(t=>!n(t))),(!o||o.brush!==r.brush)&&e.shapes.push(r),hn(e)}function hn(e){e.onChange&&e.onChange(e.shapes)}function mo(e,r){if(!r.isTrusted||r.button!==void 0&&r.button!==0||r.touches&&r.touches.length>1)return;const n=e.dom.bounds(),o=Ae(r),t=Te(o,z(e),n);if(!t)return;const a=e.pieces.get(t),u=e.selected;!u&&e.drawable.enabled&&(e.drawable.eraseOnClick||!a||a.color!==e.turnColor)&&vo(e),r.cancelable!==!1&&(!r.touches||e.blockTouchScroll||a||u||bo(e,o))&&r.preventDefault();const p=!!e.premovable.current,m=!!e.predroppable.current;e.stats.ctrlKey=r.ctrlKey,e.selected&&hr(e,e.selected,t)?Pe(g=>lr(g,t),e):lr(e,t);const v=e.selected===t,S=mn(e,t);if(a&&S&&v&&Xn(e,t)){e.draggable.current={orig:t,piece:a,origPos:o,pos:o,started:e.draggable.autoDistance&&e.stats.dragged,element:S,previouslySelected:u,originTarget:r.target,keyHasChanged:!1},S.cgDragging=!0,S.classList.add("dragging");const g=e.dom.elements.ghost;g&&(g.className=`ghost ${a.color} ${a.role}`,ie(g,Qe(n)(L(t),z(e))),pr(g,!0)),wr(e)}else p&&be(e),m&&we(e);e.dom.redraw()}function bo(e,r){const n=z(e),o=e.dom.bounds(),t=Math.pow(o.width/8,2);for(const a of e.pieces.keys()){const u=Zr(a,n,o);if(Ue(u,r)<=t)return!0}return!1}function wo(e,r,n,o){const t="a0";e.pieces.set(t,r),e.dom.redraw();const a=Ae(n);e.draggable.current={orig:t,piece:r,origPos:a,pos:a,started:!0,element:()=>mn(e,t),originTarget:n.target,newPiece:!0,force:!!o,keyHasChanged:!1},wr(e)}function wr(e){requestAnimationFrame(()=>{var r;const n=e.draggable.current;if(!n)return;((r=e.animation.current)===null||r===void 0?void 0:r.plan.anims.has(n.orig))&&(e.animation.current=void 0);const o=e.pieces.get(n.orig);if(!o||!ar(o,n.piece))Ge(e);else if(!n.started&&Ue(n.pos,n.origPos)>=Math.pow(e.draggable.distance,2)&&(n.started=!0),n.started){if(typeof n.element=="function"){const a=n.element();if(!a)return;a.cgDragging=!0,a.classList.add("dragging"),n.element=a}const t=e.dom.bounds();ie(n.element,[n.pos[0]-t.left-t.width/16,n.pos[1]-t.top-t.height/16]),n.keyHasChanged||(n.keyHasChanged=n.orig!==Te(n.pos,z(e),t))}wr(e)})}function yo(e,r){e.draggable.current&&(!r.touches||r.touches.length<2)&&(e.draggable.current.pos=Ae(r))}function _o(e,r){const n=e.draggable.current;if(!n)return;if(r.type==="touchend"&&r.cancelable!==!1&&r.preventDefault(),r.type==="touchend"&&n.originTarget!==r.target&&!n.newPiece){e.draggable.current=void 0;return}be(e),we(e);const o=Ae(r)||n.pos,t=Te(o,z(e),e.dom.bounds());t&&n.started&&n.orig!==t?n.newPiece?tn(e,n.orig,t,n.force):(e.stats.ctrlKey=r.ctrlKey,on(e,n.orig,t)&&(e.stats.dragged=!0)):n.newPiece?e.pieces.delete(n.orig):e.draggable.deleteOnDropOff&&!t&&(e.pieces.delete(n.orig),F(e.events.change)),(n.orig===n.previouslySelected||n.keyHasChanged)&&(n.orig===t||!t)?X(e):e.selectable.enabled||X(e),gn(e),e.draggable.current=void 0,e.dom.redraw()}function Ge(e){const r=e.draggable.current;r&&(r.newPiece&&e.pieces.delete(r.orig),e.draggable.current=void 0,X(e),gn(e),e.dom.redraw())}function gn(e){const r=e.dom.elements;r.ghost&&pr(r.ghost,!1)}function mn(e,r){let n=e.dom.elements.board.firstChild;for(;n;){if(n.cgKey===r&&n.tagName==="PIECE")return n;n=n.nextSibling}}function So(e,r){e.exploding={stage:1,keys:r},e.dom.redraw(),setTimeout(()=>{Lr(e,2),setTimeout(()=>Lr(e,void 0),120)},120)}function Lr(e,r){e.exploding&&(r?e.exploding.stage=r:e.exploding=void 0,e.dom.redraw())}function Co(e,r){function n(){Wn(e),r()}return{set(o){o.orientation&&o.orientation!==e.orientation&&n(),sn(e,o),(o.fen?Pe:ge)(t=>fn(t,o),e)},state:e,getFen:()=>to(e.pieces),toggleOrientation:n,setPieces(o){Pe(t=>Hn(t,o),e)},selectSquare(o,t){o?Pe(a=>lr(a,o,t),e):e.selected&&(X(e),e.dom.redraw())},move(o,t){Pe(a=>rn(a,o,t),e)},newPiece(o,t){Pe(a=>vr(a,o,t),e)},playPremove(){if(e.premovable.current){if(Pe(Jn,e))return!0;e.dom.redraw()}return!1},playPredrop(o){if(e.predroppable.current){const t=eo(e,o);return e.dom.redraw(),t}return!1},cancelPremove(){ge(be,e)},cancelPredrop(){ge(we,e)},cancelMove(){ge(o=>{mr(o),Ge(o)},e)},stop(){ge(o=>{Nr(o),Ge(o)},e)},explode(o){So(e,o)},setAutoShapes(o){ge(t=>t.drawable.autoShapes=o,e)},setShapes(o){ge(t=>t.drawable.shapes=o,e)},getKeyAtDomPos(o){return Te(o,z(e),e.dom.bounds())},redrawAll:r,dragNewPiece(o,t,a){wo(e,o,t,a)},destroy(){Nr(e),e.dom.unbind&&e.dom.unbind(),e.dom.destroyed=!0}}}function ko(){return{pieces:un(cn),orientation:"white",turnColor:"white",coordinates:!0,ranksPosition:"right",autoCastle:!0,viewOnly:!1,disableContextMenu:!1,addPieceZIndex:!1,addDimensionsCssVars:!1,blockTouchScroll:!1,pieceKey:!1,highlight:{lastMove:!0,check:!0},animation:{enabled:!0,duration:200},movable:{free:!0,color:"both",showDests:!0,events:{},rookCastle:!0},premovable:{enabled:!0,showDests:!0,castle:!0,events:{}},predroppable:{enabled:!1,events:{}},draggable:{enabled:!0,distance:3,autoDistance:!0,showGhost:!0,deleteOnDropOff:!1},dropmode:{active:!1},selectable:{enabled:!0},stats:{dragged:!("ontouchstart"in window)},events:{},drawable:{enabled:!0,visible:!0,defaultSnapToValidMove:!0,eraseOnClick:!0,shapes:[],autoShapes:[],brushes:{green:{key:"g",color:"#15781B",opacity:1,lineWidth:10},red:{key:"r",color:"#882020",opacity:1,lineWidth:10},blue:{key:"b",color:"#003088",opacity:1,lineWidth:10},yellow:{key:"y",color:"#e68f00",opacity:1,lineWidth:10},paleBlue:{key:"pb",color:"#003088",opacity:.4,lineWidth:15},paleGreen:{key:"pg",color:"#15781B",opacity:.4,lineWidth:15},paleRed:{key:"pr",color:"#882020",opacity:.4,lineWidth:15},paleGrey:{key:"pgr",color:"#4a4a4a",opacity:.35,lineWidth:15}},prevSvgHash:""},hold:$n()}}function cr(e,r,n){const o=new Map,t=[];for(const p of e)o.set(p.hash,!1);let a=r.firstChild,u;for(;a;)u=a.getAttribute("cgHash"),o.has(u)?o.set(u,!0):t.push(a),a=a.nextSibling;for(const p of t)r.removeChild(p);for(const p of e)o.get(p.hash)||r.appendChild(n(p))}function ne(e){return document.createElementNS("http://www.w3.org/2000/svg",e)}function Po(e,r,n){const o=e.drawable,t=o.current,a=t&&t.mouseSq?t:void 0,u=new Map,p=e.dom.bounds(),m=o.autoShapes.filter(E=>!E.piece);for(const E of o.shapes.concat(m).concat(a?[a]:[]))E.dest&&u.set(E.dest,(u.get(E.dest)||0)+1);const v=o.shapes.concat(m).map(E=>({shape:E,current:!1,hash:Or(E,u,!1,p)}));a&&v.push({shape:a,current:!0,hash:Or(a,u,!0,p)});const S=v.map(E=>E.hash).join(";");if(S===e.drawable.prevSvgHash)return;e.drawable.prevSvgHash=S;const g=r.querySelector("defs"),R=r.querySelector("g"),K=n.querySelector("g");Eo(o,v,g),cr(v.filter(E=>!E.shape.customSvg),R,E=>Dr(e,E,o.brushes,u,p)),cr(v.filter(E=>E.shape.customSvg),K,E=>Dr(e,E,o.brushes,u,p))}function Eo(e,r,n){const o=new Map;let t;for(const p of r)p.shape.dest&&(t=e.brushes[p.shape.brush],p.shape.modifiers&&(t=bn(t,p.shape.modifiers)),o.set(t.key,t));const a=new Set;let u=n.firstChild;for(;u;)a.add(u.getAttribute("cgKey")),u=u.nextSibling;for(const[p,m]of o.entries())a.has(p)||n.appendChild(Io(m))}function Or({orig:e,dest:r,brush:n,piece:o,modifiers:t,customSvg:a},u,p,m){return[m.width,m.height,p,e,r,n,r&&(u.get(r)||0)>1,o&&Ao(o),t&&To(t),a&&Mo(a)].filter(v=>v).join(",")}function Ao(e){return[e.color,e.role,e.scale].filter(r=>r).join(",")}function To(e){return""+(e.lineWidth||"")}function Mo(e){let r=0;for(let n=0;n<e.length;n++)r=(r<<5)-r+e.charCodeAt(n)>>>0;return"custom-"+r.toString()}function Dr(e,{shape:r,current:n,hash:o},t,a,u){let p;const m=Kr(L(r.orig),e.orientation);if(r.customSvg)p=Ro(r.customSvg,m,u);else if(r.dest){let v=t[r.brush];r.modifiers&&(v=bn(v,r.modifiers)),p=No(v,m,Kr(L(r.dest),e.orientation),n,(a.get(r.dest)||0)>1,u)}else p=xo(t[r.brush],m,n,u);return p.setAttribute("cgHash",o),p}function Ro(e,r,n){const[o,t]=Ze(r,n),a=me(ne("g"),{transform:`translate(${o},${t})`}),u=me(ne("svg"),{width:1,height:1,viewBox:"0 0 100 100"});return a.appendChild(u),u.innerHTML=e,a}function xo(e,r,n,o){const t=Ze(r,o),a=Lo(),u=(o.width+o.height)/(4*Math.max(o.width,o.height));return me(ne("circle"),{stroke:e.color,"stroke-width":a[n?0:1],fill:"none",opacity:wn(e,n),cx:t[0],cy:t[1],r:u-a[1]/2})}function No(e,r,n,o,t,a){const u=Do(t&&!o),p=Ze(r,a),m=Ze(n,a),v=m[0]-p[0],S=m[1]-p[1],g=Math.atan2(S,v),R=Math.cos(g)*u,K=Math.sin(g)*u;return me(ne("line"),{stroke:e.color,"stroke-width":Oo(e,o),"stroke-linecap":"round","marker-end":"url(#arrowhead-"+e.key+")",opacity:wn(e,o),x1:p[0],y1:p[1],x2:m[0]-R,y2:m[1]-K})}function Io(e){const r=me(ne("marker"),{id:"arrowhead-"+e.key,orient:"auto",markerWidth:4,markerHeight:8,refX:2.05,refY:2.01});return r.appendChild(me(ne("path"),{d:"M0,0 V4 L3,2 Z",fill:e.color})),r.setAttribute("cgKey",e.key),r}function me(e,r){for(const n in r)e.setAttribute(n,r[n]);return e}function Kr(e,r){return r==="white"?e:[7-e[0],7-e[1]]}function bn(e,r){return{color:e.color,opacity:Math.round(e.opacity*10)/10,lineWidth:Math.round(r.lineWidth||e.lineWidth),key:[e.key,r.lineWidth].filter(n=>n).join("")}}function Lo(){return[3/64,4/64]}function Oo(e,r){return(e.lineWidth||10)*(r?.85:1)/64}function wn(e,r){return(e.opacity||1)*(r?.9:1)}function Do(e){return(e?20:10)/64}function Ze(e,r){const n=Math.min(1,r.width/r.height),o=Math.min(1,r.height/r.width);return[(e[0]-3.5)*n,(3.5-e[1])*o]}function Ko(e,r){e.innerHTML="",e.classList.add("cg-wrap");for(const m of Dn)e.classList.toggle("orientation-"+m,r.orientation===m);e.classList.toggle("manipulable",!r.viewOnly);const n=ue("cg-container");e.appendChild(n);const o=ue("cg-board");n.appendChild(o);let t,a,u;if(r.drawable.visible&&(t=me(ne("svg"),{class:"cg-shapes",viewBox:"-4 -4 8 8",preserveAspectRatio:"xMidYMid slice"}),t.appendChild(ne("defs")),t.appendChild(ne("g")),a=me(ne("svg"),{class:"cg-custom-svgs",viewBox:"-3.5 -3.5 8 8",preserveAspectRatio:"xMidYMid slice"}),a.appendChild(ne("g")),u=ue("cg-auto-pieces"),n.appendChild(t),n.appendChild(a),n.appendChild(u)),r.coordinates){const m=r.orientation==="black"?" black":"",v=r.ranksPosition==="left"?" left":"";n.appendChild(qr(sr,"ranks"+m+v)),n.appendChild(qr(ur,"files"+m))}let p;return r.draggable.showGhost&&(p=ue("piece","ghost"),pr(p,!1),n.appendChild(p)),{board:o,container:n,wrap:e,ghost:p,svg:t,customSvg:a,autoPieces:u}}function qr(e,r){const n=ue("coords",r);let o;for(const t of e)o=ue("coord"),o.textContent=t,n.appendChild(o);return n}function qo(e,r){if(!e.dropmode.active)return;be(e),we(e);const n=e.dropmode.piece;if(n){e.pieces.set("a0",n);const o=Ae(r),t=o&&Te(o,z(e),e.dom.bounds());t&&tn(e,"a0",t)}e.dom.redraw()}function $o(e,r){const n=e.dom.elements.board;if("ResizeObserver"in window&&new ResizeObserver(r).observe(e.dom.elements.wrap),e.viewOnly)return;const o=Uo(e);n.addEventListener("touchstart",o,{passive:!1}),n.addEventListener("mousedown",o,{passive:!1}),(e.disableContextMenu||e.drawable.enabled)&&n.addEventListener("contextmenu",t=>t.preventDefault())}function Bo(e,r){const n=[];if("ResizeObserver"in window||n.push($e(document.body,"chessground.resize",r)),!e.viewOnly){const o=$r(e,yo,fo),t=$r(e,_o,po);for(const u of["touchmove","mousemove"])n.push($e(document,u,o));for(const u of["touchend","mouseup"])n.push($e(document,u,t));const a=()=>e.dom.bounds.clear();n.push($e(document,"scroll",a,{capture:!0,passive:!0})),n.push($e(window,"resize",a,{passive:!0}))}return()=>n.forEach(o=>o())}function $e(e,r,n,o){return e.addEventListener(r,n,o),()=>e.removeEventListener(r,n,o)}function Uo(e){return r=>{e.draggable.current?Ge(e):e.drawable.current?vn(e):r.shiftKey||Gr(r)?e.drawable.enabled&&so(e,r):e.viewOnly||(e.dropmode.active?qo(e,r):mo(e,r))}}function $r(e,r,n){return o=>{e.drawable.current?e.drawable.enabled&&n(e,o):e.viewOnly||r(e,o)}}function Qo(e){const r=z(e),n=Qe(e.dom.bounds()),o=e.dom.elements.board,t=e.pieces,a=e.animation.current,u=a?a.plan.anims:new Map,p=a?a.plan.fadings:new Map,m=e.draggable.current,v=Ho(e),S=new Set,g=new Set,R=new Map,K=new Map;let E,P,ye,se,j,_e,Me,b,Ie,Re;for(P=o.firstChild;P;){if(E=P.cgKey,yn(P))if(ye=t.get(E),j=u.get(E),_e=p.get(E),se=P.cgPiece,P.cgDragging&&(!m||m.orig!==E)&&(P.classList.remove("dragging"),ie(P,n(L(E),r)),P.cgDragging=!1),!_e&&P.cgFading&&(P.cgFading=!1,P.classList.remove("fading")),ye){if(j&&P.cgAnimating&&se===Be(ye)){const x=L(E);x[0]+=j[2],x[1]+=j[3],P.classList.add("anim"),ie(P,n(x,r))}else P.cgAnimating&&(P.cgAnimating=!1,P.classList.remove("anim"),ie(P,n(L(E),r)),e.addPieceZIndex&&(P.style.zIndex=or(L(E),r)));se===Be(ye)&&(!_e||!P.cgFading)?S.add(E):_e&&se===Be(_e)?(P.classList.add("fading"),P.cgFading=!0):tr(R,se,P)}else tr(R,se,P);else if(_n(P)){const x=P.className;v.get(E)===x?g.add(E):tr(K,x,P)}P=P.nextSibling}for(const[x,Se]of v)if(!g.has(x)){Ie=K.get(Se),Re=Ie&&Ie.pop();const _=n(L(x),r);if(Re)Re.cgKey=x,ie(Re,_);else{const O=ue("square",Se);O.cgKey=x,ie(O,_),o.insertBefore(O,o.firstChild)}}for(const[x,Se]of t)if(j=u.get(x),!S.has(x))if(Me=R.get(Be(Se)),b=Me&&Me.pop(),b){b.cgKey=x,b.cgFading&&(b.classList.remove("fading"),b.cgFading=!1);const _=L(x);e.addPieceZIndex&&(b.style.zIndex=or(_,r)),j&&(b.cgAnimating=!0,b.classList.add("anim"),_[0]+=j[2],_[1]+=j[3]),ie(b,n(_,r))}else{const _=Be(Se),O=ue("piece",_),h=L(x);O.cgPiece=_,O.cgKey=x,j&&(O.cgAnimating=!0,h[0]+=j[2],h[1]+=j[3]),ie(O,n(h,r)),e.addPieceZIndex&&(O.style.zIndex=or(h,r)),o.appendChild(O)}for(const x of R.values())Ur(e,x);for(const x of K.values())Ur(e,x)}function Wo(e){const r=z(e),n=Qe(e.dom.bounds());let o=e.dom.elements.board.firstChild;for(;o;)(yn(o)&&!o.cgAnimating||_n(o))&&ie(o,n(L(o.cgKey),r)),o=o.nextSibling}function Br(e){const r=e.dom.elements.wrap.getBoundingClientRect(),n=e.dom.elements.container,o=r.height/r.width,t=Math.floor(r.width*window.devicePixelRatio/8)*8/window.devicePixelRatio,a=t*o;n.style.width=t+"px",n.style.height=a+"px",e.dom.bounds.clear(),e.addDimensionsCssVars&&(document.documentElement.style.setProperty("--cg-width",t+"px"),document.documentElement.style.setProperty("--cg-height",a+"px"))}function yn(e){return e.tagName==="PIECE"}function _n(e){return e.tagName==="SQUARE"}function Ur(e,r){for(const n of r)e.dom.elements.board.removeChild(n)}function or(e,r){const o=e[1];return`${r?3+7-o:3+o}`}function Be(e){return`${e.color} ${e.role}`}function Ho(e){var r;const n=new Map;if(e.lastMove&&e.highlight.lastMove)for(const a of e.lastMove)he(n,a,"last-move");if(e.check&&e.highlight.check&&he(n,e.check,"check"),e.selected&&(he(n,e.selected,"selected"),e.movable.showDests)){const a=(r=e.movable.dests)===null||r===void 0?void 0:r.get(e.selected);if(a)for(const p of a)he(n,p,"move-dest"+(e.pieces.has(p)?" oc":""));const u=e.premovable.dests;if(u)for(const p of u)he(n,p,"premove-dest"+(e.pieces.has(p)?" oc":""))}const o=e.premovable.current;if(o)for(const a of o)he(n,a,"current-premove");else e.predroppable.current&&he(n,e.predroppable.current.key,"current-premove");const t=e.exploding;if(t)for(const a of t.keys)he(n,a,"exploding"+t.stage);return n}function he(e,r,n){const o=e.get(r);o?e.set(r,`${o} ${n}`):e.set(r,n)}function tr(e,r,n){const o=e.get(r);o?o.push(n):e.set(r,[n])}function Fo(e,r){const o=e.drawable.autoShapes.filter(t=>t.piece).map(t=>({shape:t,hash:Go(t),current:!1}));cr(o,r,t=>jo(e,t,e.dom.bounds()))}function zo(e){var r;const n=z(e),o=Qe(e.dom.bounds());let t=(r=e.dom.elements.autoPieces)===null||r===void 0?void 0:r.firstChild;for(;t;)jr(t,o(L(t.cgKey),n),t.cgScale),t=t.nextSibling}function jo(e,{shape:r,hash:n},o){var t,a,u;const p=r.orig,m=(t=r.piece)===null||t===void 0?void 0:t.role,v=(a=r.piece)===null||a===void 0?void 0:a.color,S=(u=r.piece)===null||u===void 0?void 0:u.scale,g=ue("piece",`${m} ${v}`);return g.setAttribute("cgHash",n),g.cgKey=p,g.cgScale=S,jr(g,Qe(o)(L(p),z(e)),S),g}function Go(e){var r,n,o;return[e.orig,(r=e.piece)===null||r===void 0?void 0:r.role,(n=e.piece)===null||n===void 0?void 0:n.color,(o=e.piece)===null||o===void 0?void 0:o.scale].join(",")}function Zo(e,r){const n=ko();fn(n,r||{});function o(){const t="dom"in n?n.dom.unbind:void 0,a=Ko(e,n),u=qn(()=>a.board.getBoundingClientRect()),p=S=>{Qo(v),a.autoPieces&&Fo(v,a.autoPieces),!S&&a.svg&&Po(v,a.svg,a.customSvg)},m=()=>{Br(v),Wo(v),a.autoPieces&&zo(v)},v=n;return v.dom={elements:a,bounds:u,redraw:Vo(p),redrawNow:p,unbind:t},v.drawable.prevSvgHash="",Br(v),p(!1),$o(v,m),t||(v.dom.unbind=Bo(v,m)),v.events.insert&&v.events.insert(a),v}return Co(o(),o)}function Vo(e){let r=!1;return()=>{r||(r=!0,requestAnimationFrame(()=>{e(),r=!1}))}}const Yo=Qr({props:{config:null},emits:["ready"],setup(e,{emit:r}){const{config:n}=e;let o=xn(null);function t(){let{value:a}=o;if(a){let u=a.parentElement;u.removeChild(a);let{width:p,height:m}=u.getBoundingClientRect();a.style.width=Math.min(p,m)+"px",a.style.height=Math.min(p,m)+"px",u.appendChild(a)}}return Nn(()=>{if(o.value){t(),window.addEventListener("resize",t);let a=Zo(o.value,n);r("ready",a)}}),In(()=>{window.removeEventListener("resize",t)}),(a,u)=>(Wr(),Hr(Rn,{"explicit-height":"",flexbox:""},{nav:ir(()=>[Fr(a.$slots,"nav",{},void 0,!0)]),default:ir(()=>[Ln("div",{ref_key:"boardEl",ref:o,class:"chessboard"},null,512)]),_:3}))}});var Xo=Mn(Yo,[["__scopeId","data-v-7122605e"]]),Sn={};(function(e){var r=function(n){var o="b",t="w",a=-1,u="p",p="n",m="b",v="r",S="q",g="k",R="pnbrqkPNBRQK",K="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1",E=["1-0","0-1","1/2-1/2","*"],P={b:[16,32,17,15],w:[-16,-32,-17,-15]},ye={n:[-18,-33,-31,-14,18,33,31,14],b:[-17,-15,17,15],r:[-16,1,16,-1],q:[-17,-16,-15,1,17,16,15,-1],k:[-17,-16,-15,1,17,16,15,-1]},se=[20,0,0,0,0,0,0,24,0,0,0,0,0,0,20,0,0,20,0,0,0,0,0,24,0,0,0,0,0,20,0,0,0,0,20,0,0,0,0,24,0,0,0,0,20,0,0,0,0,0,0,20,0,0,0,24,0,0,0,20,0,0,0,0,0,0,0,0,20,0,0,24,0,0,20,0,0,0,0,0,0,0,0,0,0,20,2,24,2,20,0,0,0,0,0,0,0,0,0,0,0,2,53,56,53,2,0,0,0,0,0,0,24,24,24,24,24,24,56,0,56,24,24,24,24,24,24,0,0,0,0,0,0,2,53,56,53,2,0,0,0,0,0,0,0,0,0,0,0,20,2,24,2,20,0,0,0,0,0,0,0,0,0,0,20,0,0,24,0,0,20,0,0,0,0,0,0,0,0,20,0,0,0,24,0,0,0,20,0,0,0,0,0,0,20,0,0,0,0,24,0,0,0,0,20,0,0,0,0,20,0,0,0,0,0,24,0,0,0,0,0,20,0,0,20,0,0,0,0,0,0,24,0,0,0,0,0,0,20],j=[17,0,0,0,0,0,0,16,0,0,0,0,0,0,15,0,0,17,0,0,0,0,0,16,0,0,0,0,0,15,0,0,0,0,17,0,0,0,0,16,0,0,0,0,15,0,0,0,0,0,0,17,0,0,0,16,0,0,0,15,0,0,0,0,0,0,0,0,17,0,0,16,0,0,15,0,0,0,0,0,0,0,0,0,0,17,0,16,0,15,0,0,0,0,0,0,0,0,0,0,0,0,17,16,15,0,0,0,0,0,0,0,1,1,1,1,1,1,1,0,-1,-1,-1,-1,-1,-1,-1,0,0,0,0,0,0,0,-15,-16,-17,0,0,0,0,0,0,0,0,0,0,0,0,-15,0,-16,0,-17,0,0,0,0,0,0,0,0,0,0,-15,0,0,-16,0,0,-17,0,0,0,0,0,0,0,0,-15,0,0,0,-16,0,0,0,-17,0,0,0,0,0,0,-15,0,0,0,0,-16,0,0,0,0,-17,0,0,0,0,-15,0,0,0,0,0,-16,0,0,0,0,0,-17,0,0,-15,0,0,0,0,0,0,-16,0,0,0,0,0,0,-17],_e={p:0,n:1,b:2,r:3,q:4,k:5},Me={NORMAL:"n",CAPTURE:"c",BIG_PAWN:"b",EP_CAPTURE:"e",PROMOTION:"p",KSIDE_CASTLE:"k",QSIDE_CASTLE:"q"},b={NORMAL:1,CAPTURE:2,BIG_PAWN:4,EP_CAPTURE:8,PROMOTION:16,KSIDE_CASTLE:32,QSIDE_CASTLE:64},Ie=7,Re=6,x=1,Se=0,_={a8:0,b8:1,c8:2,d8:3,e8:4,f8:5,g8:6,h8:7,a7:16,b7:17,c7:18,d7:19,e7:20,f7:21,g7:22,h7:23,a6:32,b6:33,c6:34,d6:35,e6:36,f6:37,g6:38,h6:39,a5:48,b5:49,c5:50,d5:51,e5:52,f5:53,g5:54,h5:55,a4:64,b4:65,c4:66,d4:67,e4:68,f4:69,g4:70,h4:71,a3:80,b3:81,c3:82,d3:83,e3:84,f3:85,g3:86,h3:87,a2:96,b2:97,c2:98,d2:99,e2:100,f2:101,g2:102,h2:103,a1:112,b1:113,c1:114,d1:115,e1:116,f1:117,g1:118,h1:119},O={w:[{square:_.a1,flag:b.QSIDE_CASTLE},{square:_.h1,flag:b.KSIDE_CASTLE}],b:[{square:_.a8,flag:b.QSIDE_CASTLE},{square:_.h8,flag:b.KSIDE_CASTLE}]},h=new Array(128),$={w:a,b:a},q=t,I={w:0,b:0},J=a,oe=0,fe=1,ae=[],G={},Q={};Le(typeof n=="undefined"?K:n);function yr(i){typeof i=="undefined"&&(i=!1),h=new Array(128),$={w:a,b:a},q=t,I={w:0,b:0},J=a,oe=0,fe=1,ae=[],i||(G={}),Q={},We(W())}function _r(){for(var i=[],l={},c=function(s){s in Q&&(l[s]=Q[s])};ae.length>0;)i.push(de());for(c(W());i.length>0;)le(i.pop()),c(W());Q=l}function Sr(){Le(K)}function Le(i,l){typeof l=="undefined"&&(l=!1);var c=i.split(/\s+/),s=c[0],f=0;if(!Cr(i).valid)return!1;yr(l);for(var d=0;d<s.length;d++){var w=s.charAt(d);if(w==="/")f+=8;else if(Tn(w))f+=parseInt(w,10);else{var C=w<"a"?t:o;Pr({type:w.toLowerCase(),color:C},Z(f)),f++}}return q=c[1],c[2].indexOf("K")>-1&&(I.w|=b.KSIDE_CASTLE),c[2].indexOf("Q")>-1&&(I.w|=b.QSIDE_CASTLE),c[2].indexOf("k")>-1&&(I.b|=b.KSIDE_CASTLE),c[2].indexOf("q")>-1&&(I.b|=b.QSIDE_CASTLE),J=c[3]==="-"?a:_[c[3]],oe=parseInt(c[4],10),fe=parseInt(c[5],10),We(W()),!0}function Cr(i){var l={0:"No errors.",1:"FEN string must contain six space-delimited fields.",2:"6th field (move number) must be a positive integer.",3:"5th field (half move counter) must be a non-negative integer.",4:"4th field (en-passant square) is invalid.",5:"3rd field (castling availability) is invalid.",6:"2nd field (side to move) is invalid.",7:"1st field (piece positions) does not contain 8 '/'-delimited rows.",8:"1st field (piece positions) is invalid [consecutive numbers].",9:"1st field (piece positions) is invalid [invalid piece].",10:"1st field (piece positions) is invalid [row too large].",11:"Illegal en-passant square"},c=i.split(/\s+/);if(c.length!==6)return{valid:!1,error_number:1,error:l[1]};if(isNaN(c[5])||parseInt(c[5],10)<=0)return{valid:!1,error_number:2,error:l[2]};if(isNaN(c[4])||parseInt(c[4],10)<0)return{valid:!1,error_number:3,error:l[3]};if(!/^(-|[abcdefgh][36])$/.test(c[3]))return{valid:!1,error_number:4,error:l[4]};if(!/^(KQ?k?q?|Qk?q?|kq?|q|-)$/.test(c[2]))return{valid:!1,error_number:5,error:l[5]};if(!/^(w|b)$/.test(c[1]))return{valid:!1,error_number:6,error:l[6]};var s=c[0].split("/");if(s.length!==8)return{valid:!1,error_number:7,error:l[7]};for(var f=0;f<s.length;f++){for(var d=0,w=!1,C=0;C<s[f].length;C++)if(isNaN(s[f][C])){if(!/^[prnbqkPRNBQK]$/.test(s[f][C]))return{valid:!1,error_number:9,error:l[9]};d+=1,w=!1}else{if(w)return{valid:!1,error_number:8,error:l[8]};d+=parseInt(s[f][C],10),w=!0}if(d!==8)return{valid:!1,error_number:10,error:l[10]}}return c[3][1]=="3"&&c[1]=="w"||c[3][1]=="6"&&c[1]=="b"?{valid:!1,error_number:11,error:l[11]}:{valid:!0,error_number:0,error:l[0]}}function W(){for(var i=0,l="",c=_.a8;c<=_.h1;c++){if(h[c]==null)i++;else{i>0&&(l+=i,i=0);var s=h[c].color,f=h[c].type;l+=s===t?f.toUpperCase():f.toLowerCase()}c+1&136&&(i>0&&(l+=i),c!==_.h1&&(l+="/"),i=0,c+=8)}var d="";I[t]&b.KSIDE_CASTLE&&(d+="K"),I[t]&b.QSIDE_CASTLE&&(d+="Q"),I[o]&b.KSIDE_CASTLE&&(d+="k"),I[o]&b.QSIDE_CASTLE&&(d+="q"),d=d||"-";var w=J===a?"-":Z(J);return[l,q,d,w,oe,fe].join(" ")}function Ve(i){for(var l=0;l<i.length;l+=2)typeof i[l]=="string"&&typeof i[l+1]=="string"&&(G[i[l]]=i[l+1]);return G}function We(i){ae.length>0||(i!==K?(G.SetUp="1",G.FEN=i):(delete G.SetUp,delete G.FEN))}function kr(i){var l=h[_[i]];return l?{type:l.type,color:l.color}:null}function Pr(i,l){if(!("type"in i&&"color"in i)||R.indexOf(i.type.toLowerCase())===-1||!(l in _))return!1;var c=_[l];return i.type==g&&!($[i.color]==a||$[i.color]==c)?!1:(h[c]={type:i.type,color:i.color},i.type===g&&($[i.color]=c),We(W()),!0)}function Cn(i){var l=kr(i);return h[_[i]]=null,l&&l.type===g&&($[l.color]=a),We(W()),l}function Er(i,l,c,s,f){var d={color:q,from:l,to:c,flags:s,piece:i[l].type};return f&&(d.flags|=b.PROMOTION,d.promotion=f),i[c]?d.captured=i[c].type:s&b.EP_CAPTURE&&(d.captured=u),d}function te(i){function l(xe,N,H,ve,qe){if(xe[H].type===u&&(pe(ve)===Se||pe(ve)===Ie))for(var Ne=[S,v,m,p],ke=0,ze=Ne.length;ke<ze;ke++)N.push(Er(xe,H,ve,qe,Ne[ke]));else N.push(Er(xe,H,ve,qe))}var c=[],s=q,f=Ke(s),d={b:x,w:Re},w=_.a8,C=_.h1,k=!1,D=typeof i!="undefined"&&"legal"in i?i.legal:!0,A=typeof i!="undefined"&&"piece"in i&&typeof i.piece=="string"?i.piece.toLowerCase():!0;if(typeof i!="undefined"&&"square"in i)if(i.square in _)w=C=_[i.square],k=!0;else return[];for(var y=w;y<=C;y++){if(y&136){y+=7;continue}var B=h[y];if(!(B==null||B.color!==s)){if(B.type===u&&(A===!0||A===u)){var T=y+P[s][0];if(h[T]==null){l(h,c,y,T,b.NORMAL);var T=y+P[s][1];d[s]===pe(y)&&h[T]==null&&l(h,c,y,T,b.BIG_PAWN)}for(M=2;M<4;M++){var T=y+P[s][M];T&136||(h[T]!=null&&h[T].color===f?l(h,c,y,T,b.CAPTURE):T===J&&l(h,c,y,J,b.EP_CAPTURE))}}else if(A===!0||A===B.type)for(var M=0,ee=ye[B.type].length;M<ee;M++)for(var U=ye[B.type][M],T=y;T+=U,!(T&136);){if(h[T]==null)l(h,c,y,T,b.NORMAL);else{if(h[T].color===s)break;l(h,c,y,T,b.CAPTURE);break}if(B.type==="n"||B.type==="k")break}}}if((A===!0||A===g)&&(!k||C===$[s])){if(I[s]&b.KSIDE_CASTLE){var V=$[s],re=V+2;h[V+1]==null&&h[re]==null&&!Ce(f,$[s])&&!Ce(f,V+1)&&!Ce(f,re)&&l(h,c,$[s],re,b.KSIDE_CASTLE)}if(I[s]&b.QSIDE_CASTLE){var V=$[s],re=V-2;h[V-1]==null&&h[V-2]==null&&h[V-3]==null&&!Ce(f,$[s])&&!Ce(f,V-1)&&!Ce(f,re)&&l(h,c,$[s],re,b.QSIDE_CASTLE)}}if(!D)return c;for(var ce=[],y=0,ee=c.length;y<ee;y++)le(c[y]),Ye(s)||ce.push(c[y]),de();return ce}function Oe(i,l){var c="";if(i.flags&b.KSIDE_CASTLE)c="O-O";else if(i.flags&b.QSIDE_CASTLE)c="O-O-O";else{if(i.piece!==u){var s=Pn(i,l);c+=i.piece.toUpperCase()+s}i.flags&(b.CAPTURE|b.EP_CAPTURE)&&(i.piece===u&&(c+=Z(i.from)[0]),c+="x"),c+=Z(i.to),i.flags&b.PROMOTION&&(c+="="+i.promotion.toUpperCase())}return le(i),He()&&(Xe()?c+="#":c+="+"),de(),c}function Ar(i){return i.replace(/=/,"").replace(/[+#]?[?!]*$/,"")}function Ce(i,l){for(var c=_.a8;c<=_.h1;c++){if(c&136){c+=7;continue}if(!(h[c]==null||h[c].color!==i)){var s=h[c],f=c-l,d=f+119;if(se[d]&1<<_e[s.type]){if(s.type===u){if(f>0){if(s.color===t)return!0}else if(s.color===o)return!0;continue}if(s.type==="n"||s.type==="k")return!0;for(var w=j[d],C=c+w,k=!1;C!==l;){if(h[C]!=null){k=!0;break}C+=w}if(!k)return!0}}}return!1}function Ye(i){return Ce(Ke(i),$[i])}function He(){return Ye(q)}function Xe(){return He()&&te().length===0}function Je(){return!He()&&te().length===0}function er(){for(var i={},l=[],c=0,s=0,f=_.a8;f<=_.h1;f++){if(s=(s+1)%2,f&136){f+=7;continue}var d=h[f];d&&(i[d.type]=d.type in i?i[d.type]+1:1,d.type===m&&l.push(s),c++)}if(c===2)return!0;if(c===3&&(i[m]===1||i[p]===1))return!0;if(c===i[m]+2){for(var w=0,C=l.length,f=0;f<C;f++)w+=l[f];if(w===0||w===C)return!0}return!1}function rr(){for(var i=[],l={},c=!1;;){var s=de();if(!s)break;i.push(s)}for(;;){var f=W().split(" ").slice(0,4).join(" ");if(l[f]=f in l?l[f]+1:1,l[f]>=3&&(c=!0),!i.length)break;le(i.pop())}return c}function kn(i){ae.push({move:i,kings:{b:$.b,w:$.w},turn:q,castling:{b:I.b,w:I.w},ep_square:J,half_moves:oe,move_number:fe})}function le(i){var l=q,c=Ke(l);if(kn(i),h[i.to]=h[i.from],h[i.from]=null,i.flags&b.EP_CAPTURE&&(q===o?h[i.to-16]=null:h[i.to+16]=null),i.flags&b.PROMOTION&&(h[i.to]={type:i.promotion,color:l}),h[i.to].type===g){if($[h[i.to].color]=i.to,i.flags&b.KSIDE_CASTLE){var s=i.to-1,f=i.to+1;h[s]=h[f],h[f]=null}else if(i.flags&b.QSIDE_CASTLE){var s=i.to+1,f=i.to-2;h[s]=h[f],h[f]=null}I[l]=""}if(I[l]){for(var d=0,w=O[l].length;d<w;d++)if(i.from===O[l][d].square&&I[l]&O[l][d].flag){I[l]^=O[l][d].flag;break}}if(I[c]){for(var d=0,w=O[c].length;d<w;d++)if(i.to===O[c][d].square&&I[c]&O[c][d].flag){I[c]^=O[c][d].flag;break}}i.flags&b.BIG_PAWN?q==="b"?J=i.to-16:J=i.to+16:J=a,i.piece===u||i.flags&(b.CAPTURE|b.EP_CAPTURE)?oe=0:oe++,q===o&&fe++,q=Ke(q)}function de(){var i=ae.pop();if(i==null)return null;var l=i.move;$=i.kings,q=i.turn,I=i.castling,J=i.ep_square,oe=i.half_moves,fe=i.move_number;var c=q,s=Ke(q);if(h[l.from]=h[l.to],h[l.from].type=l.piece,h[l.to]=null,l.flags&b.CAPTURE)h[l.to]={type:l.captured,color:s};else if(l.flags&b.EP_CAPTURE){var f;c===o?f=l.to-16:f=l.to+16,h[f]={type:u,color:s}}if(l.flags&(b.KSIDE_CASTLE|b.QSIDE_CASTLE)){var d,w;l.flags&b.KSIDE_CASTLE?(d=l.to+1,w=l.to-1):l.flags&b.QSIDE_CASTLE&&(d=l.to-2,w=l.to+1),h[d]=h[w],h[w]=null}return l}function Pn(i,l){for(var c=i.from,s=i.to,f=i.piece,d=0,w=0,C=0,k=0,D=l.length;k<D;k++){var A=l[k].from,y=l[k].to,B=l[k].piece;f===B&&c!==A&&s===y&&(d++,pe(c)===pe(A)&&w++,De(c)===De(A)&&C++)}return d>0?w>0&&C>0?Z(c):C>0?Z(c).charAt(1):Z(c).charAt(0):""}function En(i){var l=i.charAt(0);if(l>="a"&&l<="h"){var c=i.match(/[a-h]\d.*[a-h]\d/);return c?void 0:u}return l=l.toLowerCase(),l==="o"?g:l}function An(){for(var i=`   +------------------------+
`,l=_.a8;l<=_.h1;l++){if(De(l)===0&&(i+=" "+"87654321"[pe(l)]+" |"),h[l]==null)i+=" . ";else{var c=h[l].type,s=h[l].color,f=s===t?c.toUpperCase():c.toLowerCase();i+=" "+f+" "}l+1&136&&(i+=`|
`,l+=8)}return i+=`   +------------------------+
`,i+=`     a  b  c  d  e  f  g  h
`,i}function Tr(i,l){var c=Ar(i),s=!1;if(l){var f=c.match(/([pnbrqkPNBRQK])?([a-h][1-8])x?-?([a-h][1-8])([qrbnQRBN])?/);if(f){var d=f[1],w=f[2],C=f[3],k=f[4];w.length==1&&(s=!0)}else{var f=c.match(/([pnbrqkPNBRQK])?([a-h]?[1-8]?)x?-?([a-h][1-8])([qrbnQRBN])?/);if(f){var d=f[1],w=f[2],C=f[3],k=f[4];if(w.length==1)var s=!0}}}for(var D=En(c),A=te({legal:!0,piece:d||D}),y=0,B=A.length;y<B;y++){if(c===Ar(Oe(A[y],A)))return A[y];if(l&&f){if((!d||d.toLowerCase()==A[y].piece)&&_[w]==A[y].from&&_[C]==A[y].to&&(!k||k.toLowerCase()==A[y].promotion))return A[y];if(s){var T=Z(A[y].from);if((!d||d.toLowerCase()==A[y].piece)&&_[C]==A[y].to&&(w==T[0]||w==T[1])&&(!k||k.toLowerCase()==A[y].promotion))return A[y]}}}return null}function pe(i){return i>>4}function De(i){return i&15}function Z(i){var l=De(i),c=pe(i);return"abcdefgh".substring(l,l+1)+"87654321".substring(c,c+1)}function Ke(i){return i===t?o:t}function Tn(i){return"0123456789".indexOf(i)!==-1}function Fe(i){var l=Mr(i);l.san=Oe(l,te({legal:!0})),l.to=Z(l.to),l.from=Z(l.from);var c="";for(var s in b)b[s]&l.flags&&(c+=Me[s]);return l.flags=c,l}function Mr(i){var l=i instanceof Array?[]:{};for(var c in i)typeof c=="object"?l[c]=Mr(i[c]):l[c]=i[c];return l}function Rr(i){return i.replace(/^\s+|\s+$/g,"")}function xr(i){for(var l=te({legal:!1}),c=0,s=q,f=0,d=l.length;f<d;f++){if(le(l[f]),!Ye(s))if(i-1>0){var w=xr(i-1);c+=w}else c++;de()}return c}return{WHITE:t,BLACK:o,PAWN:u,KNIGHT:p,BISHOP:m,ROOK:v,QUEEN:S,KING:g,SQUARES:function(){for(var i=[],l=_.a8;l<=_.h1;l++){if(l&136){l+=7;continue}i.push(Z(l))}return i}(),FLAGS:Me,load:function(i){return Le(i)},reset:function(){return Sr()},moves:function(i){for(var l=te(i),c=[],s=0,f=l.length;s<f;s++)typeof i!="undefined"&&"verbose"in i&&i.verbose?c.push(Fe(l[s])):c.push(Oe(l[s],te({legal:!0})));return c},in_check:function(){return He()},in_checkmate:function(){return Xe()},in_stalemate:function(){return Je()},in_draw:function(){return oe>=100||Je()||er()||rr()},insufficient_material:function(){return er()},in_threefold_repetition:function(){return rr()},game_over:function(){return oe>=100||Xe()||Je()||er()||rr()},validate_fen:function(i){return Cr(i)},fen:function(){return W()},board:function(){for(var i=[],l=[],c=_.a8;c<=_.h1;c++)h[c]==null?l.push(null):l.push({type:h[c].type,color:h[c].color}),c+1&136&&(i.push(l),l=[],c+=8);return i},pgn:function(i){var l=typeof i=="object"&&typeof i.newline_char=="string"?i.newline_char:`
`,c=typeof i=="object"&&typeof i.max_width=="number"?i.max_width:0,s=[],f=!1;for(var d in G)s.push("["+d+' "'+G[d]+'"]'+l),f=!0;f&&ae.length&&s.push(l);for(var w=function(M){var ee=Q[W()];if(typeof ee!="undefined"){var U=M.length>0?" ":"";M=`${M}${U}{${ee}}`}return M},C=[];ae.length>0;)C.push(de());var k=[],D="";for(C.length===0&&k.push(w(""));C.length>0;){D=w(D);var A=C.pop();!ae.length&&A.color==="b"?D=fe+". ...":A.color==="w"&&(D.length&&k.push(D),D=fe+"."),D=D+" "+Oe(A,te({legal:!0})),le(A)}if(D.length&&k.push(w(D)),typeof G.Result!="undefined"&&k.push(G.Result),c===0)return s.join("")+k.join(" ");for(var y=function(){return s.length>0&&s[s.length-1]===" "?(s.pop(),!0):!1},B=function(M,ee){for(var U of ee.split(" "))if(!!U){if(M+U.length>c){for(;y();)M--;s.push(l),M=0}s.push(U),M+=U.length,s.push(" "),M++}return y()&&M--,M},T=0,d=0;d<k.length;d++){if(T+k[d].length>c&&k[d].includes("{")){T=B(T,k[d]);continue}T+k[d].length>c&&d!==0?(s[s.length-1]===" "&&s.pop(),s.push(l),T=0):d!==0&&(s.push(" "),T++),s.push(k[d]),T+=k[d].length}return s.join("")},load_pgn:function(i,l){var c=typeof l!="undefined"&&"sloppy"in l?l.sloppy:!1;function s(N){return N.replace(/\\/g,"\\")}function f(N,H){for(var ve=typeof H=="object"&&typeof H.newline_char=="string"?H.newline_char:`\r?
`,qe={},Ne=N.split(new RegExp(s(ve))),ke="",ze="",je=0;je<Ne.length;je++)ke=Ne[je].replace(/^\[([A-Z][A-Za-z]*)\s.*\]$/,"$1"),ze=Ne[je].replace(/^\[[A-Za-z]+\s"(.*)"\ *\]$/,"$1"),Rr(ke).length>0&&(qe[ke]=ze);return qe}var d=typeof l=="object"&&typeof l.newline_char=="string"?l.newline_char:`\r?
`,w=new RegExp("^(\\[((?:"+s(d)+")|.)*\\])(?:"+s(d)+"){2}"),C=w.test(i)?w.exec(i)[1]:"";Sr();var k=f(C,l);for(var D in k)Ve([D,k[D]]);if(k.SetUp==="1"&&!("FEN"in k&&Le(k.FEN,!0)))return!1;for(var A=function(N){return Array.from(N).map(function(H){return H.charCodeAt(0)<128?H.charCodeAt(0).toString(16):encodeURIComponent(H).replace(/\%/g,"").toLowerCase()}).join("")},y=function(N){return N.length==0?"":decodeURIComponent("%"+N.match(/.{1,2}/g).join("%"))},B=function(N){return N=N.replace(new RegExp(s(d),"g")," "),`{${A(N.slice(1,N.length-1))}}`},T=function(N){if(N.startsWith("{")&&N.endsWith("}"))return y(N.slice(1,N.length-1))},M=i.replace(C,"").replace(new RegExp(`({[^}]*})+?|;([^${s(d)}]*)`,"g"),function(N,H,ve){return H!==void 0?B(H):" "+B(`{${ve.slice(1)}}`)}).replace(new RegExp(s(d),"g")," "),ee=/(\([^\(\)]+\))+?/g;ee.test(M);)M=M.replace(ee,"");M=M.replace(/\d+\.(\.\.)?/g,""),M=M.replace(/\.\.\./g,""),M=M.replace(/\$\d+/g,"");var U=Rr(M).split(new RegExp(/\s+/));U=U.join(",").replace(/,,+/g,",").split(",");for(var V="",re="",ce=0;ce<U.length;ce++){var xe=T(U[ce]);if(xe!==void 0){Q[W()]=xe;continue}if(V=Tr(U[ce],c),V==null)if(E.indexOf(U[ce])>-1)re=U[ce];else return!1;else re="",le(V)}return re&&Object.keys(G).length&&!G.Result&&Ve(["Result",re]),!0},header:function(){return Ve(arguments)},ascii:function(){return An()},turn:function(){return q},move:function(i,l){var c=typeof l!="undefined"&&"sloppy"in l?l.sloppy:!1,s=null;if(typeof i=="string")s=Tr(i,c);else if(typeof i=="object"){for(var f=te(),d=0,w=f.length;d<w;d++)if(i.from===Z(f[d].from)&&i.to===Z(f[d].to)&&(!("promotion"in f[d])||i.promotion===f[d].promotion)){s=f[d];break}}if(!s)return null;var C=Fe(s);return le(s),C},undo:function(){var i=de();return i?Fe(i):null},clear:function(){return yr()},put:function(i,l){return Pr(i,l)},get:function(i){return kr(i)},remove:function(i){return Cn(i)},perft:function(i){return xr(i)},square_color:function(i){if(i in _){var l=_[i];return(pe(l)+De(l))%2===0?"light":"dark"}return null},history:function(i){for(var l=[],c=[],s=typeof i!="undefined"&&("verbose"in i)&&i.verbose;ae.length>0;)l.push(de());for(;l.length>0;){var f=l.pop();s?c.push(Fe(f)):c.push(Oe(f,te({legal:!0}))),le(f)}return c},get_comment:function(){return Q[W()]},set_comment:function(i){Q[W()]=i.replace("{","[").replace("}","]")},delete_comment:function(){var i=Q[W()];return delete Q[W()],i},get_comments:function(){return _r(),Object.keys(Q).map(function(i){return{fen:i,comment:Q[i]}})},delete_comments:function(){return _r(),Object.keys(Q).map(function(i){var l=Q[i];return delete Q[i],{fen:i,comment:l}})}}};e.Chess=r})(Sn);const rt=Qr({props:{position:null,orientation:null},emits:["ready","move"],setup(e,{emit:r}){const{position:n,orientation:o="white"}=e;async function t(S,g){if(S=="a0"||g=="a0"||!a)return;u.move({from:S,to:g,promotion:"q"}),a.set({turnColor:u.turn()==="w"?"white":"black",fen:u.fen(),check:u.in_check(),lastMove:[S,g],movable:{color:u.turn()==="w"?"white":"black",dests:new Map}});let R;if(r("move",K=>R=K,u,a),!R)a.set({movable:{dests:m()}});else{let K=await R;setTimeout(()=>t(K.from,K.to))}}let a,u=Sn.Chess(n),p={fen:u.fen().split(" ")[0],orientation:o,premovable:{enabled:!1},turnColor:u.turn()==="w"?"white":"black",movable:{free:!1,color:u.turn()==="w"?"white":"black",dests:new Map,events:{after:t}}};function m(){let S=new Map;return u.SQUARES.forEach(g=>{let R=u.moves({square:g,verbose:!0});R.length&&S.set(g,R.map(({to:K})=>K))}),S}async function v(S){a=S,r("ready",a,u);let g;if(r("move",R=>g=R,u,a),!g)a.set({turnColor:u.turn()==="w"?"white":"black",check:u.in_check(),movable:{color:u.turn()==="w"?"white":"black",dests:m()}});else{let R=await g;setTimeout(()=>t(R.from,R.to))}}return(S,g)=>(Wr(),Hr(Xo,{config:On(p),onReady:v},{nav:ir(()=>[Fr(S.$slots,"nav")]),_:3},8,["config"]))}});export{rt as _};
