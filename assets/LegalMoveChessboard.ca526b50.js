import{_ as Mn,D as Rn}from"./index.d668bf32.js";import{d as Qr,f as xn,q as Nn,s as In,o as Wr,c as Hr,w as ir,r as Fr,g as qn,u as Ln}from"./vendor.c311a53b.js";const On=["white","black"],sr=["a","b","c","d","e","f","g","h"],ur=["1","2","3","4","5","6","7","8"],Dn=[...ur].reverse(),fr=Array.prototype.concat(...sr.map(e=>ur.map(r=>e+r))),Y=e=>fr[8*e[0]+e[1]],L=e=>[e.charCodeAt(0)-97,e.charCodeAt(1)-49],zr=fr.map(L);function Kn(e){let r;const n=()=>(r===void 0&&(r=e()),r);return n.clear=()=>{r=void 0},n}const $n=()=>{let e;return{start(){e=performance.now()},cancel(){e=void 0},stop(){if(!e)return 0;const r=performance.now()-e;return e=void 0,r}}},dr=e=>e==="white"?"black":"white",Ue=(e,r)=>{const n=e[0]-r[0],t=e[1]-r[1];return n*n+t*t},ar=(e,r)=>e.role===r.role&&e.color===r.color,Qe=e=>(r,n)=>[(n?r[0]:7-r[0])*e.width/8,(n?7-r[1]:r[1])*e.height/8],ie=(e,r)=>{e.style.transform=`translate(${r[0]}px,${r[1]}px)`},jr=(e,r,n=1)=>{e.style.transform=`translate(${r[0]}px,${r[1]}px) scale(${n})`},pr=(e,r)=>{e.style.visibility=r?"visible":"hidden"},Ae=e=>{var r;if(e.clientX||e.clientX===0)return[e.clientX,e.clientY];if((r=e.targetTouches)===null||r===void 0?void 0:r[0])return[e.targetTouches[0].clientX,e.targetTouches[0].clientY]},Gr=e=>e.buttons===2||e.button===2,se=(e,r)=>{const n=document.createElement(e);return r&&(n.className=r),n};function Zr(e,r,n){const t=L(e);return r||(t[0]=7-t[0],t[1]=7-t[1]),[n.left+n.width*t[0]/8+n.width/16,n.top+n.height*(7-t[1])/8+n.height/16]}function Ee(e,r){return Math.abs(e-r)}function Bn(e){return(r,n,t,o)=>Ee(r,t)<2&&(e==="white"?o===n+1||n<=1&&o===n+2&&r===t:o===n-1||n>=6&&o===n-2&&r===t)}const Vr=(e,r,n,t)=>{const o=Ee(e,n),l=Ee(r,t);return o===1&&l===2||o===2&&l===1},Yr=(e,r,n,t)=>Ee(e,n)===Ee(r,t),Xr=(e,r,n,t)=>e===n||r===t,Jr=(e,r,n,t)=>Yr(e,r,n,t)||Xr(e,r,n,t);function Un(e,r,n){return(t,o,l,s)=>Ee(t,l)<2&&Ee(o,s)<2||n&&o===s&&o===(e==="white"?0:7)&&(t===4&&(l===2&&r.includes(0)||l===6&&r.includes(7))||r.includes(l))}function Qn(e,r){const n=r==="white"?"1":"8",t=[];for(const[o,l]of e)o[1]===n&&l.color===r&&l.role==="rook"&&t.push(L(o)[0]);return t}function en(e,r,n){const t=e.get(r);if(!t)return[];const o=L(r),l=t.role,s=l==="pawn"?Bn(t.color):l==="knight"?Vr:l==="bishop"?Yr:l==="rook"?Xr:l==="queen"?Jr:Un(t.color,Qn(e,t.color),n);return zr.filter(f=>(o[0]!==f[0]||o[1]!==f[1])&&s(o[0],o[1],f[0],f[1])).map(Y)}function F(e,...r){e&&setTimeout(()=>e(...r),1)}function Wn(e){e.orientation=dr(e.orientation),e.animation.current=e.draggable.current=e.selected=void 0}function Hn(e,r){for(const[n,t]of r)t?e.pieces.set(n,t):e.pieces.delete(n)}function Fn(e,r){if(e.check=void 0,r===!0&&(r=e.turnColor),r)for(const[n,t]of e.pieces)t.role==="king"&&t.color===r&&(e.check=n)}function zn(e,r,n,t){we(e),e.premovable.current=[r,n],F(e.premovable.events.set,r,n,t)}function be(e){e.premovable.current&&(e.premovable.current=void 0,F(e.premovable.events.unset))}function jn(e,r,n){be(e),e.predroppable.current={role:r,key:n},F(e.predroppable.events.set,r,n)}function we(e){const r=e.predroppable;r.current&&(r.current=void 0,F(r.events.unset))}function Gn(e,r,n){if(!e.autoCastle)return!1;const t=e.pieces.get(r);if(!t||t.role!=="king")return!1;const o=L(r),l=L(n);if(o[1]!==0&&o[1]!==7||o[1]!==l[1])return!1;o[0]===4&&!e.pieces.has(n)&&(l[0]===6?n=Y([7,l[1]]):l[0]===2&&(n=Y([0,l[1]])));const s=e.pieces.get(n);return!s||s.color!==t.color||s.role!=="rook"?!1:(e.pieces.delete(r),e.pieces.delete(n),o[0]<l[0]?(e.pieces.set(Y([6,l[1]]),t),e.pieces.set(Y([5,l[1]]),s)):(e.pieces.set(Y([2,l[1]]),t),e.pieces.set(Y([3,l[1]]),s)),!0)}function rn(e,r,n){const t=e.pieces.get(r),o=e.pieces.get(n);if(r===n||!t)return!1;const l=o&&o.color!==t.color?o:void 0;return n===e.selected&&X(e),F(e.events.move,r,n,l),Gn(e,r,n)||(e.pieces.set(n,t),e.pieces.delete(r)),e.lastMove=[r,n],e.check=void 0,F(e.events.change),l||!0}function vr(e,r,n,t){if(e.pieces.has(n))if(t)e.pieces.delete(n);else return!1;return F(e.events.dropNewPiece,r,n),e.pieces.set(n,r),e.lastMove=[n],e.check=void 0,F(e.events.change),e.movable.dests=void 0,e.turnColor=dr(e.turnColor),!0}function nn(e,r,n){const t=rn(e,r,n);return t&&(e.movable.dests=void 0,e.turnColor=dr(e.turnColor),e.animation.current=void 0),t}function tn(e,r,n){if(hr(e,r,n)){const t=nn(e,r,n);if(t){const o=e.hold.stop();X(e);const l={premove:!1,ctrlKey:e.stats.ctrlKey,holdTime:o};return t!==!0&&(l.captured=t),F(e.movable.events.after,r,n,l),!0}}else if(Vn(e,r,n))return zn(e,r,n,{ctrlKey:e.stats.ctrlKey}),X(e),!0;return X(e),!1}function on(e,r,n,t){const o=e.pieces.get(r);o&&(Zn(e,r,n)||t)?(e.pieces.delete(r),vr(e,o,n,t),F(e.movable.events.afterNewPiece,o.role,n,{premove:!1,predrop:!1})):o&&Yn(e,r,n)?jn(e,o.role,n):(be(e),we(e)),e.pieces.delete(r),X(e)}function lr(e,r,n){if(F(e.events.select,r),e.selected){if(e.selected===r&&!e.draggable.enabled){X(e),e.hold.cancel();return}else if((e.selectable.enabled||n)&&e.selected!==r&&tn(e,e.selected,r)){e.stats.dragged=!1;return}}(ln(e,r)||gr(e,r))&&(an(e,r),e.hold.start())}function an(e,r){e.selected=r,gr(e,r)?e.premovable.dests=en(e.pieces,r,e.premovable.castle):e.premovable.dests=void 0}function X(e){e.selected=void 0,e.premovable.dests=void 0,e.hold.cancel()}function ln(e,r){const n=e.pieces.get(r);return!!n&&(e.movable.color==="both"||e.movable.color===n.color&&e.turnColor===n.color)}function hr(e,r,n){var t,o;return r!==n&&ln(e,r)&&(e.movable.free||!!((o=(t=e.movable.dests)===null||t===void 0?void 0:t.get(r))===null||o===void 0?void 0:o.includes(n)))}function Zn(e,r,n){const t=e.pieces.get(r);return!!t&&(r===n||!e.pieces.has(n))&&(e.movable.color==="both"||e.movable.color===t.color&&e.turnColor===t.color)}function gr(e,r){const n=e.pieces.get(r);return!!n&&e.premovable.enabled&&e.movable.color===n.color&&e.turnColor!==n.color}function Vn(e,r,n){return r!==n&&gr(e,r)&&en(e.pieces,r,e.premovable.castle).includes(n)}function Yn(e,r,n){const t=e.pieces.get(r),o=e.pieces.get(n);return!!t&&(!o||o.color!==e.movable.color)&&e.predroppable.enabled&&(t.role!=="pawn"||n[1]!=="1"&&n[1]!=="8")&&e.movable.color===t.color&&e.turnColor!==t.color}function Xn(e,r){const n=e.pieces.get(r);return!!n&&e.draggable.enabled&&(e.movable.color==="both"||e.movable.color===n.color&&(e.turnColor===n.color||e.premovable.enabled))}function Jn(e){const r=e.premovable.current;if(!r)return!1;const n=r[0],t=r[1];let o=!1;if(hr(e,n,t)){const l=nn(e,n,t);if(l){const s={premove:!0};l!==!0&&(s.captured=l),F(e.movable.events.after,n,t,s),o=!0}}return be(e),o}function et(e,r){const n=e.predroppable.current;let t=!1;if(!n)return!1;if(r(n)){const o={role:n.role,color:e.movable.color};vr(e,o,n.key)&&(F(e.movable.events.afterNewPiece,n.role,n.key,{premove:!1,predrop:!0}),t=!0)}return we(e),t}function mr(e){be(e),we(e),X(e)}function Nr(e){e.movable.color=e.movable.dests=e.animation.current=void 0,mr(e)}function Te(e,r,n){let t=Math.floor(8*(e[0]-n.left)/n.width);r||(t=7-t);let o=7-Math.floor(8*(e[1]-n.top)/n.height);return r||(o=7-o),t>=0&&t<8&&o>=0&&o<8?Y([t,o]):void 0}function rt(e,r,n,t){const o=L(e),l=zr.filter(v=>Jr(o[0],o[1],v[0],v[1])||Vr(o[0],o[1],v[0],v[1])),f=l.map(v=>Zr(Y(v),n,t)).map(v=>Ue(r,v)),[,b]=f.reduce((v,M,g)=>v[0]<M?v:[M,g],[f[0],0]);return Y(l[b])}function z(e){return e.orientation==="white"}const cn="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR",nt={p:"pawn",r:"rook",n:"knight",b:"bishop",q:"queen",k:"king"},tt={pawn:"p",rook:"r",knight:"n",bishop:"b",queen:"q",king:"k"};function sn(e){e==="start"&&(e=cn);const r=new Map;let n=7,t=0;for(const o of e)switch(o){case" ":case"[":return r;case"/":if(--n,n<0)return r;t=0;break;case"~":{const l=r.get(Y([t-1,n]));l&&(l.promoted=!0);break}default:{const l=o.charCodeAt(0);if(l<57)t+=l-48;else{const s=o.toLowerCase();r.set(Y([t,n]),{role:nt[s],color:o===s?"black":"white"}),++t}}}return r}function ot(e){return Dn.map(r=>sr.map(n=>{const t=e.get(n+r);if(t){let o=tt[t.role];return t.color==="white"&&(o=o.toUpperCase()),t.promoted&&(o+="~"),o}else return"1"}).join("")).join("/").replace(/1{2,}/g,r=>r.length.toString())}function un(e,r){r.animation&&(br(e.animation,r.animation),(e.animation.duration||0)<70&&(e.animation.enabled=!1))}function fn(e,r){var n,t;if(((n=r.movable)===null||n===void 0?void 0:n.dests)&&(e.movable.dests=void 0),((t=r.drawable)===null||t===void 0?void 0:t.autoShapes)&&(e.drawable.autoShapes=[]),br(e,r),r.fen&&(e.pieces=sn(r.fen),e.drawable.shapes=[]),"check"in r&&Fn(e,r.check||!1),"lastMove"in r&&!r.lastMove?e.lastMove=void 0:r.lastMove&&(e.lastMove=r.lastMove),e.selected&&an(e,e.selected),un(e,r),!e.movable.rookCastle&&e.movable.dests){const o=e.movable.color==="white"?"1":"8",l="e"+o,s=e.movable.dests.get(l),f=e.pieces.get(l);if(!s||!f||f.role!=="king")return;e.movable.dests.set(l,s.filter(b=>!(b==="a"+o&&s.includes("c"+o))&&!(b==="h"+o&&s.includes("g"+o))))}}function br(e,r){for(const n in r)Ir(e[n])&&Ir(r[n])?br(e[n],r[n]):e[n]=r[n]}function Ir(e){return typeof e=="object"}function Pe(e,r){return r.animation.enabled?lt(e,r):ge(e,r)}function ge(e,r){const n=e(r);return r.dom.redraw(),n}function nr(e,r){return{key:e,pos:L(e),piece:r}}function it(e,r){return r.sort((n,t)=>Ue(e.pos,n.pos)-Ue(e.pos,t.pos))[0]}function at(e,r){const n=new Map,t=[],o=new Map,l=[],s=[],f=new Map;let b,v,M;for(const[g,R]of e)f.set(g,nr(g,R));for(const g of fr)b=r.pieces.get(g),v=f.get(g),b?v?ar(b,v.piece)||(l.push(v),s.push(nr(g,b))):s.push(nr(g,b)):v&&l.push(v);for(const g of s)v=it(g,l.filter(R=>ar(g.piece,R.piece))),v&&(M=[v.pos[0]-g.pos[0],v.pos[1]-g.pos[1]],n.set(g.key,M.concat(M)),t.push(v.key));for(const g of l)t.includes(g.key)||o.set(g.key,g.piece);return{anims:n,fadings:o}}function dn(e,r){const n=e.animation.current;if(n===void 0){e.dom.destroyed||e.dom.redrawNow();return}const t=1-(r-n.start)*n.frequency;if(t<=0)e.animation.current=void 0,e.dom.redrawNow();else{const o=ct(t);for(const l of n.plan.anims.values())l[2]=l[0]*o,l[3]=l[1]*o;e.dom.redrawNow(!0),requestAnimationFrame((l=performance.now())=>dn(e,l))}}function lt(e,r){const n=new Map(r.pieces),t=e(r),o=at(n,r);if(o.anims.size||o.fadings.size){const l=r.animation.current&&r.animation.current.start;r.animation.current={start:performance.now(),frequency:1/r.animation.duration,plan:o},l||dn(r,performance.now())}else r.dom.redraw();return t}function ct(e){return e<.5?4*e*e*e:(e-1)*(2*e-2)*(2*e-2)+1}const st=["green","red","blue","yellow"];function ut(e,r){if(r.touches&&r.touches.length>1)return;r.stopPropagation(),r.preventDefault(),r.ctrlKey?X(e):mr(e);const n=Ae(r),t=Te(n,z(e),e.dom.bounds());!t||(e.drawable.current={orig:t,pos:n,brush:vt(r),snapToValidMove:e.drawable.defaultSnapToValidMove},pn(e))}function pn(e){requestAnimationFrame(()=>{const r=e.drawable.current;if(r){const n=Te(r.pos,z(e),e.dom.bounds());n||(r.snapToValidMove=!1);const t=r.snapToValidMove?rt(r.orig,r.pos,z(e),e.dom.bounds()):n;t!==r.mouseSq&&(r.mouseSq=t,r.dest=t!==r.orig?t:void 0,e.dom.redrawNow()),pn(e)}})}function ft(e,r){e.drawable.current&&(e.drawable.current.pos=Ae(r))}function dt(e){const r=e.drawable.current;r&&(r.mouseSq&&ht(e.drawable,r),vn(e))}function vn(e){e.drawable.current&&(e.drawable.current=void 0,e.dom.redraw())}function pt(e){e.drawable.shapes.length&&(e.drawable.shapes=[],e.dom.redraw(),hn(e.drawable))}function vt(e){var r;const n=(e.shiftKey||e.ctrlKey)&&Gr(e),t=e.altKey||e.metaKey||((r=e.getModifierState)===null||r===void 0?void 0:r.call(e,"AltGraph"));return st[(n?1:0)+(t?2:0)]}function ht(e,r){const n=o=>o.orig===r.orig&&o.dest===r.dest,t=e.shapes.find(n);t&&(e.shapes=e.shapes.filter(o=>!n(o))),(!t||t.brush!==r.brush)&&e.shapes.push(r),hn(e)}function hn(e){e.onChange&&e.onChange(e.shapes)}function gt(e,r){if(!r.isTrusted||r.button!==void 0&&r.button!==0||r.touches&&r.touches.length>1)return;const n=e.dom.bounds(),t=Ae(r),o=Te(t,z(e),n);if(!o)return;const l=e.pieces.get(o),s=e.selected;!s&&e.drawable.enabled&&(e.drawable.eraseOnClick||!l||l.color!==e.turnColor)&&pt(e),r.cancelable!==!1&&(!r.touches||e.blockTouchScroll||l||s||mt(e,t))&&r.preventDefault();const f=!!e.premovable.current,b=!!e.predroppable.current;e.stats.ctrlKey=r.ctrlKey,e.selected&&hr(e,e.selected,o)?Pe(g=>lr(g,o),e):lr(e,o);const v=e.selected===o,M=mn(e,o);if(l&&M&&v&&Xn(e,o)){e.draggable.current={orig:o,piece:l,origPos:t,pos:t,started:e.draggable.autoDistance&&e.stats.dragged,element:M,previouslySelected:s,originTarget:r.target,keyHasChanged:!1},M.cgDragging=!0,M.classList.add("dragging");const g=e.dom.elements.ghost;g&&(g.className=`ghost ${l.color} ${l.role}`,ie(g,Qe(n)(L(o),z(e))),pr(g,!0)),wr(e)}else f&&be(e),b&&we(e);e.dom.redraw()}function mt(e,r){const n=z(e),t=e.dom.bounds(),o=Math.pow(t.width/8,2);for(const l of e.pieces.keys()){const s=Zr(l,n,t);if(Ue(s,r)<=o)return!0}return!1}function bt(e,r,n,t){const o="a0";e.pieces.set(o,r),e.dom.redraw();const l=Ae(n);e.draggable.current={orig:o,piece:r,origPos:l,pos:l,started:!0,element:()=>mn(e,o),originTarget:n.target,newPiece:!0,force:!!t,keyHasChanged:!1},wr(e)}function wr(e){requestAnimationFrame(()=>{var r;const n=e.draggable.current;if(!n)return;((r=e.animation.current)===null||r===void 0?void 0:r.plan.anims.has(n.orig))&&(e.animation.current=void 0);const t=e.pieces.get(n.orig);if(!t||!ar(t,n.piece))Ge(e);else if(!n.started&&Ue(n.pos,n.origPos)>=Math.pow(e.draggable.distance,2)&&(n.started=!0),n.started){if(typeof n.element=="function"){const l=n.element();if(!l)return;l.cgDragging=!0,l.classList.add("dragging"),n.element=l}const o=e.dom.bounds();ie(n.element,[n.pos[0]-o.left-o.width/16,n.pos[1]-o.top-o.height/16]),n.keyHasChanged||(n.keyHasChanged=n.orig!==Te(n.pos,z(e),o))}wr(e)})}function wt(e,r){e.draggable.current&&(!r.touches||r.touches.length<2)&&(e.draggable.current.pos=Ae(r))}function yt(e,r){const n=e.draggable.current;if(!n)return;if(r.type==="touchend"&&r.cancelable!==!1&&r.preventDefault(),r.type==="touchend"&&n.originTarget!==r.target&&!n.newPiece){e.draggable.current=void 0;return}be(e),we(e);const t=Ae(r)||n.pos,o=Te(t,z(e),e.dom.bounds());o&&n.started&&n.orig!==o?n.newPiece?on(e,n.orig,o,n.force):(e.stats.ctrlKey=r.ctrlKey,tn(e,n.orig,o)&&(e.stats.dragged=!0)):n.newPiece?e.pieces.delete(n.orig):e.draggable.deleteOnDropOff&&!o&&(e.pieces.delete(n.orig),F(e.events.change)),(n.orig===n.previouslySelected||n.keyHasChanged)&&(n.orig===o||!o)?X(e):e.selectable.enabled||X(e),gn(e),e.draggable.current=void 0,e.dom.redraw()}function Ge(e){const r=e.draggable.current;r&&(r.newPiece&&e.pieces.delete(r.orig),e.draggable.current=void 0,X(e),gn(e),e.dom.redraw())}function gn(e){const r=e.dom.elements;r.ghost&&pr(r.ghost,!1)}function mn(e,r){let n=e.dom.elements.board.firstChild;for(;n;){if(n.cgKey===r&&n.tagName==="PIECE")return n;n=n.nextSibling}}function _t(e,r){e.exploding={stage:1,keys:r},e.dom.redraw(),setTimeout(()=>{qr(e,2),setTimeout(()=>qr(e,void 0),120)},120)}function qr(e,r){e.exploding&&(r?e.exploding.stage=r:e.exploding=void 0,e.dom.redraw())}function St(e,r){function n(){Wn(e),r()}return{set(t){t.orientation&&t.orientation!==e.orientation&&n(),un(e,t),(t.fen?Pe:ge)(o=>fn(o,t),e)},state:e,getFen:()=>ot(e.pieces),toggleOrientation:n,setPieces(t){Pe(o=>Hn(o,t),e)},selectSquare(t,o){t?Pe(l=>lr(l,t,o),e):e.selected&&(X(e),e.dom.redraw())},move(t,o){Pe(l=>rn(l,t,o),e)},newPiece(t,o){Pe(l=>vr(l,t,o),e)},playPremove(){if(e.premovable.current){if(Pe(Jn,e))return!0;e.dom.redraw()}return!1},playPredrop(t){if(e.predroppable.current){const o=et(e,t);return e.dom.redraw(),o}return!1},cancelPremove(){ge(be,e)},cancelPredrop(){ge(we,e)},cancelMove(){ge(t=>{mr(t),Ge(t)},e)},stop(){ge(t=>{Nr(t),Ge(t)},e)},explode(t){_t(e,t)},setAutoShapes(t){ge(o=>o.drawable.autoShapes=t,e)},setShapes(t){ge(o=>o.drawable.shapes=t,e)},getKeyAtDomPos(t){return Te(t,z(e),e.dom.bounds())},redrawAll:r,dragNewPiece(t,o,l){bt(e,t,o,l)},destroy(){Nr(e),e.dom.unbind&&e.dom.unbind(),e.dom.destroyed=!0}}}function Ct(){return{pieces:sn(cn),orientation:"white",turnColor:"white",coordinates:!0,ranksPosition:"right",autoCastle:!0,viewOnly:!1,disableContextMenu:!1,addPieceZIndex:!1,addDimensionsCssVars:!1,blockTouchScroll:!1,pieceKey:!1,highlight:{lastMove:!0,check:!0},animation:{enabled:!0,duration:200},movable:{free:!0,color:"both",showDests:!0,events:{},rookCastle:!0},premovable:{enabled:!0,showDests:!0,castle:!0,events:{}},predroppable:{enabled:!1,events:{}},draggable:{enabled:!0,distance:3,autoDistance:!0,showGhost:!0,deleteOnDropOff:!1},dropmode:{active:!1},selectable:{enabled:!0},stats:{dragged:!("ontouchstart"in window)},events:{},drawable:{enabled:!0,visible:!0,defaultSnapToValidMove:!0,eraseOnClick:!0,shapes:[],autoShapes:[],brushes:{green:{key:"g",color:"#15781B",opacity:1,lineWidth:10},red:{key:"r",color:"#882020",opacity:1,lineWidth:10},blue:{key:"b",color:"#003088",opacity:1,lineWidth:10},yellow:{key:"y",color:"#e68f00",opacity:1,lineWidth:10},paleBlue:{key:"pb",color:"#003088",opacity:.4,lineWidth:15},paleGreen:{key:"pg",color:"#15781B",opacity:.4,lineWidth:15},paleRed:{key:"pr",color:"#882020",opacity:.4,lineWidth:15},paleGrey:{key:"pgr",color:"#4a4a4a",opacity:.35,lineWidth:15}},prevSvgHash:""},hold:$n()}}function cr(e,r,n){const t=new Map,o=[];for(const f of e)t.set(f.hash,!1);let l=r.firstChild,s;for(;l;)s=l.getAttribute("cgHash"),t.has(s)?t.set(s,!0):o.push(l),l=l.nextSibling;for(const f of o)r.removeChild(f);for(const f of e)t.get(f.hash)||r.appendChild(n(f))}function ne(e){return document.createElementNS("http://www.w3.org/2000/svg",e)}function kt(e,r,n){const t=e.drawable,o=t.current,l=o&&o.mouseSq?o:void 0,s=new Map,f=e.dom.bounds(),b=t.autoShapes.filter(S=>!S.piece);for(const S of t.shapes.concat(b).concat(l?[l]:[]))S.dest&&s.set(S.dest,(s.get(S.dest)||0)+1);const v=t.shapes.concat(b).map(S=>({shape:S,current:!1,hash:Lr(S,s,!1,f)}));l&&v.push({shape:l,current:!0,hash:Lr(l,s,!0,f)});const M=v.map(S=>S.hash).join(";");if(M===e.drawable.prevSvgHash)return;e.drawable.prevSvgHash=M;const g=r.querySelector("defs"),R=r.querySelector("g"),I=n.querySelector("g");Pt(t,v,g),cr(v.filter(S=>!S.shape.customSvg),R,S=>Or(e,S,t.brushes,s,f)),cr(v.filter(S=>S.shape.customSvg),I,S=>Or(e,S,t.brushes,s,f))}function Pt(e,r,n){const t=new Map;let o;for(const f of r)f.shape.dest&&(o=e.brushes[f.shape.brush],f.shape.modifiers&&(o=bn(o,f.shape.modifiers)),t.set(o.key,o));const l=new Set;let s=n.firstChild;for(;s;)l.add(s.getAttribute("cgKey")),s=s.nextSibling;for(const[f,b]of t.entries())l.has(f)||n.appendChild(Nt(b))}function Lr({orig:e,dest:r,brush:n,piece:t,modifiers:o,customSvg:l},s,f,b){return[b.width,b.height,f,e,r,n,r&&(s.get(r)||0)>1,t&&Et(t),o&&At(o),l&&Tt(l)].filter(v=>v).join(",")}function Et(e){return[e.color,e.role,e.scale].filter(r=>r).join(",")}function At(e){return""+(e.lineWidth||"")}function Tt(e){let r=0;for(let n=0;n<e.length;n++)r=(r<<5)-r+e.charCodeAt(n)>>>0;return"custom-"+r.toString()}function Or(e,{shape:r,current:n,hash:t},o,l,s){let f;const b=Dr(L(r.orig),e.orientation);if(r.customSvg)f=Mt(r.customSvg,b,s);else if(r.dest){let v=o[r.brush];r.modifiers&&(v=bn(v,r.modifiers)),f=xt(v,b,Dr(L(r.dest),e.orientation),n,(l.get(r.dest)||0)>1,s)}else f=Rt(o[r.brush],b,n,s);return f.setAttribute("cgHash",t),f}function Mt(e,r,n){const[t,o]=Ze(r,n),l=me(ne("g"),{transform:`translate(${t},${o})`}),s=me(ne("svg"),{width:1,height:1,viewBox:"0 0 100 100"});return l.appendChild(s),s.innerHTML=e,l}function Rt(e,r,n,t){const o=Ze(r,t),l=It(),s=(t.width+t.height)/(4*Math.max(t.width,t.height));return me(ne("circle"),{stroke:e.color,"stroke-width":l[n?0:1],fill:"none",opacity:wn(e,n),cx:o[0],cy:o[1],r:s-l[1]/2})}function xt(e,r,n,t,o,l){const s=Lt(o&&!t),f=Ze(r,l),b=Ze(n,l),v=b[0]-f[0],M=b[1]-f[1],g=Math.atan2(M,v),R=Math.cos(g)*s,I=Math.sin(g)*s;return me(ne("line"),{stroke:e.color,"stroke-width":qt(e,t),"stroke-linecap":"round","marker-end":"url(#arrowhead-"+e.key+")",opacity:wn(e,t),x1:f[0],y1:f[1],x2:b[0]-R,y2:b[1]-I})}function Nt(e){const r=me(ne("marker"),{id:"arrowhead-"+e.key,orient:"auto",markerWidth:4,markerHeight:8,refX:2.05,refY:2.01});return r.appendChild(me(ne("path"),{d:"M0,0 V4 L3,2 Z",fill:e.color})),r.setAttribute("cgKey",e.key),r}function me(e,r){for(const n in r)e.setAttribute(n,r[n]);return e}function Dr(e,r){return r==="white"?e:[7-e[0],7-e[1]]}function bn(e,r){return{color:e.color,opacity:Math.round(e.opacity*10)/10,lineWidth:Math.round(r.lineWidth||e.lineWidth),key:[e.key,r.lineWidth].filter(n=>n).join("")}}function It(){return[3/64,4/64]}function qt(e,r){return(e.lineWidth||10)*(r?.85:1)/64}function wn(e,r){return(e.opacity||1)*(r?.9:1)}function Lt(e){return(e?20:10)/64}function Ze(e,r){const n=Math.min(1,r.width/r.height),t=Math.min(1,r.height/r.width);return[(e[0]-3.5)*n,(3.5-e[1])*t]}function Ot(e,r){e.innerHTML="",e.classList.add("cg-wrap");for(const b of On)e.classList.toggle("orientation-"+b,r.orientation===b);e.classList.toggle("manipulable",!r.viewOnly);const n=se("cg-container");e.appendChild(n);const t=se("cg-board");n.appendChild(t);let o,l,s;if(r.drawable.visible&&(o=me(ne("svg"),{class:"cg-shapes",viewBox:"-4 -4 8 8",preserveAspectRatio:"xMidYMid slice"}),o.appendChild(ne("defs")),o.appendChild(ne("g")),l=me(ne("svg"),{class:"cg-custom-svgs",viewBox:"-3.5 -3.5 8 8",preserveAspectRatio:"xMidYMid slice"}),l.appendChild(ne("g")),s=se("cg-auto-pieces"),n.appendChild(o),n.appendChild(l),n.appendChild(s)),r.coordinates){const b=r.orientation==="black"?" black":"",v=r.ranksPosition==="left"?" left":"";n.appendChild(Kr(ur,"ranks"+b+v)),n.appendChild(Kr(sr,"files"+b))}let f;return r.draggable.showGhost&&(f=se("piece","ghost"),pr(f,!1),n.appendChild(f)),{board:t,container:n,wrap:e,ghost:f,svg:o,customSvg:l,autoPieces:s}}function Kr(e,r){const n=se("coords",r);let t;for(const o of e)t=se("coord"),t.textContent=o,n.appendChild(t);return n}function Dt(e,r){if(!e.dropmode.active)return;be(e),we(e);const n=e.dropmode.piece;if(n){e.pieces.set("a0",n);const t=Ae(r),o=t&&Te(t,z(e),e.dom.bounds());o&&on(e,"a0",o)}e.dom.redraw()}function Kt(e,r){const n=e.dom.elements.board;if("ResizeObserver"in window&&new ResizeObserver(r).observe(e.dom.elements.wrap),e.viewOnly)return;const t=Bt(e);n.addEventListener("touchstart",t,{passive:!1}),n.addEventListener("mousedown",t,{passive:!1}),(e.disableContextMenu||e.drawable.enabled)&&n.addEventListener("contextmenu",o=>o.preventDefault())}function $t(e,r){const n=[];if("ResizeObserver"in window||n.push($e(document.body,"chessground.resize",r)),!e.viewOnly){const t=$r(e,wt,ft),o=$r(e,yt,dt);for(const s of["touchmove","mousemove"])n.push($e(document,s,t));for(const s of["touchend","mouseup"])n.push($e(document,s,o));const l=()=>e.dom.bounds.clear();n.push($e(document,"scroll",l,{capture:!0,passive:!0})),n.push($e(window,"resize",l,{passive:!0}))}return()=>n.forEach(t=>t())}function $e(e,r,n,t){return e.addEventListener(r,n,t),()=>e.removeEventListener(r,n,t)}function Bt(e){return r=>{e.draggable.current?Ge(e):e.drawable.current?vn(e):r.shiftKey||Gr(r)?e.drawable.enabled&&ut(e,r):e.viewOnly||(e.dropmode.active?Dt(e,r):gt(e,r))}}function $r(e,r,n){return t=>{e.drawable.current?e.drawable.enabled&&n(e,t):e.viewOnly||r(e,t)}}function Ut(e){const r=z(e),n=Qe(e.dom.bounds()),t=e.dom.elements.board,o=e.pieces,l=e.animation.current,s=l?l.plan.anims:new Map,f=l?l.plan.fadings:new Map,b=e.draggable.current,v=Wt(e),M=new Set,g=new Set,R=new Map,I=new Map;let S,C,ye,ue,j,_e,Me,m,Ie,Re;for(C=t.firstChild;C;){if(S=C.cgKey,yn(C))if(ye=o.get(S),j=s.get(S),_e=f.get(S),ue=C.cgPiece,C.cgDragging&&(!b||b.orig!==S)&&(C.classList.remove("dragging"),ie(C,n(L(S),r)),C.cgDragging=!1),!_e&&C.cgFading&&(C.cgFading=!1,C.classList.remove("fading")),ye){if(j&&C.cgAnimating&&ue===Be(ye)){const x=L(S);x[0]+=j[2],x[1]+=j[3],C.classList.add("anim"),ie(C,n(x,r))}else C.cgAnimating&&(C.cgAnimating=!1,C.classList.remove("anim"),ie(C,n(L(S),r)),e.addPieceZIndex&&(C.style.zIndex=tr(L(S),r)));ue===Be(ye)&&(!_e||!C.cgFading)?M.add(S):_e&&ue===Be(_e)?(C.classList.add("fading"),C.cgFading=!0):or(R,ue,C)}else or(R,ue,C);else if(_n(C)){const x=C.className;v.get(S)===x?g.add(S):or(I,x,C)}C=C.nextSibling}for(const[x,Se]of v)if(!g.has(x)){Ie=I.get(Se),Re=Ie&&Ie.pop();const _=n(L(x),r);if(Re)Re.cgKey=x,ie(Re,_);else{const O=se("square",Se);O.cgKey=x,ie(O,_),t.insertBefore(O,t.firstChild)}}for(const[x,Se]of o)if(j=s.get(x),!M.has(x))if(Me=R.get(Be(Se)),m=Me&&Me.pop(),m){m.cgKey=x,m.cgFading&&(m.classList.remove("fading"),m.cgFading=!1);const _=L(x);e.addPieceZIndex&&(m.style.zIndex=tr(_,r)),j&&(m.cgAnimating=!0,m.classList.add("anim"),_[0]+=j[2],_[1]+=j[3]),ie(m,n(_,r))}else{const _=Be(Se),O=se("piece",_),h=L(x);O.cgPiece=_,O.cgKey=x,j&&(O.cgAnimating=!0,h[0]+=j[2],h[1]+=j[3]),ie(O,n(h,r)),e.addPieceZIndex&&(O.style.zIndex=tr(h,r)),t.appendChild(O)}for(const x of R.values())Ur(e,x);for(const x of I.values())Ur(e,x)}function Qt(e){const r=z(e),n=Qe(e.dom.bounds());let t=e.dom.elements.board.firstChild;for(;t;)(yn(t)&&!t.cgAnimating||_n(t))&&ie(t,n(L(t.cgKey),r)),t=t.nextSibling}function Br(e){const r=e.dom.elements.wrap.getBoundingClientRect(),n=e.dom.elements.container,t=r.height/r.width,o=Math.floor(r.width*window.devicePixelRatio/8)*8/window.devicePixelRatio,l=o*t;n.style.width=o+"px",n.style.height=l+"px",e.dom.bounds.clear(),e.addDimensionsCssVars&&(document.documentElement.style.setProperty("--cg-width",o+"px"),document.documentElement.style.setProperty("--cg-height",l+"px"))}function yn(e){return e.tagName==="PIECE"}function _n(e){return e.tagName==="SQUARE"}function Ur(e,r){for(const n of r)e.dom.elements.board.removeChild(n)}function tr(e,r){const t=e[1];return`${r?3+7-t:3+t}`}function Be(e){return`${e.color} ${e.role}`}function Wt(e){var r;const n=new Map;if(e.lastMove&&e.highlight.lastMove)for(const l of e.lastMove)he(n,l,"last-move");if(e.check&&e.highlight.check&&he(n,e.check,"check"),e.selected&&(he(n,e.selected,"selected"),e.movable.showDests)){const l=(r=e.movable.dests)===null||r===void 0?void 0:r.get(e.selected);if(l)for(const f of l)he(n,f,"move-dest"+(e.pieces.has(f)?" oc":""));const s=e.premovable.dests;if(s)for(const f of s)he(n,f,"premove-dest"+(e.pieces.has(f)?" oc":""))}const t=e.premovable.current;if(t)for(const l of t)he(n,l,"current-premove");else e.predroppable.current&&he(n,e.predroppable.current.key,"current-premove");const o=e.exploding;if(o)for(const l of o.keys)he(n,l,"exploding"+o.stage);return n}function he(e,r,n){const t=e.get(r);t?e.set(r,`${t} ${n}`):e.set(r,n)}function or(e,r,n){const t=e.get(r);t?t.push(n):e.set(r,[n])}function Ht(e,r){const t=e.drawable.autoShapes.filter(o=>o.piece).map(o=>({shape:o,hash:jt(o),current:!1}));cr(t,r,o=>zt(e,o,e.dom.bounds()))}function Ft(e){var r;const n=z(e),t=Qe(e.dom.bounds());let o=(r=e.dom.elements.autoPieces)===null||r===void 0?void 0:r.firstChild;for(;o;)jr(o,t(L(o.cgKey),n),o.cgScale),o=o.nextSibling}function zt(e,{shape:r,hash:n},t){var o,l,s;const f=r.orig,b=(o=r.piece)===null||o===void 0?void 0:o.role,v=(l=r.piece)===null||l===void 0?void 0:l.color,M=(s=r.piece)===null||s===void 0?void 0:s.scale,g=se("piece",`${b} ${v}`);return g.setAttribute("cgHash",n),g.cgKey=f,g.cgScale=M,jr(g,Qe(t)(L(f),z(e)),M),g}function jt(e){var r,n,t;return[e.orig,(r=e.piece)===null||r===void 0?void 0:r.role,(n=e.piece)===null||n===void 0?void 0:n.color,(t=e.piece)===null||t===void 0?void 0:t.scale].join(",")}function Gt(e,r){const n=Ct();fn(n,r||{});function t(){const o="dom"in n?n.dom.unbind:void 0,l=Ot(e,n),s=Kn(()=>l.board.getBoundingClientRect()),f=M=>{Ut(v),l.autoPieces&&Ht(v,l.autoPieces),!M&&l.svg&&kt(v,l.svg,l.customSvg)},b=()=>{Br(v),Qt(v),l.autoPieces&&Ft(v)},v=n;return v.dom={elements:l,bounds:s,redraw:Zt(f),redrawNow:f,unbind:o},v.drawable.prevSvgHash="",Br(v),f(!1),Kt(v,b),o||(v.dom.unbind=$t(v,b)),v.events.insert&&v.events.insert(l),v}return St(t(),t)}function Zt(e){let r=!1;return()=>{r||(r=!0,requestAnimationFrame(()=>{e(),r=!1}))}}const Vt=Qr({props:{config:null},emits:["ready"],setup(e,{emit:r}){const{config:n}=e;let t=xn(null);function o(){let{value:l}=t;if(l){let s=l.parentElement;s.removeChild(l);let{width:f,height:b}=s.getBoundingClientRect();l.style.width=Math.min(f,b)+"px",l.style.height=Math.min(f,b)+"px",s.appendChild(l)}}return Nn(()=>{if(t.value){o(),window.addEventListener("resize",o);let l=Gt(t.value,n);r("ready",l)}}),In(()=>{window.removeEventListener("resize",o)}),(l,s)=>(Wr(),Hr(Rn,{"explicit-height":"",flexbox:""},{nav:ir(()=>[Fr(l.$slots,"nav",{},void 0,!0)]),default:ir(()=>[qn("div",{ref_key:"boardEl",ref:t,class:"chessboard"},null,512)]),_:3}))}});var Yt=Mn(Vt,[["__scopeId","data-v-7122605e"]]),Sn={};(function(e){var r=function(n){var t="b",o="w",l=-1,s="p",f="n",b="b",v="r",M="q",g="k",R="pnbrqkPNBRQK",I="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1",S=["1-0","0-1","1/2-1/2","*"],C={b:[16,32,17,15],w:[-16,-32,-17,-15]},ye={n:[-18,-33,-31,-14,18,33,31,14],b:[-17,-15,17,15],r:[-16,1,16,-1],q:[-17,-16,-15,1,17,16,15,-1],k:[-17,-16,-15,1,17,16,15,-1]},ue=[20,0,0,0,0,0,0,24,0,0,0,0,0,0,20,0,0,20,0,0,0,0,0,24,0,0,0,0,0,20,0,0,0,0,20,0,0,0,0,24,0,0,0,0,20,0,0,0,0,0,0,20,0,0,0,24,0,0,0,20,0,0,0,0,0,0,0,0,20,0,0,24,0,0,20,0,0,0,0,0,0,0,0,0,0,20,2,24,2,20,0,0,0,0,0,0,0,0,0,0,0,2,53,56,53,2,0,0,0,0,0,0,24,24,24,24,24,24,56,0,56,24,24,24,24,24,24,0,0,0,0,0,0,2,53,56,53,2,0,0,0,0,0,0,0,0,0,0,0,20,2,24,2,20,0,0,0,0,0,0,0,0,0,0,20,0,0,24,0,0,20,0,0,0,0,0,0,0,0,20,0,0,0,24,0,0,0,20,0,0,0,0,0,0,20,0,0,0,0,24,0,0,0,0,20,0,0,0,0,20,0,0,0,0,0,24,0,0,0,0,0,20,0,0,20,0,0,0,0,0,0,24,0,0,0,0,0,0,20],j=[17,0,0,0,0,0,0,16,0,0,0,0,0,0,15,0,0,17,0,0,0,0,0,16,0,0,0,0,0,15,0,0,0,0,17,0,0,0,0,16,0,0,0,0,15,0,0,0,0,0,0,17,0,0,0,16,0,0,0,15,0,0,0,0,0,0,0,0,17,0,0,16,0,0,15,0,0,0,0,0,0,0,0,0,0,17,0,16,0,15,0,0,0,0,0,0,0,0,0,0,0,0,17,16,15,0,0,0,0,0,0,0,1,1,1,1,1,1,1,0,-1,-1,-1,-1,-1,-1,-1,0,0,0,0,0,0,0,-15,-16,-17,0,0,0,0,0,0,0,0,0,0,0,0,-15,0,-16,0,-17,0,0,0,0,0,0,0,0,0,0,-15,0,0,-16,0,0,-17,0,0,0,0,0,0,0,0,-15,0,0,0,-16,0,0,0,-17,0,0,0,0,0,0,-15,0,0,0,0,-16,0,0,0,0,-17,0,0,0,0,-15,0,0,0,0,0,-16,0,0,0,0,0,-17,0,0,-15,0,0,0,0,0,0,-16,0,0,0,0,0,0,-17],_e={p:0,n:1,b:2,r:3,q:4,k:5},Me={NORMAL:"n",CAPTURE:"c",BIG_PAWN:"b",EP_CAPTURE:"e",PROMOTION:"p",KSIDE_CASTLE:"k",QSIDE_CASTLE:"q"},m={NORMAL:1,CAPTURE:2,BIG_PAWN:4,EP_CAPTURE:8,PROMOTION:16,KSIDE_CASTLE:32,QSIDE_CASTLE:64},Ie=7,Re=6,x=1,Se=0,_={a8:0,b8:1,c8:2,d8:3,e8:4,f8:5,g8:6,h8:7,a7:16,b7:17,c7:18,d7:19,e7:20,f7:21,g7:22,h7:23,a6:32,b6:33,c6:34,d6:35,e6:36,f6:37,g6:38,h6:39,a5:48,b5:49,c5:50,d5:51,e5:52,f5:53,g5:54,h5:55,a4:64,b4:65,c4:66,d4:67,e4:68,f4:69,g4:70,h4:71,a3:80,b3:81,c3:82,d3:83,e3:84,f3:85,g3:86,h3:87,a2:96,b2:97,c2:98,d2:99,e2:100,f2:101,g2:102,h2:103,a1:112,b1:113,c1:114,d1:115,e1:116,f1:117,g1:118,h1:119},O={w:[{square:_.a1,flag:m.QSIDE_CASTLE},{square:_.h1,flag:m.KSIDE_CASTLE}],b:[{square:_.a8,flag:m.QSIDE_CASTLE},{square:_.h8,flag:m.KSIDE_CASTLE}]},h=new Array(128),$={w:l,b:l},K=o,q={w:0,b:0},J=l,te=0,fe=1,ae=[],G={},Q={};qe(typeof n=="undefined"?I:n);function yr(i){typeof i=="undefined"&&(i=!1),h=new Array(128),$={w:l,b:l},K=o,q={w:0,b:0},J=l,te=0,fe=1,ae=[],i||(G={}),Q={},We(W())}function _r(){for(var i=[],a={},c=function(u){u in Q&&(a[u]=Q[u])};ae.length>0;)i.push(de());for(c(W());i.length>0;)le(i.pop()),c(W());Q=a}function Sr(){qe(I)}function qe(i,a){typeof a=="undefined"&&(a=!1);var c=i.split(/\s+/),u=c[0],d=0;if(!Cr(i).valid)return!1;yr(a);for(var p=0;p<u.length;p++){var w=u.charAt(p);if(w==="/")d+=8;else if(Tn(w))d+=parseInt(w,10);else{var k=w<"a"?o:t;Pr({type:w.toLowerCase(),color:k},Z(d)),d++}}return K=c[1],c[2].indexOf("K")>-1&&(q.w|=m.KSIDE_CASTLE),c[2].indexOf("Q")>-1&&(q.w|=m.QSIDE_CASTLE),c[2].indexOf("k")>-1&&(q.b|=m.KSIDE_CASTLE),c[2].indexOf("q")>-1&&(q.b|=m.QSIDE_CASTLE),J=c[3]==="-"?l:_[c[3]],te=parseInt(c[4],10),fe=parseInt(c[5],10),We(W()),!0}function Cr(i){var a={0:"No errors.",1:"FEN string must contain six space-delimited fields.",2:"6th field (move number) must be a positive integer.",3:"5th field (half move counter) must be a non-negative integer.",4:"4th field (en-passant square) is invalid.",5:"3rd field (castling availability) is invalid.",6:"2nd field (side to move) is invalid.",7:"1st field (piece positions) does not contain 8 '/'-delimited rows.",8:"1st field (piece positions) is invalid [consecutive numbers].",9:"1st field (piece positions) is invalid [invalid piece].",10:"1st field (piece positions) is invalid [row too large].",11:"Illegal en-passant square"},c=i.split(/\s+/);if(c.length!==6)return{valid:!1,error_number:1,error:a[1]};if(isNaN(c[5])||parseInt(c[5],10)<=0)return{valid:!1,error_number:2,error:a[2]};if(isNaN(c[4])||parseInt(c[4],10)<0)return{valid:!1,error_number:3,error:a[3]};if(!/^(-|[abcdefgh][36])$/.test(c[3]))return{valid:!1,error_number:4,error:a[4]};if(!/^(KQ?k?q?|Qk?q?|kq?|q|-)$/.test(c[2]))return{valid:!1,error_number:5,error:a[5]};if(!/^(w|b)$/.test(c[1]))return{valid:!1,error_number:6,error:a[6]};var u=c[0].split("/");if(u.length!==8)return{valid:!1,error_number:7,error:a[7]};for(var d=0;d<u.length;d++){for(var p=0,w=!1,k=0;k<u[d].length;k++)if(isNaN(u[d][k])){if(!/^[prnbqkPRNBQK]$/.test(u[d][k]))return{valid:!1,error_number:9,error:a[9]};p+=1,w=!1}else{if(w)return{valid:!1,error_number:8,error:a[8]};p+=parseInt(u[d][k],10),w=!0}if(p!==8)return{valid:!1,error_number:10,error:a[10]}}return c[3][1]=="3"&&c[1]=="w"||c[3][1]=="6"&&c[1]=="b"?{valid:!1,error_number:11,error:a[11]}:{valid:!0,error_number:0,error:a[0]}}function W(){for(var i=0,a="",c=_.a8;c<=_.h1;c++){if(h[c]==null)i++;else{i>0&&(a+=i,i=0);var u=h[c].color,d=h[c].type;a+=u===o?d.toUpperCase():d.toLowerCase()}c+1&136&&(i>0&&(a+=i),c!==_.h1&&(a+="/"),i=0,c+=8)}var p="";q[o]&m.KSIDE_CASTLE&&(p+="K"),q[o]&m.QSIDE_CASTLE&&(p+="Q"),q[t]&m.KSIDE_CASTLE&&(p+="k"),q[t]&m.QSIDE_CASTLE&&(p+="q"),p=p||"-";var w=J===l?"-":Z(J);return[a,K,p,w,te,fe].join(" ")}function Ve(i){for(var a=0;a<i.length;a+=2)typeof i[a]=="string"&&typeof i[a+1]=="string"&&(G[i[a]]=i[a+1]);return G}function We(i){ae.length>0||(i!==I?(G.SetUp="1",G.FEN=i):(delete G.SetUp,delete G.FEN))}function kr(i){var a=h[_[i]];return a?{type:a.type,color:a.color}:null}function Pr(i,a){if(!("type"in i&&"color"in i)||R.indexOf(i.type.toLowerCase())===-1||!(a in _))return!1;var c=_[a];return i.type==g&&!($[i.color]==l||$[i.color]==c)?!1:(h[c]={type:i.type,color:i.color},i.type===g&&($[i.color]=c),We(W()),!0)}function Cn(i){var a=kr(i);return h[_[i]]=null,a&&a.type===g&&($[a.color]=l),We(W()),a}function Er(i,a,c,u,d){var p={color:K,from:a,to:c,flags:u,piece:i[a].type};return d&&(p.flags|=m.PROMOTION,p.promotion=d),i[c]?p.captured=i[c].type:u&m.EP_CAPTURE&&(p.captured=s),p}function oe(i){function a(xe,N,H,ve,Ke){if(xe[H].type===s&&(pe(ve)===Se||pe(ve)===Ie))for(var Ne=[M,v,b,f],ke=0,ze=Ne.length;ke<ze;ke++)N.push(Er(xe,H,ve,Ke,Ne[ke]));else N.push(Er(xe,H,ve,Ke))}var c=[],u=K,d=De(u),p={b:x,w:Re},w=_.a8,k=_.h1,P=!1,D=typeof i!="undefined"&&"legal"in i?i.legal:!0,E=typeof i!="undefined"&&"piece"in i&&typeof i.piece=="string"?i.piece.toLowerCase():!0;if(typeof i!="undefined"&&"square"in i)if(i.square in _)w=k=_[i.square],P=!0;else return[];for(var y=w;y<=k;y++){if(y&136){y+=7;continue}var B=h[y];if(!(B==null||B.color!==u)){if(B.type===s&&(E===!0||E===s)){var A=y+C[u][0];if(h[A]==null){a(h,c,y,A,m.NORMAL);var A=y+C[u][1];p[u]===pe(y)&&h[A]==null&&a(h,c,y,A,m.BIG_PAWN)}for(T=2;T<4;T++){var A=y+C[u][T];A&136||(h[A]!=null&&h[A].color===d?a(h,c,y,A,m.CAPTURE):A===J&&a(h,c,y,J,m.EP_CAPTURE))}}else if(E===!0||E===B.type)for(var T=0,ee=ye[B.type].length;T<ee;T++)for(var U=ye[B.type][T],A=y;A+=U,!(A&136);){if(h[A]==null)a(h,c,y,A,m.NORMAL);else{if(h[A].color===u)break;a(h,c,y,A,m.CAPTURE);break}if(B.type==="n"||B.type==="k")break}}}if((E===!0||E===g)&&(!P||k===$[u])){if(q[u]&m.KSIDE_CASTLE){var V=$[u],re=V+2;h[V+1]==null&&h[re]==null&&!Ce(d,$[u])&&!Ce(d,V+1)&&!Ce(d,re)&&a(h,c,$[u],re,m.KSIDE_CASTLE)}if(q[u]&m.QSIDE_CASTLE){var V=$[u],re=V-2;h[V-1]==null&&h[V-2]==null&&h[V-3]==null&&!Ce(d,$[u])&&!Ce(d,V-1)&&!Ce(d,re)&&a(h,c,$[u],re,m.QSIDE_CASTLE)}}if(!D)return c;for(var ce=[],y=0,ee=c.length;y<ee;y++)le(c[y]),Ye(u)||ce.push(c[y]),de();return ce}function Le(i,a){var c="";if(i.flags&m.KSIDE_CASTLE)c="O-O";else if(i.flags&m.QSIDE_CASTLE)c="O-O-O";else{if(i.piece!==s){var u=Pn(i,a);c+=i.piece.toUpperCase()+u}i.flags&(m.CAPTURE|m.EP_CAPTURE)&&(i.piece===s&&(c+=Z(i.from)[0]),c+="x"),c+=Z(i.to),i.flags&m.PROMOTION&&(c+="="+i.promotion.toUpperCase())}return le(i),He()&&(Xe()?c+="#":c+="+"),de(),c}function Ar(i){return i.replace(/=/,"").replace(/[+#]?[?!]*$/,"")}function Ce(i,a){for(var c=_.a8;c<=_.h1;c++){if(c&136){c+=7;continue}if(!(h[c]==null||h[c].color!==i)){var u=h[c],d=c-a,p=d+119;if(ue[p]&1<<_e[u.type]){if(u.type===s){if(d>0){if(u.color===o)return!0}else if(u.color===t)return!0;continue}if(u.type==="n"||u.type==="k")return!0;for(var w=j[p],k=c+w,P=!1;k!==a;){if(h[k]!=null){P=!0;break}k+=w}if(!P)return!0}}}return!1}function Ye(i){return Ce(De(i),$[i])}function He(){return Ye(K)}function Xe(){return He()&&oe().length===0}function Je(){return!He()&&oe().length===0}function er(){for(var i={},a=[],c=0,u=0,d=_.a8;d<=_.h1;d++){if(u=(u+1)%2,d&136){d+=7;continue}var p=h[d];p&&(i[p.type]=p.type in i?i[p.type]+1:1,p.type===b&&a.push(u),c++)}if(c===2)return!0;if(c===3&&(i[b]===1||i[f]===1))return!0;if(c===i[b]+2){for(var w=0,k=a.length,d=0;d<k;d++)w+=a[d];if(w===0||w===k)return!0}return!1}function rr(){for(var i=[],a={},c=!1;;){var u=de();if(!u)break;i.push(u)}for(;;){var d=W().split(" ").slice(0,4).join(" ");if(a[d]=d in a?a[d]+1:1,a[d]>=3&&(c=!0),!i.length)break;le(i.pop())}return c}function kn(i){ae.push({move:i,kings:{b:$.b,w:$.w},turn:K,castling:{b:q.b,w:q.w},ep_square:J,half_moves:te,move_number:fe})}function le(i){var a=K,c=De(a);if(kn(i),h[i.to]=h[i.from],h[i.from]=null,i.flags&m.EP_CAPTURE&&(K===t?h[i.to-16]=null:h[i.to+16]=null),i.flags&m.PROMOTION&&(h[i.to]={type:i.promotion,color:a}),h[i.to].type===g){if($[h[i.to].color]=i.to,i.flags&m.KSIDE_CASTLE){var u=i.to-1,d=i.to+1;h[u]=h[d],h[d]=null}else if(i.flags&m.QSIDE_CASTLE){var u=i.to+1,d=i.to-2;h[u]=h[d],h[d]=null}q[a]=""}if(q[a]){for(var p=0,w=O[a].length;p<w;p++)if(i.from===O[a][p].square&&q[a]&O[a][p].flag){q[a]^=O[a][p].flag;break}}if(q[c]){for(var p=0,w=O[c].length;p<w;p++)if(i.to===O[c][p].square&&q[c]&O[c][p].flag){q[c]^=O[c][p].flag;break}}i.flags&m.BIG_PAWN?K==="b"?J=i.to-16:J=i.to+16:J=l,i.piece===s||i.flags&(m.CAPTURE|m.EP_CAPTURE)?te=0:te++,K===t&&fe++,K=De(K)}function de(){var i=ae.pop();if(i==null)return null;var a=i.move;$=i.kings,K=i.turn,q=i.castling,J=i.ep_square,te=i.half_moves,fe=i.move_number;var c=K,u=De(K);if(h[a.from]=h[a.to],h[a.from].type=a.piece,h[a.to]=null,a.flags&m.CAPTURE)h[a.to]={type:a.captured,color:u};else if(a.flags&m.EP_CAPTURE){var d;c===t?d=a.to-16:d=a.to+16,h[d]={type:s,color:u}}if(a.flags&(m.KSIDE_CASTLE|m.QSIDE_CASTLE)){var p,w;a.flags&m.KSIDE_CASTLE?(p=a.to+1,w=a.to-1):a.flags&m.QSIDE_CASTLE&&(p=a.to-2,w=a.to+1),h[p]=h[w],h[w]=null}return a}function Pn(i,a){for(var c=i.from,u=i.to,d=i.piece,p=0,w=0,k=0,P=0,D=a.length;P<D;P++){var E=a[P].from,y=a[P].to,B=a[P].piece;d===B&&c!==E&&u===y&&(p++,pe(c)===pe(E)&&w++,Oe(c)===Oe(E)&&k++)}return p>0?w>0&&k>0?Z(c):k>0?Z(c).charAt(1):Z(c).charAt(0):""}function En(i){var a=i.charAt(0);if(a>="a"&&a<="h"){var c=i.match(/[a-h]\d.*[a-h]\d/);return c?void 0:s}return a=a.toLowerCase(),a==="o"?g:a}function An(){for(var i=`   +------------------------+
`,a=_.a8;a<=_.h1;a++){if(Oe(a)===0&&(i+=" "+"87654321"[pe(a)]+" |"),h[a]==null)i+=" . ";else{var c=h[a].type,u=h[a].color,d=u===o?c.toUpperCase():c.toLowerCase();i+=" "+d+" "}a+1&136&&(i+=`|
`,a+=8)}return i+=`   +------------------------+
`,i+=`     a  b  c  d  e  f  g  h
`,i}function Tr(i,a){var c=Ar(i),u=!1;if(a){var d=c.match(/([pnbrqkPNBRQK])?([a-h][1-8])x?-?([a-h][1-8])([qrbnQRBN])?/);if(d){var p=d[1],w=d[2],k=d[3],P=d[4];w.length==1&&(u=!0)}else{var d=c.match(/([pnbrqkPNBRQK])?([a-h]?[1-8]?)x?-?([a-h][1-8])([qrbnQRBN])?/);if(d){var p=d[1],w=d[2],k=d[3],P=d[4];if(w.length==1)var u=!0}}}for(var D=En(c),E=oe({legal:!0,piece:p||D}),y=0,B=E.length;y<B;y++){if(c===Ar(Le(E[y],E)))return E[y];if(a&&d){if((!p||p.toLowerCase()==E[y].piece)&&_[w]==E[y].from&&_[k]==E[y].to&&(!P||P.toLowerCase()==E[y].promotion))return E[y];if(u){var A=Z(E[y].from);if((!p||p.toLowerCase()==E[y].piece)&&_[k]==E[y].to&&(w==A[0]||w==A[1])&&(!P||P.toLowerCase()==E[y].promotion))return E[y]}}}return null}function pe(i){return i>>4}function Oe(i){return i&15}function Z(i){var a=Oe(i),c=pe(i);return"abcdefgh".substring(a,a+1)+"87654321".substring(c,c+1)}function De(i){return i===o?t:o}function Tn(i){return"0123456789".indexOf(i)!==-1}function Fe(i){var a=Mr(i);a.san=Le(a,oe({legal:!0})),a.to=Z(a.to),a.from=Z(a.from);var c="";for(var u in m)m[u]&a.flags&&(c+=Me[u]);return a.flags=c,a}function Mr(i){var a=i instanceof Array?[]:{};for(var c in i)typeof c=="object"?a[c]=Mr(i[c]):a[c]=i[c];return a}function Rr(i){return i.replace(/^\s+|\s+$/g,"")}function xr(i){for(var a=oe({legal:!1}),c=0,u=K,d=0,p=a.length;d<p;d++){if(le(a[d]),!Ye(u))if(i-1>0){var w=xr(i-1);c+=w}else c++;de()}return c}return{WHITE:o,BLACK:t,PAWN:s,KNIGHT:f,BISHOP:b,ROOK:v,QUEEN:M,KING:g,SQUARES:function(){for(var i=[],a=_.a8;a<=_.h1;a++){if(a&136){a+=7;continue}i.push(Z(a))}return i}(),FLAGS:Me,load:function(i){return qe(i)},reset:function(){return Sr()},moves:function(i){for(var a=oe(i),c=[],u=0,d=a.length;u<d;u++)typeof i!="undefined"&&"verbose"in i&&i.verbose?c.push(Fe(a[u])):c.push(Le(a[u],oe({legal:!0})));return c},in_check:function(){return He()},in_checkmate:function(){return Xe()},in_stalemate:function(){return Je()},in_draw:function(){return te>=100||Je()||er()||rr()},insufficient_material:function(){return er()},in_threefold_repetition:function(){return rr()},game_over:function(){return te>=100||Xe()||Je()||er()||rr()},validate_fen:function(i){return Cr(i)},fen:function(){return W()},board:function(){for(var i=[],a=[],c=_.a8;c<=_.h1;c++)h[c]==null?a.push(null):a.push({type:h[c].type,color:h[c].color}),c+1&136&&(i.push(a),a=[],c+=8);return i},pgn:function(i){var a=typeof i=="object"&&typeof i.newline_char=="string"?i.newline_char:`
`,c=typeof i=="object"&&typeof i.max_width=="number"?i.max_width:0,u=[],d=!1;for(var p in G)u.push("["+p+' "'+G[p]+'"]'+a),d=!0;d&&ae.length&&u.push(a);for(var w=function(T){var ee=Q[W()];if(typeof ee!="undefined"){var U=T.length>0?" ":"";T=`${T}${U}{${ee}}`}return T},k=[];ae.length>0;)k.push(de());var P=[],D="";for(k.length===0&&P.push(w(""));k.length>0;){D=w(D);var E=k.pop();!ae.length&&E.color==="b"?D=fe+". ...":E.color==="w"&&(D.length&&P.push(D),D=fe+"."),D=D+" "+Le(E,oe({legal:!0})),le(E)}if(D.length&&P.push(w(D)),typeof G.Result!="undefined"&&P.push(G.Result),c===0)return u.join("")+P.join(" ");for(var y=function(){return u.length>0&&u[u.length-1]===" "?(u.pop(),!0):!1},B=function(T,ee){for(var U of ee.split(" "))if(!!U){if(T+U.length>c){for(;y();)T--;u.push(a),T=0}u.push(U),T+=U.length,u.push(" "),T++}return y()&&T--,T},A=0,p=0;p<P.length;p++){if(A+P[p].length>c&&P[p].includes("{")){A=B(A,P[p]);continue}A+P[p].length>c&&p!==0?(u[u.length-1]===" "&&u.pop(),u.push(a),A=0):p!==0&&(u.push(" "),A++),u.push(P[p]),A+=P[p].length}return u.join("")},load_pgn:function(i,a){var c=typeof a!="undefined"&&"sloppy"in a?a.sloppy:!1;function u(N){return N.replace(/\\/g,"\\")}function d(N,H){for(var ve=typeof H=="object"&&typeof H.newline_char=="string"?H.newline_char:`\r?
`,Ke={},Ne=N.split(new RegExp(u(ve))),ke="",ze="",je=0;je<Ne.length;je++)ke=Ne[je].replace(/^\[([A-Z][A-Za-z]*)\s.*\]$/,"$1"),ze=Ne[je].replace(/^\[[A-Za-z]+\s"(.*)"\ *\]$/,"$1"),Rr(ke).length>0&&(Ke[ke]=ze);return Ke}var p=typeof a=="object"&&typeof a.newline_char=="string"?a.newline_char:`\r?
`,w=new RegExp("^(\\[((?:"+u(p)+")|.)*\\])(?:"+u(p)+"){2}"),k=w.test(i)?w.exec(i)[1]:"";Sr();var P=d(k,a);for(var D in P)Ve([D,P[D]]);if(P.SetUp==="1"&&!("FEN"in P&&qe(P.FEN,!0)))return!1;for(var E=function(N){return Array.from(N).map(function(H){return H.charCodeAt(0)<128?H.charCodeAt(0).toString(16):encodeURIComponent(H).replace(/\%/g,"").toLowerCase()}).join("")},y=function(N){return N.length==0?"":decodeURIComponent("%"+N.match(/.{1,2}/g).join("%"))},B=function(N){return N=N.replace(new RegExp(u(p),"g")," "),`{${E(N.slice(1,N.length-1))}}`},A=function(N){if(N.startsWith("{")&&N.endsWith("}"))return y(N.slice(1,N.length-1))},T=i.replace(k,"").replace(new RegExp(`({[^}]*})+?|;([^${u(p)}]*)`,"g"),function(N,H,ve){return H!==void 0?B(H):" "+B(`{${ve.slice(1)}}`)}).replace(new RegExp(u(p),"g")," "),ee=/(\([^\(\)]+\))+?/g;ee.test(T);)T=T.replace(ee,"");T=T.replace(/\d+\.(\.\.)?/g,""),T=T.replace(/\.\.\./g,""),T=T.replace(/\$\d+/g,"");var U=Rr(T).split(new RegExp(/\s+/));U=U.join(",").replace(/,,+/g,",").split(",");for(var V="",re="",ce=0;ce<U.length;ce++){var xe=A(U[ce]);if(xe!==void 0){Q[W()]=xe;continue}if(V=Tr(U[ce],c),V==null)if(S.indexOf(U[ce])>-1)re=U[ce];else return!1;else re="",le(V)}return re&&Object.keys(G).length&&!G.Result&&Ve(["Result",re]),!0},header:function(){return Ve(arguments)},ascii:function(){return An()},turn:function(){return K},move:function(i,a){var c=typeof a!="undefined"&&"sloppy"in a?a.sloppy:!1,u=null;if(typeof i=="string")u=Tr(i,c);else if(typeof i=="object"){for(var d=oe(),p=0,w=d.length;p<w;p++)if(i.from===Z(d[p].from)&&i.to===Z(d[p].to)&&(!("promotion"in d[p])||i.promotion===d[p].promotion)){u=d[p];break}}if(!u)return null;var k=Fe(u);return le(u),k},undo:function(){var i=de();return i?Fe(i):null},clear:function(){return yr()},put:function(i,a){return Pr(i,a)},get:function(i){return kr(i)},remove:function(i){return Cn(i)},perft:function(i){return xr(i)},square_color:function(i){if(i in _){var a=_[i];return(pe(a)+Oe(a))%2===0?"light":"dark"}return null},history:function(i){for(var a=[],c=[],u=typeof i!="undefined"&&("verbose"in i)&&i.verbose;ae.length>0;)a.push(de());for(;a.length>0;){var d=a.pop();u?c.push(Fe(d)):c.push(Le(d,oe({legal:!0}))),le(d)}return c},get_comment:function(){return Q[W()]},set_comment:function(i){Q[W()]=i.replace("{","[").replace("}","]")},delete_comment:function(){var i=Q[W()];return delete Q[W()],i},get_comments:function(){return _r(),Object.keys(Q).map(function(i){return{fen:i,comment:Q[i]}})},delete_comments:function(){return _r(),Object.keys(Q).map(function(i){var a=Q[i];return delete Q[i],{fen:i,comment:a}})}}};e.Chess=r})(Sn);const eo=Qr({props:{position:null,orientation:null,destinations:null},emits:["ready","move"],setup(e,{emit:r}){const{position:n,orientation:t="white",destinations:o}=e;async function l(g,R){if(g=="a0"||R=="a0"||!s)return;if(o){let C=s.state.pieces.get(g);C&&(s.state.pieces.delete(g),s.state.pieces.set(R,C)),f.load(`${s.getFen()} ${f.turn()=="w"?"b":"w"} - - 0 1`)}else f.move({from:g,to:R,promotion:"q"},{sloppy:!0});s.set({turnColor:f.turn()==="w"?"white":"black",fen:f.fen(),check:f.in_check(),lastMove:[g,R],movable:{color:f.turn()==="w"?"white":"black",dests:new Map}});let I;r("move",C=>I=C,f,s);let S=await I;S?setTimeout(()=>l(S.from,S.to)):s.set({movable:{dests:v()}})}let s,f=Sn.Chess(n),b={fen:f.fen().split(" ")[0],orientation:t,premovable:{enabled:!1},turnColor:f.turn()==="w"?"white":"black",movable:{free:!1,color:f.turn()==="w"?"white":"black",dests:new Map,events:{after:l}}};function v(){if(o)return o(f);let g=new Map;for(let R of f.SQUARES){let I=f.moves({square:R,verbose:!0});I.length&&g.set(R,I.map(({to:S})=>S))}return g}async function M(g){s=g,r("ready",s,f);let R;r("move",S=>R=S,f,s);let I=await R;I?setTimeout(()=>l(I.from,I.to)):s.set({turnColor:f.turn()==="w"?"white":"black",check:f.in_check(),movable:{color:f.turn()==="w"?"white":"black",dests:v()}})}return(g,R)=>(Wr(),Hr(Yt,{config:Ln(b),onReady:M},{nav:ir(()=>[Fr(g.$slots,"nav")]),_:3},8,["config"]))}});export{eo as _};
