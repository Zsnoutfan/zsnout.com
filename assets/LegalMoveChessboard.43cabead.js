import{_ as fn,d as Mr,e as dn,l as pn,x as hn,o as Rr,c as xr,w as Ye,h as Nr,a as vn,D as gn,u as mn}from"./index.407f1349.js";const bn=["white","black"],rr=["a","b","c","d","e","f","g","h"],nr=["1","2","3","4","5","6","7","8"],wn=[...nr].reverse(),tr=Array.prototype.concat(...rr.map(e=>nr.map(r=>e+r))),Z=e=>tr[8*e[0]+e[1]],q=e=>[e.charCodeAt(0)-97,e.charCodeAt(1)-49],qr=tr.map(q);function yn(e){let r;const n=()=>(r===void 0&&(r=e()),r);return n.clear=()=>{r=void 0},n}const _n=()=>{let e;return{start(){e=performance.now()},cancel(){e=void 0},stop(){if(!e)return 0;const r=performance.now()-e;return e=void 0,r}}},or=e=>e==="white"?"black":"white",Ie=(e,r)=>{const n=e[0]-r[0],t=e[1]-r[1];return n*n+t*t},Xe=(e,r)=>e.role===r.role&&e.color===r.color,Le=e=>(r,n)=>[(n?r[0]:7-r[0])*e.width/8,(n?7-r[1]:r[1])*e.height/8],oe=(e,r)=>{e.style.transform=`translate(${r[0]}px,${r[1]}px)`},Ir=(e,r,n=1)=>{e.style.transform=`translate(${r[0]}px,${r[1]}px) scale(${n})`},ir=(e,r)=>{e.style.visibility=r?"visible":"hidden"},Ce=e=>{var r;if(e.clientX||e.clientX===0)return[e.clientX,e.clientY];if(!((r=e.targetTouches)===null||r===void 0)&&r[0])return[e.targetTouches[0].clientX,e.targetTouches[0].clientY]},Dr=e=>e.buttons===2||e.button===2,le=(e,r)=>{const n=document.createElement(e);return r&&(n.className=r),n};function Lr(e,r,n){const t=q(e);return r||(t[0]=7-t[0],t[1]=7-t[1]),[n.left+n.width*t[0]/8+n.width/16,n.top+n.height*(7-t[1])/8+n.height/16]}function Se(e,r){return Math.abs(e-r)}function Sn(e){return(r,n,t,o)=>Se(r,t)<2&&(e==="white"?o===n+1||n<=1&&o===n+2&&r===t:o===n-1||n>=6&&o===n-2&&r===t)}const Or=(e,r,n,t)=>{const o=Se(e,n),a=Se(r,t);return o===1&&a===2||o===2&&a===1},Kr=(e,r,n,t)=>Se(e,n)===Se(r,t),$r=(e,r,n,t)=>e===n||r===t,Br=(e,r,n,t)=>Kr(e,r,n,t)||$r(e,r,n,t);function Cn(e,r,n){return(t,o,a,s)=>Se(t,a)<2&&Se(o,s)<2||n&&o===s&&o===(e==="white"?0:7)&&(t===4&&(a===2&&r.includes(0)||a===6&&r.includes(7))||r.includes(a))}function kn(e,r){const n=r==="white"?"1":"8",t=[];for(const[o,a]of e)o[1]===n&&a.color===r&&a.role==="rook"&&t.push(q(o)[0]);return t}function Ur(e,r,n){const t=e.get(r);if(!t)return[];const o=q(r),a=t.role,s=a==="pawn"?Sn(t.color):a==="knight"?Or:a==="bishop"?Kr:a==="rook"?$r:a==="queen"?Br:Cn(t.color,kn(e,t.color),n);return qr.filter(f=>(o[0]!==f[0]||o[1]!==f[1])&&s(o[0],o[1],f[0],f[1])).map(Z)}function H(e,...r){e&&setTimeout(()=>e(...r),1)}function Pn(e){e.orientation=or(e.orientation),e.animation.current=e.draggable.current=e.selected=void 0}function En(e,r){for(const[n,t]of r)t?e.pieces.set(n,t):e.pieces.delete(n)}function An(e,r){if(e.check=void 0,r===!0&&(r=e.turnColor),r)for(const[n,t]of e.pieces)t.role==="king"&&t.color===r&&(e.check=n)}function Tn(e,r,n,t){we(e),e.premovable.current=[r,n],H(e.premovable.events.set,r,n,t)}function be(e){e.premovable.current&&(e.premovable.current=void 0,H(e.premovable.events.unset))}function Mn(e,r,n){be(e),e.predroppable.current={role:r,key:n},H(e.predroppable.events.set,r,n)}function we(e){const r=e.predroppable;r.current&&(r.current=void 0,H(r.events.unset))}function Rn(e,r,n){if(!e.autoCastle)return!1;const t=e.pieces.get(r);if(!t||t.role!=="king")return!1;const o=q(r),a=q(n);if(o[1]!==0&&o[1]!==7||o[1]!==a[1])return!1;o[0]===4&&!e.pieces.has(n)&&(a[0]===6?n=Z([7,a[1]]):a[0]===2&&(n=Z([0,a[1]])));const s=e.pieces.get(n);return!s||s.color!==t.color||s.role!=="rook"?!1:(e.pieces.delete(r),e.pieces.delete(n),o[0]<a[0]?(e.pieces.set(Z([6,a[1]]),t),e.pieces.set(Z([5,a[1]]),s)):(e.pieces.set(Z([2,a[1]]),t),e.pieces.set(Z([3,a[1]]),s)),!0)}function Qr(e,r,n){const t=e.pieces.get(r),o=e.pieces.get(n);if(r===n||!t)return!1;const a=o&&o.color!==t.color?o:void 0;return n===e.selected&&V(e),H(e.events.move,r,n,a),Rn(e,r,n)||(e.pieces.set(n,t),e.pieces.delete(r)),e.lastMove=[r,n],e.check=void 0,H(e.events.change),a||!0}function ar(e,r,n,t){if(e.pieces.has(n))if(t)e.pieces.delete(n);else return!1;return H(e.events.dropNewPiece,r,n),e.pieces.set(n,r),e.lastMove=[n],e.check=void 0,H(e.events.change),e.movable.dests=void 0,e.turnColor=or(e.turnColor),!0}function Wr(e,r,n){const t=Qr(e,r,n);return t&&(e.movable.dests=void 0,e.turnColor=or(e.turnColor),e.animation.current=void 0),t}function Hr(e,r,n){if(lr(e,r,n)){const t=Wr(e,r,n);if(t){const o=e.hold.stop();V(e);const a={premove:!1,ctrlKey:e.stats.ctrlKey,holdTime:o};return t!==!0&&(a.captured=t),H(e.movable.events.after,r,n,a),!0}}else if(Nn(e,r,n))return Tn(e,r,n,{ctrlKey:e.stats.ctrlKey}),V(e),!0;return V(e),!1}function Fr(e,r,n,t){const o=e.pieces.get(r);o&&(xn(e,r,n)||t)?(e.pieces.delete(r),ar(e,o,n,t),H(e.movable.events.afterNewPiece,o.role,n,{premove:!1,predrop:!1})):o&&qn(e,r,n)?Mn(e,o.role,n):(be(e),we(e)),e.pieces.delete(r),V(e)}function Je(e,r,n){if(H(e.events.select,r),e.selected){if(e.selected===r&&!e.draggable.enabled){V(e),e.hold.cancel();return}else if((e.selectable.enabled||n)&&e.selected!==r&&Hr(e,e.selected,r)){e.stats.dragged=!1;return}}(jr(e,r)||cr(e,r))&&(zr(e,r),e.hold.start())}function zr(e,r){e.selected=r,cr(e,r)?e.premovable.dests=Ur(e.pieces,r,e.premovable.castle):e.premovable.dests=void 0}function V(e){e.selected=void 0,e.premovable.dests=void 0,e.hold.cancel()}function jr(e,r){const n=e.pieces.get(r);return!!n&&(e.movable.color==="both"||e.movable.color===n.color&&e.turnColor===n.color)}function lr(e,r,n){var t,o;return r!==n&&jr(e,r)&&(e.movable.free||!!(!((o=(t=e.movable.dests)===null||t===void 0?void 0:t.get(r))===null||o===void 0)&&o.includes(n)))}function xn(e,r,n){const t=e.pieces.get(r);return!!t&&(r===n||!e.pieces.has(n))&&(e.movable.color==="both"||e.movable.color===t.color&&e.turnColor===t.color)}function cr(e,r){const n=e.pieces.get(r);return!!n&&e.premovable.enabled&&e.movable.color===n.color&&e.turnColor!==n.color}function Nn(e,r,n){return r!==n&&cr(e,r)&&Ur(e.pieces,r,e.premovable.castle).includes(n)}function qn(e,r,n){const t=e.pieces.get(r),o=e.pieces.get(n);return!!t&&(!o||o.color!==e.movable.color)&&e.predroppable.enabled&&(t.role!=="pawn"||n[1]!=="1"&&n[1]!=="8")&&e.movable.color===t.color&&e.turnColor!==t.color}function In(e,r){const n=e.pieces.get(r);return!!n&&e.draggable.enabled&&(e.movable.color==="both"||e.movable.color===n.color&&(e.turnColor===n.color||e.premovable.enabled))}function Dn(e){const r=e.premovable.current;if(!r)return!1;const n=r[0],t=r[1];let o=!1;if(lr(e,n,t)){const a=Wr(e,n,t);if(a){const s={premove:!0};a!==!0&&(s.captured=a),H(e.movable.events.after,n,t,s),o=!0}}return be(e),o}function Ln(e,r){const n=e.predroppable.current;let t=!1;if(!n)return!1;if(r(n)){const o={role:n.role,color:e.movable.color};ar(e,o,n.key)&&(H(e.movable.events.afterNewPiece,n.role,n.key,{premove:!1,predrop:!0}),t=!0)}return we(e),t}function sr(e){be(e),we(e),V(e)}function hr(e){e.movable.color=e.movable.dests=e.animation.current=void 0,sr(e)}function ke(e,r,n){let t=Math.floor(8*(e[0]-n.left)/n.width);r||(t=7-t);let o=7-Math.floor(8*(e[1]-n.top)/n.height);return r||(o=7-o),t>=0&&t<8&&o>=0&&o<8?Z([t,o]):void 0}function On(e,r,n,t){const o=q(e),a=qr.filter(p=>Br(o[0],o[1],p[0],p[1])||Or(o[0],o[1],p[0],p[1])),f=a.map(p=>Lr(Z(p),n,t)).map(p=>Ie(r,p)),[,v]=f.reduce((p,b,g)=>p[0]<b?p:[b,g],[f[0],0]);return Z(a[v])}function F(e){return e.orientation==="white"}const Gr="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR",Kn={p:"pawn",r:"rook",n:"knight",b:"bishop",q:"queen",k:"king"},$n={pawn:"p",rook:"r",knight:"n",bishop:"b",queen:"q",king:"k"};function Zr(e){e==="start"&&(e=Gr);const r=new Map;let n=7,t=0;for(const o of e)switch(o){case" ":case"[":return r;case"/":if(--n,n<0)return r;t=0;break;case"~":{const a=r.get(Z([t-1,n]));a&&(a.promoted=!0);break}default:{const a=o.charCodeAt(0);if(a<57)t+=a-48;else{const s=o.toLowerCase();r.set(Z([t,n]),{role:Kn[s],color:o===s?"black":"white"}),++t}}}return r}function Bn(e){return wn.map(r=>rr.map(n=>{const t=e.get(n+r);if(t){let o=$n[t.role];return t.color==="white"&&(o=o.toUpperCase()),t.promoted&&(o+="~"),o}else return"1"}).join("")).join("/").replace(/1{2,}/g,r=>r.length.toString())}function Vr(e,r){r.animation&&(ur(e.animation,r.animation),(e.animation.duration||0)<70&&(e.animation.enabled=!1))}function Yr(e,r){var n,t;if(!((n=r.movable)===null||n===void 0)&&n.dests&&(e.movable.dests=void 0),!((t=r.drawable)===null||t===void 0)&&t.autoShapes&&(e.drawable.autoShapes=[]),ur(e,r),r.fen&&(e.pieces=Zr(r.fen),e.drawable.shapes=[]),"check"in r&&An(e,r.check||!1),"lastMove"in r&&!r.lastMove?e.lastMove=void 0:r.lastMove&&(e.lastMove=r.lastMove),e.selected&&zr(e,e.selected),Vr(e,r),!e.movable.rookCastle&&e.movable.dests){const o=e.movable.color==="white"?"1":"8",a="e"+o,s=e.movable.dests.get(a),f=e.pieces.get(a);if(!s||!f||f.role!=="king")return;e.movable.dests.set(a,s.filter(v=>!(v==="a"+o&&s.includes("c"+o))&&!(v==="h"+o&&s.includes("g"+o))))}}function ur(e,r){for(const n in r)vr(e[n])&&vr(r[n])?ur(e[n],r[n]):e[n]=r[n]}function vr(e){return typeof e=="object"}function _e(e,r){return r.animation.enabled?Wn(e,r):he(e,r)}function he(e,r){const n=e(r);return r.dom.redraw(),n}function ze(e,r){return{key:e,pos:q(e),piece:r}}function Un(e,r){return r.sort((n,t)=>Ie(e.pos,n.pos)-Ie(e.pos,t.pos))[0]}function Qn(e,r){const n=new Map,t=[],o=new Map,a=[],s=[],f=new Map;let v,p,b;for(const[g,A]of e)f.set(g,ze(g,A));for(const g of tr)v=r.pieces.get(g),p=f.get(g),v?p?Xe(v,p.piece)||(a.push(p),s.push(ze(g,v))):s.push(ze(g,v)):p&&a.push(p);for(const g of s)p=Un(g,a.filter(A=>Xe(g.piece,A.piece))),p&&(b=[p.pos[0]-g.pos[0],p.pos[1]-g.pos[1]],n.set(g.key,b.concat(b)),t.push(p.key));for(const g of a)t.includes(g.key)||o.set(g.key,g.piece);return{anims:n,fadings:o}}function Xr(e,r){const n=e.animation.current;if(n===void 0){e.dom.destroyed||e.dom.redrawNow();return}const t=1-(r-n.start)*n.frequency;if(t<=0)e.animation.current=void 0,e.dom.redrawNow();else{const o=Hn(t);for(const a of n.plan.anims.values())a[2]=a[0]*o,a[3]=a[1]*o;e.dom.redrawNow(!0),requestAnimationFrame((a=performance.now())=>Xr(e,a))}}function Wn(e,r){const n=new Map(r.pieces),t=e(r),o=Qn(n,r);if(o.anims.size||o.fadings.size){const a=r.animation.current&&r.animation.current.start;r.animation.current={start:performance.now(),frequency:1/r.animation.duration,plan:o},a||Xr(r,performance.now())}else r.dom.redraw();return t}function Hn(e){return e<.5?4*e*e*e:(e-1)*(2*e-2)*(2*e-2)+1}const Fn=["green","red","blue","yellow"];function zn(e,r){if(r.touches&&r.touches.length>1)return;r.stopPropagation(),r.preventDefault(),r.ctrlKey?V(e):sr(e);const n=Ce(r),t=ke(n,F(e),e.dom.bounds());!t||(e.drawable.current={orig:t,pos:n,brush:Vn(r),snapToValidMove:e.drawable.defaultSnapToValidMove},Jr(e))}function Jr(e){requestAnimationFrame(()=>{const r=e.drawable.current;if(r){const n=ke(r.pos,F(e),e.dom.bounds());n||(r.snapToValidMove=!1);const t=r.snapToValidMove?On(r.orig,r.pos,F(e),e.dom.bounds()):n;t!==r.mouseSq&&(r.mouseSq=t,r.dest=t!==r.orig?t:void 0,e.dom.redrawNow()),Jr(e)}})}function jn(e,r){e.drawable.current&&(e.drawable.current.pos=Ce(r))}function Gn(e){const r=e.drawable.current;r&&(r.mouseSq&&Yn(e.drawable,r),en(e))}function en(e){e.drawable.current&&(e.drawable.current=void 0,e.dom.redraw())}function Zn(e){e.drawable.shapes.length&&(e.drawable.shapes=[],e.dom.redraw(),rn(e.drawable))}function Vn(e){var r;const n=(e.shiftKey||e.ctrlKey)&&Dr(e),t=e.altKey||e.metaKey||((r=e.getModifierState)===null||r===void 0?void 0:r.call(e,"AltGraph"));return Fn[(n?1:0)+(t?2:0)]}function Yn(e,r){const n=o=>o.orig===r.orig&&o.dest===r.dest,t=e.shapes.find(n);t&&(e.shapes=e.shapes.filter(o=>!n(o))),(!t||t.brush!==r.brush)&&e.shapes.push(r),rn(e)}function rn(e){e.onChange&&e.onChange(e.shapes)}function Xn(e,r){if(!r.isTrusted||r.button!==void 0&&r.button!==0||r.touches&&r.touches.length>1)return;const n=e.dom.bounds(),t=Ce(r),o=ke(t,F(e),n);if(!o)return;const a=e.pieces.get(o),s=e.selected;!s&&e.drawable.enabled&&(e.drawable.eraseOnClick||!a||a.color!==e.turnColor)&&Zn(e),r.cancelable!==!1&&(!r.touches||e.blockTouchScroll||a||s||Jn(e,t))&&r.preventDefault();const f=!!e.premovable.current,v=!!e.predroppable.current;e.stats.ctrlKey=r.ctrlKey,e.selected&&lr(e,e.selected,o)?_e(g=>Je(g,o),e):Je(e,o);const p=e.selected===o,b=tn(e,o);if(a&&b&&p&&In(e,o)){e.draggable.current={orig:o,piece:a,origPos:t,pos:t,started:e.draggable.autoDistance&&e.stats.dragged,element:b,previouslySelected:s,originTarget:r.target,keyHasChanged:!1},b.cgDragging=!0,b.classList.add("dragging");const g=e.dom.elements.ghost;g&&(g.className=`ghost ${a.color} ${a.role}`,oe(g,Le(n)(q(o),F(e))),ir(g,!0)),fr(e)}else f&&be(e),v&&we(e);e.dom.redraw()}function Jn(e,r){const n=F(e),t=e.dom.bounds(),o=Math.pow(t.width/8,2);for(const a of e.pieces.keys()){const s=Lr(a,n,t);if(Ie(s,r)<=o)return!0}return!1}function et(e,r,n,t){const o="a0";e.pieces.set(o,r),e.dom.redraw();const a=Ce(n);e.draggable.current={orig:o,piece:r,origPos:a,pos:a,started:!0,element:()=>tn(e,o),originTarget:n.target,newPiece:!0,force:!!t,keyHasChanged:!1},fr(e)}function fr(e){requestAnimationFrame(()=>{var r;const n=e.draggable.current;if(!n)return;!((r=e.animation.current)===null||r===void 0)&&r.plan.anims.has(n.orig)&&(e.animation.current=void 0);const t=e.pieces.get(n.orig);if(!t||!Xe(t,n.piece))Ue(e);else if(!n.started&&Ie(n.pos,n.origPos)>=Math.pow(e.draggable.distance,2)&&(n.started=!0),n.started){if(typeof n.element=="function"){const a=n.element();if(!a)return;a.cgDragging=!0,a.classList.add("dragging"),n.element=a}const o=e.dom.bounds();oe(n.element,[n.pos[0]-o.left-o.width/16,n.pos[1]-o.top-o.height/16]),n.keyHasChanged||(n.keyHasChanged=n.orig!==ke(n.pos,F(e),o))}fr(e)})}function rt(e,r){e.draggable.current&&(!r.touches||r.touches.length<2)&&(e.draggable.current.pos=Ce(r))}function nt(e,r){const n=e.draggable.current;if(!n)return;if(r.type==="touchend"&&r.cancelable!==!1&&r.preventDefault(),r.type==="touchend"&&n.originTarget!==r.target&&!n.newPiece){e.draggable.current=void 0;return}be(e),we(e);const t=Ce(r)||n.pos,o=ke(t,F(e),e.dom.bounds());o&&n.started&&n.orig!==o?n.newPiece?Fr(e,n.orig,o,n.force):(e.stats.ctrlKey=r.ctrlKey,Hr(e,n.orig,o)&&(e.stats.dragged=!0)):n.newPiece?e.pieces.delete(n.orig):e.draggable.deleteOnDropOff&&!o&&(e.pieces.delete(n.orig),H(e.events.change)),(n.orig===n.previouslySelected||n.keyHasChanged)&&(n.orig===o||!o)?V(e):e.selectable.enabled||V(e),nn(e),e.draggable.current=void 0,e.dom.redraw()}function Ue(e){const r=e.draggable.current;r&&(r.newPiece&&e.pieces.delete(r.orig),e.draggable.current=void 0,V(e),nn(e),e.dom.redraw())}function nn(e){const r=e.dom.elements;r.ghost&&ir(r.ghost,!1)}function tn(e,r){let n=e.dom.elements.board.firstChild;for(;n;){if(n.cgKey===r&&n.tagName==="PIECE")return n;n=n.nextSibling}}function tt(e,r){e.exploding={stage:1,keys:r},e.dom.redraw(),setTimeout(()=>{gr(e,2),setTimeout(()=>gr(e,void 0),120)},120)}function gr(e,r){e.exploding&&(r?e.exploding.stage=r:e.exploding=void 0,e.dom.redraw())}function ot(e,r){function n(){Pn(e),r()}return{set(t){t.orientation&&t.orientation!==e.orientation&&n(),Vr(e,t),(t.fen?_e:he)(o=>Yr(o,t),e)},state:e,getFen:()=>Bn(e.pieces),toggleOrientation:n,setPieces(t){_e(o=>En(o,t),e)},selectSquare(t,o){t?_e(a=>Je(a,t,o),e):e.selected&&(V(e),e.dom.redraw())},move(t,o){_e(a=>Qr(a,t,o),e)},newPiece(t,o){_e(a=>ar(a,t,o),e)},playPremove(){if(e.premovable.current){if(_e(Dn,e))return!0;e.dom.redraw()}return!1},playPredrop(t){if(e.predroppable.current){const o=Ln(e,t);return e.dom.redraw(),o}return!1},cancelPremove(){he(be,e)},cancelPredrop(){he(we,e)},cancelMove(){he(t=>{sr(t),Ue(t)},e)},stop(){he(t=>{hr(t),Ue(t)},e)},explode(t){tt(e,t)},setAutoShapes(t){he(o=>o.drawable.autoShapes=t,e)},setShapes(t){he(o=>o.drawable.shapes=t,e)},getKeyAtDomPos(t){return ke(t,F(e),e.dom.bounds())},redrawAll:r,dragNewPiece(t,o,a){et(e,t,o,a)},destroy(){hr(e),e.dom.unbind&&e.dom.unbind(),e.dom.destroyed=!0}}}function it(){return{pieces:Zr(Gr),orientation:"white",turnColor:"white",coordinates:!0,ranksPosition:"right",autoCastle:!0,viewOnly:!1,disableContextMenu:!1,addPieceZIndex:!1,addDimensionsCssVars:!1,blockTouchScroll:!1,pieceKey:!1,highlight:{lastMove:!0,check:!0},animation:{enabled:!0,duration:200},movable:{free:!0,color:"both",showDests:!0,events:{},rookCastle:!0},premovable:{enabled:!0,showDests:!0,castle:!0,events:{}},predroppable:{enabled:!1,events:{}},draggable:{enabled:!0,distance:3,autoDistance:!0,showGhost:!0,deleteOnDropOff:!1},dropmode:{active:!1},selectable:{enabled:!0},stats:{dragged:!("ontouchstart"in window)},events:{},drawable:{enabled:!0,visible:!0,defaultSnapToValidMove:!0,eraseOnClick:!0,shapes:[],autoShapes:[],brushes:{green:{key:"g",color:"#15781B",opacity:1,lineWidth:10},red:{key:"r",color:"#882020",opacity:1,lineWidth:10},blue:{key:"b",color:"#003088",opacity:1,lineWidth:10},yellow:{key:"y",color:"#e68f00",opacity:1,lineWidth:10},paleBlue:{key:"pb",color:"#003088",opacity:.4,lineWidth:15},paleGreen:{key:"pg",color:"#15781B",opacity:.4,lineWidth:15},paleRed:{key:"pr",color:"#882020",opacity:.4,lineWidth:15},paleGrey:{key:"pgr",color:"#4a4a4a",opacity:.35,lineWidth:15}},prevSvgHash:""},hold:_n()}}function er(e,r,n){const t=new Map,o=[];for(const f of e)t.set(f.hash,!1);let a=r.firstChild,s;for(;a;)s=a.getAttribute("cgHash"),t.has(s)?t.set(s,!0):o.push(a),a=a.nextSibling;for(const f of o)r.removeChild(f);for(const f of e)t.get(f.hash)||r.appendChild(n(f))}function ee(e){return document.createElementNS("http://www.w3.org/2000/svg",e)}function at(e,r,n){const t=e.drawable,o=t.current,a=o&&o.mouseSq?o:void 0,s=new Map,f=e.dom.bounds(),v=t.autoShapes.filter(w=>!w.piece);for(const w of t.shapes.concat(v).concat(a?[a]:[]))w.dest&&s.set(w.dest,(s.get(w.dest)||0)+1);const p=t.shapes.concat(v).map(w=>({shape:w,current:!1,hash:mr(w,s,!1,f)}));a&&p.push({shape:a,current:!0,hash:mr(a,s,!0,f)});const b=p.map(w=>w.hash).join(";");if(b===e.drawable.prevSvgHash)return;e.drawable.prevSvgHash=b;const g=r.querySelector("defs"),A=r.querySelector("g"),I=n.querySelector("g");lt(t,p,g),er(p.filter(w=>!w.shape.customSvg),A,w=>br(e,w,t.brushes,s,f)),er(p.filter(w=>w.shape.customSvg),I,w=>br(e,w,t.brushes,s,f))}function lt(e,r,n){const t=new Map;let o;for(const f of r)f.shape.dest&&(o=e.brushes[f.shape.brush],f.shape.modifiers&&(o=on(o,f.shape.modifiers)),t.set(o.key,o));const a=new Set;let s=n.firstChild;for(;s;)a.add(s.getAttribute("cgKey")),s=s.nextSibling;for(const[f,v]of t.entries())a.has(f)||n.appendChild(ht(v))}function mr({orig:e,dest:r,brush:n,piece:t,modifiers:o,customSvg:a},s,f,v){return[v.width,v.height,f,e,r,n,r&&(s.get(r)||0)>1,t&&ct(t),o&&st(o),a&&ut(a)].filter(p=>p).join(",")}function ct(e){return[e.color,e.role,e.scale].filter(r=>r).join(",")}function st(e){return""+(e.lineWidth||"")}function ut(e){let r=0;for(let n=0;n<e.length;n++)r=(r<<5)-r+e.charCodeAt(n)>>>0;return"custom-"+r.toString()}function br(e,{shape:r,current:n,hash:t},o,a,s){let f;const v=wr(q(r.orig),e.orientation);if(r.customSvg)f=ft(r.customSvg,v,s);else if(r.dest){let p=o[r.brush];r.modifiers&&(p=on(p,r.modifiers)),f=pt(p,v,wr(q(r.dest),e.orientation),n,(a.get(r.dest)||0)>1,s)}else f=dt(o[r.brush],v,n,s);return f.setAttribute("cgHash",t),f}function ft(e,r,n){const[t,o]=Qe(r,n),a=me(ee("g"),{transform:`translate(${t},${o})`}),s=me(ee("svg"),{width:1,height:1,viewBox:"0 0 100 100"});return a.appendChild(s),s.innerHTML=e,a}function dt(e,r,n,t){const o=Qe(r,t),a=vt(),s=(t.width+t.height)/(4*Math.max(t.width,t.height));return me(ee("circle"),{stroke:e.color,"stroke-width":a[n?0:1],fill:"none",opacity:an(e,n),cx:o[0],cy:o[1],r:s-a[1]/2})}function pt(e,r,n,t,o,a){const s=mt(o&&!t),f=Qe(r,a),v=Qe(n,a),p=v[0]-f[0],b=v[1]-f[1],g=Math.atan2(b,p),A=Math.cos(g)*s,I=Math.sin(g)*s;return me(ee("line"),{stroke:e.color,"stroke-width":gt(e,t),"stroke-linecap":"round","marker-end":"url(#arrowhead-"+e.key+")",opacity:an(e,t),x1:f[0],y1:f[1],x2:v[0]-A,y2:v[1]-I})}function ht(e){const r=me(ee("marker"),{id:"arrowhead-"+e.key,orient:"auto",markerWidth:4,markerHeight:8,refX:2.05,refY:2.01});return r.appendChild(me(ee("path"),{d:"M0,0 V4 L3,2 Z",fill:e.color})),r.setAttribute("cgKey",e.key),r}function me(e,r){for(const n in r)e.setAttribute(n,r[n]);return e}function wr(e,r){return r==="white"?e:[7-e[0],7-e[1]]}function on(e,r){return{color:e.color,opacity:Math.round(e.opacity*10)/10,lineWidth:Math.round(r.lineWidth||e.lineWidth),key:[e.key,r.lineWidth].filter(n=>n).join("")}}function vt(){return[3/64,4/64]}function gt(e,r){return(e.lineWidth||10)*(r?.85:1)/64}function an(e,r){return(e.opacity||1)*(r?.9:1)}function mt(e){return(e?20:10)/64}function Qe(e,r){const n=Math.min(1,r.width/r.height),t=Math.min(1,r.height/r.width);return[(e[0]-3.5)*n,(3.5-e[1])*t]}function bt(e,r){e.innerHTML="",e.classList.add("cg-wrap");for(const v of bn)e.classList.toggle("orientation-"+v,r.orientation===v);e.classList.toggle("manipulable",!r.viewOnly);const n=le("cg-container");e.appendChild(n);const t=le("cg-board");n.appendChild(t);let o,a,s;if(r.drawable.visible&&(o=me(ee("svg"),{class:"cg-shapes",viewBox:"-4 -4 8 8",preserveAspectRatio:"xMidYMid slice"}),o.appendChild(ee("defs")),o.appendChild(ee("g")),a=me(ee("svg"),{class:"cg-custom-svgs",viewBox:"-3.5 -3.5 8 8",preserveAspectRatio:"xMidYMid slice"}),a.appendChild(ee("g")),s=le("cg-auto-pieces"),n.appendChild(o),n.appendChild(a),n.appendChild(s)),r.coordinates){const v=r.orientation==="black"?" black":"",p=r.ranksPosition==="left"?" left":"";n.appendChild(yr(nr,"ranks"+v+p)),n.appendChild(yr(rr,"files"+v))}let f;return r.draggable.showGhost&&(f=le("piece","ghost"),ir(f,!1),n.appendChild(f)),{board:t,container:n,wrap:e,ghost:f,svg:o,customSvg:a,autoPieces:s}}function yr(e,r){const n=le("coords",r);let t;for(const o of e)t=le("coord"),t.textContent=o,n.appendChild(t);return n}function wt(e,r){if(!e.dropmode.active)return;be(e),we(e);const n=e.dropmode.piece;if(n){e.pieces.set("a0",n);const t=Ce(r),o=t&&ke(t,F(e),e.dom.bounds());o&&Fr(e,"a0",o)}e.dom.redraw()}function yt(e,r){const n=e.dom.elements.board;if("ResizeObserver"in window&&new ResizeObserver(r).observe(e.dom.elements.wrap),e.viewOnly)return;const t=St(e);n.addEventListener("touchstart",t,{passive:!1}),n.addEventListener("mousedown",t,{passive:!1}),(e.disableContextMenu||e.drawable.enabled)&&n.addEventListener("contextmenu",o=>o.preventDefault())}function _t(e,r){const n=[];if("ResizeObserver"in window||n.push(xe(document.body,"chessground.resize",r)),!e.viewOnly){const t=_r(e,rt,jn),o=_r(e,nt,Gn);for(const s of["touchmove","mousemove"])n.push(xe(document,s,t));for(const s of["touchend","mouseup"])n.push(xe(document,s,o));const a=()=>e.dom.bounds.clear();n.push(xe(document,"scroll",a,{capture:!0,passive:!0})),n.push(xe(window,"resize",a,{passive:!0}))}return()=>n.forEach(t=>t())}function xe(e,r,n,t){return e.addEventListener(r,n,t),()=>e.removeEventListener(r,n,t)}function St(e){return r=>{e.draggable.current?Ue(e):e.drawable.current?en(e):r.shiftKey||Dr(r)?e.drawable.enabled&&zn(e,r):e.viewOnly||(e.dropmode.active?wt(e,r):Xn(e,r))}}function _r(e,r,n){return t=>{e.drawable.current?e.drawable.enabled&&n(e,t):e.viewOnly||r(e,t)}}function Ct(e){const r=F(e),n=Le(e.dom.bounds()),t=e.dom.elements.board,o=e.pieces,a=e.animation.current,s=a?a.plan.anims:new Map,f=a?a.plan.fadings:new Map,v=e.draggable.current,p=Pt(e),b=new Set,g=new Set,A=new Map,I=new Map;let w,S,D,re,L,ce,Pe,G,Ee,K;for(S=t.firstChild;S;){if(w=S.cgKey,ln(S))if(D=o.get(w),L=s.get(w),ce=f.get(w),re=S.cgPiece,S.cgDragging&&(!v||v.orig!==w)&&(S.classList.remove("dragging"),oe(S,n(q(w),r)),S.cgDragging=!1),!ce&&S.cgFading&&(S.cgFading=!1,S.classList.remove("fading")),D){if(L&&S.cgAnimating&&re===Ne(D)){const T=q(w);T[0]+=L[2],T[1]+=L[3],S.classList.add("anim"),oe(S,n(T,r))}else S.cgAnimating&&(S.cgAnimating=!1,S.classList.remove("anim"),oe(S,n(q(w),r)),e.addPieceZIndex&&(S.style.zIndex=je(q(w),r)));re===Ne(D)&&(!ce||!S.cgFading)?b.add(w):ce&&re===Ne(ce)?(S.classList.add("fading"),S.cgFading=!0):Ge(A,re,S)}else Ge(A,re,S);else if(cn(S)){const T=S.className;p.get(w)===T?g.add(w):Ge(I,T,S)}S=S.nextSibling}for(const[T,z]of p)if(!g.has(T)){Ee=I.get(z),K=Ee&&Ee.pop();const U=n(q(T),r);if(K)K.cgKey=T,oe(K,U);else{const $=le("square",z);$.cgKey=T,oe($,U),t.insertBefore($,t.firstChild)}}for(const[T,z]of o)if(L=s.get(T),!b.has(T))if(Pe=A.get(Ne(z)),G=Pe&&Pe.pop(),G){G.cgKey=T,G.cgFading&&(G.classList.remove("fading"),G.cgFading=!1);const U=q(T);e.addPieceZIndex&&(G.style.zIndex=je(U,r)),L&&(G.cgAnimating=!0,G.classList.add("anim"),U[0]+=L[2],U[1]+=L[3]),oe(G,n(U,r))}else{const U=Ne(z),$=le("piece",U),se=q(T);$.cgPiece=U,$.cgKey=T,L&&($.cgAnimating=!0,se[0]+=L[2],se[1]+=L[3]),oe($,n(se,r)),e.addPieceZIndex&&($.style.zIndex=je(se,r)),t.appendChild($)}for(const T of A.values())Cr(e,T);for(const T of I.values())Cr(e,T)}function kt(e){const r=F(e),n=Le(e.dom.bounds());let t=e.dom.elements.board.firstChild;for(;t;)(ln(t)&&!t.cgAnimating||cn(t))&&oe(t,n(q(t.cgKey),r)),t=t.nextSibling}function Sr(e){const r=e.dom.elements.wrap.getBoundingClientRect(),n=e.dom.elements.container,t=r.height/r.width,o=Math.floor(r.width*window.devicePixelRatio/8)*8/window.devicePixelRatio,a=o*t;n.style.width=o+"px",n.style.height=a+"px",e.dom.bounds.clear(),e.addDimensionsCssVars&&(document.documentElement.style.setProperty("--cg-width",o+"px"),document.documentElement.style.setProperty("--cg-height",a+"px"))}function ln(e){return e.tagName==="PIECE"}function cn(e){return e.tagName==="SQUARE"}function Cr(e,r){for(const n of r)e.dom.elements.board.removeChild(n)}function je(e,r){const t=e[1];return`${r?3+7-t:3+t}`}function Ne(e){return`${e.color} ${e.role}`}function Pt(e){var r;const n=new Map;if(e.lastMove&&e.highlight.lastMove)for(const a of e.lastMove)de(n,a,"last-move");if(e.check&&e.highlight.check&&de(n,e.check,"check"),e.selected&&(de(n,e.selected,"selected"),e.movable.showDests)){const a=(r=e.movable.dests)===null||r===void 0?void 0:r.get(e.selected);if(a)for(const f of a)de(n,f,"move-dest"+(e.pieces.has(f)?" oc":""));const s=e.premovable.dests;if(s)for(const f of s)de(n,f,"premove-dest"+(e.pieces.has(f)?" oc":""))}const t=e.premovable.current;if(t)for(const a of t)de(n,a,"current-premove");else e.predroppable.current&&de(n,e.predroppable.current.key,"current-premove");const o=e.exploding;if(o)for(const a of o.keys)de(n,a,"exploding"+o.stage);return n}function de(e,r,n){const t=e.get(r);t?e.set(r,`${t} ${n}`):e.set(r,n)}function Ge(e,r,n){const t=e.get(r);t?t.push(n):e.set(r,[n])}function Et(e,r){const t=e.drawable.autoShapes.filter(o=>o.piece).map(o=>({shape:o,hash:Mt(o),current:!1}));er(t,r,o=>Tt(e,o,e.dom.bounds()))}function At(e){var r;const n=F(e),t=Le(e.dom.bounds());let o=(r=e.dom.elements.autoPieces)===null||r===void 0?void 0:r.firstChild;for(;o;)Ir(o,t(q(o.cgKey),n),o.cgScale),o=o.nextSibling}function Tt(e,{shape:r,hash:n},t){var o,a,s;const f=r.orig,v=(o=r.piece)===null||o===void 0?void 0:o.role,p=(a=r.piece)===null||a===void 0?void 0:a.color,b=(s=r.piece)===null||s===void 0?void 0:s.scale,g=le("piece",`${v} ${p}`);return g.setAttribute("cgHash",n),g.cgKey=f,g.cgScale=b,Ir(g,Le(t)(q(f),F(e)),b),g}function Mt(e){var r,n,t;return[e.orig,(r=e.piece)===null||r===void 0?void 0:r.role,(n=e.piece)===null||n===void 0?void 0:n.color,(t=e.piece)===null||t===void 0?void 0:t.scale].join(",")}function Rt(e,r){const n=it();Yr(n,r||{});function t(){const o="dom"in n?n.dom.unbind:void 0,a=bt(e,n),s=yn(()=>a.board.getBoundingClientRect()),f=b=>{Ct(p),a.autoPieces&&Et(p,a.autoPieces),!b&&a.svg&&at(p,a.svg,a.customSvg)},v=()=>{Sr(p),kt(p),a.autoPieces&&At(p)},p=n;return p.dom={elements:a,bounds:s,redraw:xt(f),redrawNow:f,unbind:o},p.drawable.prevSvgHash="",Sr(p),f(!1),yt(p,v),o||(p.dom.unbind=_t(p,v)),p.events.insert&&p.events.insert(a),p}return ot(t(),t)}function xt(e){let r=!1;return()=>{r||(r=!0,requestAnimationFrame(()=>{e(),r=!1}))}}const Nt=Mr({props:{config:null},emits:["ready"],setup(e,{emit:r}){const{config:n}=e;let t=dn(null);function o(){let{value:a}=t;if(a){let s=a.parentElement;s.removeChild(a);let{width:f,height:v}=s.getBoundingClientRect();a.style.width=Math.min(f,v)+"px",a.style.height=Math.min(f,v)+"px",s.appendChild(a)}}return pn(()=>{if(t.value){o(),window.addEventListener("resize",o);let a=Rt(t.value,n);r("ready",a)}}),hn(()=>{window.removeEventListener("resize",o)}),(a,s)=>(Rr(),xr(gn,{"explicit-height":"",flexbox:""},{nav:Ye(()=>[Nr(a.$slots,"nav",{},void 0,!0)]),default:Ye(()=>[vn("div",{ref_key:"boardEl",ref:t,class:"chessboard"},null,512)]),_:3}))}});var qt=fn(Nt,[["__scopeId","data-v-7122605e"]]);const It="pnbrqkPNBRQK",Ze="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1",Dt=["1-0","0-1","1/2-1/2","*"],Ve={b:[16,32,17,15],w:[-16,-32,-17,-15]},kr={n:[-18,-33,-31,-14,18,33,31,14],b:[-17,-15,17,15],r:[-16,1,16,-1],q:[-17,-16,-15,1,17,16,15,-1],k:[-17,-16,-15,1,17,16,15,-1]},Lt=[20,0,0,0,0,0,0,24,0,0,0,0,0,0,20,0,0,20,0,0,0,0,0,24,0,0,0,0,0,20,0,0,0,0,20,0,0,0,0,24,0,0,0,0,20,0,0,0,0,0,0,20,0,0,0,24,0,0,0,20,0,0,0,0,0,0,0,0,20,0,0,24,0,0,20,0,0,0,0,0,0,0,0,0,0,20,2,24,2,20,0,0,0,0,0,0,0,0,0,0,0,2,53,56,53,2,0,0,0,0,0,0,24,24,24,24,24,24,56,0,56,24,24,24,24,24,24,0,0,0,0,0,0,2,53,56,53,2,0,0,0,0,0,0,0,0,0,0,0,20,2,24,2,20,0,0,0,0,0,0,0,0,0,0,20,0,0,24,0,0,20,0,0,0,0,0,0,0,0,20,0,0,0,24,0,0,0,20,0,0,0,0,0,0,20,0,0,0,0,24,0,0,0,0,20,0,0,0,0,20,0,0,0,0,0,24,0,0,0,0,0,20,0,0,20,0,0,0,0,0,0,24,0,0,0,0,0,0,20],Ot=[17,0,0,0,0,0,0,16,0,0,0,0,0,0,15,0,0,17,0,0,0,0,0,16,0,0,0,0,0,15,0,0,0,0,17,0,0,0,0,16,0,0,0,0,15,0,0,0,0,0,0,17,0,0,0,16,0,0,0,15,0,0,0,0,0,0,0,0,17,0,0,16,0,0,15,0,0,0,0,0,0,0,0,0,0,17,0,16,0,15,0,0,0,0,0,0,0,0,0,0,0,0,17,16,15,0,0,0,0,0,0,0,1,1,1,1,1,1,1,0,-1,-1,-1,-1,-1,-1,-1,0,0,0,0,0,0,0,-15,-16,-17,0,0,0,0,0,0,0,0,0,0,0,0,-15,0,-16,0,-17,0,0,0,0,0,0,0,0,0,0,-15,0,0,-16,0,0,-17,0,0,0,0,0,0,0,0,-15,0,0,0,-16,0,0,0,-17,0,0,0,0,0,0,-15,0,0,0,0,-16,0,0,0,0,-17,0,0,0,0,-15,0,0,0,0,0,-16,0,0,0,0,0,-17,0,0,-15,0,0,0,0,0,0,-16,0,0,0,0,0,0,-17],Kt={p:0,n:1,b:2,r:3,q:4,k:5},y={NORMAL:1,CAPTURE:2,BIG_PAWN:4,EP_CAPTURE:8,PROMOTION:16,KSIDE_CASTLE:32,QSIDE_CASTLE:64},$t=7,Bt=6,Ut=1,Qt=0,P={a8:0,b8:1,c8:2,d8:3,e8:4,f8:5,g8:6,h8:7,a7:16,b7:17,c7:18,d7:19,e7:20,f7:21,g7:22,h7:23,a6:32,b6:33,c6:34,d6:35,e6:36,f6:37,g6:38,h6:39,a5:48,b5:49,c5:50,d5:51,e5:52,f5:53,g5:54,h5:55,a4:64,b4:65,c4:66,d4:67,e4:68,f4:69,g4:70,h4:71,a3:80,b3:81,c3:82,d3:83,e3:84,f3:85,g3:86,h3:87,a2:96,b2:97,c2:98,d2:99,e2:100,f2:101,g2:102,h2:103,a1:112,b1:113,c1:114,d1:115,e1:116,f1:117,g1:118,h1:119},pe={w:[{square:P.a1,flag:y.QSIDE_CASTLE},{square:P.h1,flag:y.KSIDE_CASTLE}],b:[{square:P.a8,flag:y.QSIDE_CASTLE},{square:P.h8,flag:y.KSIDE_CASTLE}]},Wt=0,Pr=1;function Ht(e,r){for(var n=e.from,t=e.to,o=e.piece,a=0,s=0,f=0,v=0,p=r.length;v<p;v++){var b=r[v].from,g=r[v].to,A=r[v].piece;o===A&&n!==b&&t===g&&(a++,ge(n)===ge(b)&&s++,De(n)===De(b)&&f++)}return a>0?s>0&&f>0?W(n):f>0?W(n).charAt(1):W(n).charAt(0):""}function Ft(e){var r=e.charAt(0);if(r>="a"&&r<="h"){var n=e.match(/[a-h]\d.*[a-h]\d/);return n?void 0:ne}return r=r.toLowerCase(),r==="o"?Me:r}function Er(e){return e.replace(/=/,"").replace(/[+#]?[?!]*$/,"")}function ge(e){return e>>4}function De(e){return e&15}function W(e){var r=De(e),n=ge(e);return"abcdefgh".substring(r,r+1)+"87654321".substring(n,n+1)}function qe(e){return e===te?ve:te}function zt(e){return"0123456789".indexOf(e)!==-1}function sn(e){var r=e instanceof Array?[]:{};for(var n in e)typeof n=="object"?r[n]=sn(e[n]):r[n]=e[n];return r}function Ar(e){return e.replace(/^\s+|\s+$/g,"")}const ve="b",te="w",J=-1,ne="p",Tr="n",Be="b",jt="r",Gt="q",Me="k",Zt=function(){for(var e=[],r=P.a8;r<=P.h1;r++){if(r&136){r+=7;continue}e.push(W(r))}return e}(),Vt={NORMAL:"n",CAPTURE:"c",BIG_PAWN:"b",EP_CAPTURE:"e",PROMOTION:"p",KSIDE_CASTLE:"k",QSIDE_CASTLE:"q"},Yt=function(e){var r=new Array(128),n={w:J,b:J},t=te,o={w:0,b:0},a=J,s=0,f=1,v=[],p={},b={};w(typeof e=="undefined"?Ze:e);function g(i){typeof i=="undefined"&&(i=!1),r=new Array(128),n={w:J,b:J},t=te,o={w:0,b:0},a=J,s=0,f=1,v=[],i||(p={}),b={},L(D())}function A(){for(var i=[],l={},c=function(u){u in b&&(l[u]=b[u])};v.length>0;)i.push(ue());for(c(D());i.length>0;)ie(i.pop()),c(D());b=l}function I(){w(Ze)}function w(i,l){typeof l=="undefined"&&(l=!1);var c=i.split(/\s+/),u=c[0],h=0;if(!S(i).valid)return!1;g(l);for(var d=0;d<u.length;d++){var m=u.charAt(d);if(m==="/")h+=8;else if(zt(m))h+=parseInt(m,10);else{var C=m<"a"?te:ve;Pe({type:m.toLowerCase(),color:C},W(h)),h++}}return t=c[1],c[2].indexOf("K")>-1&&(o.w|=y.KSIDE_CASTLE),c[2].indexOf("Q")>-1&&(o.w|=y.QSIDE_CASTLE),c[2].indexOf("k")>-1&&(o.b|=y.KSIDE_CASTLE),c[2].indexOf("q")>-1&&(o.b|=y.QSIDE_CASTLE),a=c[3]==="-"?J:P[c[3]],s=parseInt(c[4],10),f=parseInt(c[5],10),L(D()),!0}function S(i){var l={0:"No errors.",1:"FEN string must contain six space-delimited fields.",2:"6th field (move number) must be a positive integer.",3:"5th field (half move counter) must be a non-negative integer.",4:"4th field (en-passant square) is invalid.",5:"3rd field (castling availability) is invalid.",6:"2nd field (side to move) is invalid.",7:"1st field (piece positions) does not contain 8 '/'-delimited rows.",8:"1st field (piece positions) is invalid [consecutive numbers].",9:"1st field (piece positions) is invalid [invalid piece].",10:"1st field (piece positions) is invalid [row too large].",11:"Illegal en-passant square"},c=i.split(/\s+/);if(c.length!==6)return{valid:!1,error_number:1,error:l[1]};if(isNaN(c[5])||parseInt(c[5],10)<=0)return{valid:!1,error_number:2,error:l[2]};if(isNaN(c[4])||parseInt(c[4],10)<0)return{valid:!1,error_number:3,error:l[3]};if(!/^(-|[abcdefgh][36])$/.test(c[3]))return{valid:!1,error_number:4,error:l[4]};if(!/^(KQ?k?q?|Qk?q?|kq?|q|-)$/.test(c[2]))return{valid:!1,error_number:5,error:l[5]};if(!/^(w|b)$/.test(c[1]))return{valid:!1,error_number:6,error:l[6]};var u=c[0].split("/");if(u.length!==8)return{valid:!1,error_number:7,error:l[7]};for(var h=0;h<u.length;h++){for(var d=0,m=!1,C=0;C<u[h].length;C++)if(isNaN(u[h][C])){if(!/^[prnbqkPRNBQK]$/.test(u[h][C]))return{valid:!1,error_number:9,error:l[9]};d+=1,m=!1}else{if(m)return{valid:!1,error_number:8,error:l[8]};d+=parseInt(u[h][C],10),m=!0}if(d!==8)return{valid:!1,error_number:10,error:l[10]}}return c[3][1]=="3"&&c[1]=="w"||c[3][1]=="6"&&c[1]=="b"?{valid:!1,error_number:11,error:l[11]}:{valid:!0,error_number:0,error:l[0]}}function D(){for(var i=0,l="",c=P.a8;c<=P.h1;c++){if(r[c]==null)i++;else{i>0&&(l+=i,i=0);var u=r[c].color,h=r[c].type;l+=u===te?h.toUpperCase():h.toLowerCase()}c+1&136&&(i>0&&(l+=i),c!==P.h1&&(l+="/"),i=0,c+=8)}var d="";o[te]&y.KSIDE_CASTLE&&(d+="K"),o[te]&y.QSIDE_CASTLE&&(d+="Q"),o[ve]&y.KSIDE_CASTLE&&(d+="k"),o[ve]&y.QSIDE_CASTLE&&(d+="q"),d=d||"-";var m=a===J?"-":W(a);return[l,t,d,m,s,f].join(" ")}function re(i){for(var l=0;l<i.length;l+=2)typeof i[l]=="string"&&typeof i[l+1]=="string"&&(p[i[l]]=i[l+1]);return p}function L(i){v.length>0||(i!==Ze?(p.SetUp="1",p.FEN=i):(delete p.SetUp,delete p.FEN))}function ce(i){var l=r[P[i]];return l?{type:l.type,color:l.color}:null}function Pe(i,l){if(!("type"in i&&"color"in i)||It.indexOf(i.type.toLowerCase())===-1||!(l in P))return!1;var c=P[l];return i.type==Me&&!(n[i.color]==J||n[i.color]==c)?!1:(r[c]={type:i.type,color:i.color},i.type===Me&&(n[i.color]=c),L(D()),!0)}function G(i){var l=ce(i);return r[P[i]]=null,l&&l.type===Me&&(n[l.color]=J),L(D()),l}function Ee(i,l,c,u,h){var d={color:t,from:l,to:c,flags:u,piece:i[l].type};return h&&(d.flags|=y.PROMOTION,d.promotion=h),i[c]?d.captured=i[c].type:u&y.EP_CAPTURE&&(d.captured=ne),d}function K(i){function l(Ae,x,Q,fe,Re){if(Ae[Q].type===ne&&(ge(fe)===Qt||ge(fe)===$t))for(var Te=[Gt,jt,Be,Tr],ye=0,Ke=Te.length;ye<Ke;ye++)x.push(Ee(Ae,Q,fe,Re,Te[ye]));else x.push(Ee(Ae,Q,fe,Re))}var c=[],u=t,h=qe(u),d={b:Ut,w:Bt},m=P.a8,C=P.h1,M=!1,N=typeof i!="undefined"&&"legal"in i?i.legal:!0,B=typeof i!="undefined"&&"piece"in i&&typeof i.piece=="string"?i.piece.toLowerCase():!0;if(typeof i!="undefined"&&"square"in i)if(i.square in P)m=C=P[i.square],M=!0;else return[];for(var _=m;_<=C;_++){if(_&136){_+=7;continue}var R=r[_];if(!(R==null||R.color!==u)){if(R.type===ne&&(B===!0||B===ne)){var E=_+Ve[u][0];if(r[E]==null){l(r,c,_,E,y.NORMAL);var E=_+Ve[u][1];d[u]===ge(_)&&r[E]==null&&l(r,c,_,E,y.BIG_PAWN)}for(k=2;k<4;k++){var E=_+Ve[u][k];E&136||(r[E]!=null&&r[E].color===h?l(r,c,_,E,y.CAPTURE):E===a&&l(r,c,_,a,y.EP_CAPTURE))}}else if(B===!0||B===R.type)for(var k=0,Y=kr[R.type].length;k<Y;k++)for(var O=kr[R.type][k],E=_;E+=O,!(E&136);){if(r[E]==null)l(r,c,_,E,y.NORMAL);else{if(r[E].color===u)break;l(r,c,_,E,y.CAPTURE);break}if(R.type==="n"||R.type==="k")break}}}if((B===!0||B===Me)&&(!M||C===n[u])){if(o[u]&y.KSIDE_CASTLE){var j=n[u],X=j+2;r[j+1]==null&&r[X]==null&&!z(h,n[u])&&!z(h,j+1)&&!z(h,X)&&l(r,c,n[u],X,y.KSIDE_CASTLE)}if(o[u]&y.QSIDE_CASTLE){var j=n[u],X=j-2;r[j-1]==null&&r[j-2]==null&&r[j-3]==null&&!z(h,n[u])&&!z(h,j-1)&&!z(h,X)&&l(r,c,n[u],X,y.QSIDE_CASTLE)}}if(!N)return c;for(var ae=[],_=0,Y=c.length;_<Y;_++)ie(c[_]),U(u)||ae.push(c[_]),ue();return ae}function T(i,l){var c="";if(i.flags&y.KSIDE_CASTLE)c="O-O";else if(i.flags&y.QSIDE_CASTLE)c="O-O-O";else{if(i.piece!==ne){var u=Ht(i,l);c+=i.piece.toUpperCase()+u}i.flags&(y.CAPTURE|y.EP_CAPTURE)&&(i.piece===ne&&(c+=W(i.from)[0]),c+="x"),c+=W(i.to),i.flags&y.PROMOTION&&(c+="="+i.promotion.toUpperCase())}return ie(i),$()&&(se()?c+="#":c+="+"),ue(),c}function z(i,l){for(var c=P.a8;c<=P.h1;c++){if(c&136){c+=7;continue}if(!(r[c]==null||r[c].color!==i)){var u=r[c],h=c-l,d=h+119;if(Lt[d]&1<<Kt[u.type]){if(u.type===ne){if(h>0){if(u.color===te)return!0}else if(u.color===ve)return!0;continue}if(u.type==="n"||u.type==="k")return!0;for(var m=Ot[d],C=c+m,M=!1;C!==l;){if(r[C]!=null){M=!0;break}C+=m}if(!M)return!0}}}return!1}function U(i){return z(qe(i),n[i])}function $(){return U(t)}function se(){return $()&&K().length===0}function We(){return!$()&&K().length===0}function He(){for(var i={},l=[],c=0,u=0,h=P.a8;h<=P.h1;h++){if(u=(u+1)%2,h&136){h+=7;continue}var d=r[h];d&&(i[d.type]=d.type in i?i[d.type]+1:1,d.type===Be&&l.push(u),c++)}if(c===2)return!0;if(c===3&&(i[Be]===1||i[Tr]===1))return!0;if(c===i[Be]+2){for(var m=0,C=l.length,h=0;h<C;h++)m+=l[h];if(m===0||m===C)return!0}return!1}function Fe(){for(var i=[],l={},c=!1;;){var u=ue();if(!u)break;i.push(u)}for(;;){var h=D().split(" ").slice(0,4).join(" ");if(l[h]=h in l?l[h]+1:1,l[h]>=3&&(c=!0),!i.length)break;ie(i.pop())}return c}function un(i){v.push({move:i,kings:{b:n.b,w:n.w},turn:t,castling:{b:o.b,w:o.w},ep_square:a,half_moves:s,move_number:f})}function ie(i){var l=t,c=qe(l);if(un(i),r[i.to]=r[i.from],r[i.from]=null,i.flags&y.EP_CAPTURE&&(t===ve?r[i.to-16]=null:r[i.to+16]=null),i.flags&y.PROMOTION&&(r[i.to]={type:i.promotion,color:l}),r[i.to].type===Me){if(n[r[i.to].color]=i.to,i.flags&y.KSIDE_CASTLE){var u=i.to-1,h=i.to+1;r[u]=r[h],r[h]=null}else if(i.flags&y.QSIDE_CASTLE){var u=i.to+1,h=i.to-2;r[u]=r[h],r[h]=null}o[l]=""}if(o[l]){for(var d=0,m=pe[l].length;d<m;d++)if(i.from===pe[l][d].square&&o[l]&pe[l][d].flag){o[l]^=pe[l][d].flag;break}}if(o[c]){for(var d=0,m=pe[c].length;d<m;d++)if(i.to===pe[c][d].square&&o[c]&pe[c][d].flag){o[c]^=pe[c][d].flag;break}}i.flags&y.BIG_PAWN?t==="b"?a=i.to-16:a=i.to+16:a=J,i.piece===ne||i.flags&(y.CAPTURE|y.EP_CAPTURE)?s=0:s++,t===ve&&f++,t=qe(t)}function ue(){var i=v.pop();if(i==null)return null;var l=i.move;n=i.kings,t=i.turn,o=i.castling,a=i.ep_square,s=i.half_moves,f=i.move_number;var c=t,u=qe(t);if(r[l.from]=r[l.to],r[l.from].type=l.piece,r[l.to]=null,l.flags&y.CAPTURE)r[l.to]={type:l.captured,color:u};else if(l.flags&y.EP_CAPTURE){var h;c===ve?h=l.to-16:h=l.to+16,r[h]={type:ne,color:u}}if(l.flags&(y.KSIDE_CASTLE|y.QSIDE_CASTLE)){var d,m;l.flags&y.KSIDE_CASTLE?(d=l.to+1,m=l.to-1):l.flags&y.QSIDE_CASTLE&&(d=l.to-2,m=l.to+1),r[d]=r[m],r[m]=null}return l}function dr(i,l){for(var c=Er(i),u=0;u<2;u++){if(u==Pr){if(!l)return null;var h=!1,d=c.match(/([pnbrqkPNBRQK])?([a-h][1-8])x?-?([a-h][1-8])([qrbnQRBN])?/);if(d){var m=d[1],C=d[2],M=d[3],N=d[4];C.length==1&&(h=!0)}else{var d=c.match(/([pnbrqkPNBRQK])?([a-h]?[1-8]?)x?-?([a-h][1-8])([qrbnQRBN])?/);if(d){var m=d[1],C=d[2],M=d[3],N=d[4];if(C.length==1)var h=!0}}}for(var B=Ft(c),_=K({legal:!0,piece:m||B}),R=0,E=_.length;R<E;R++)switch(u){case Wt:{if(c===Er(T(_[R],_)))return _[R];break}case Pr:if(d){if((!m||m.toLowerCase()==_[R].piece)&&P[C]==_[R].from&&P[M]==_[R].to&&(!N||N.toLowerCase()==_[R].promotion))return _[R];if(h){var k=W(_[R].from);if((!m||m.toLowerCase()==_[R].piece)&&P[M]==_[R].to&&(C==k[0]||C==k[1])&&(!N||N.toLowerCase()==_[R].promotion))return _[R]}}}}return null}function Oe(i){var l=sn(i);l.san=T(l,K({legal:!0})),l.to=W(l.to),l.from=W(l.from);var c="";for(var u in y)y[u]&l.flags&&(c+=Vt[u]);return l.flags=c,l}function pr(i){for(var l=K({legal:!1}),c=0,u=t,h=0,d=l.length;h<d;h++){if(ie(l[h]),!U(u))if(i-1>0){var m=pr(i-1);c+=m}else c++;ue()}return c}return{load:function(i){return w(i)},reset:function(){return I()},moves:function(i){for(var l=K(i),c=[],u=0,h=l.length;u<h;u++)typeof i!="undefined"&&"verbose"in i&&i.verbose?c.push(Oe(l[u])):c.push(T(l[u],K({legal:!0})));return c},in_check:function(){return $()},in_checkmate:function(){return se()},in_stalemate:function(){return We()},in_draw:function(){return s>=100||We()||He()||Fe()},insufficient_material:function(){return He()},in_threefold_repetition:function(){return Fe()},game_over:function(){return s>=100||se()||We()||He()||Fe()},validate_fen:function(i){return S(i)},fen:function(){return D()},board:function(){for(var i=[],l=[],c=P.a8;c<=P.h1;c++)r[c]==null?l.push(null):l.push({square:W(c),type:r[c].type,color:r[c].color}),c+1&136&&(i.push(l),l=[],c+=8);return i},pgn:function(i){var l=typeof i=="object"&&typeof i.newline_char=="string"?i.newline_char:`
`,c=typeof i=="object"&&typeof i.max_width=="number"?i.max_width:0,u=[],h=!1;for(var d in p)u.push("["+d+' "'+p[d]+'"]'+l),h=!0;h&&v.length&&u.push(l);for(var m=function(k){var Y=b[D()];if(typeof Y!="undefined"){var O=k.length>0?" ":"";k=`${k}${O}{${Y}}`}return k},C=[];v.length>0;)C.push(ue());var M=[],N="";for(C.length===0&&M.push(m(""));C.length>0;){N=m(N);var B=C.pop();!v.length&&B.color==="b"?N=f+". ...":B.color==="w"&&(N.length&&M.push(N),N=f+"."),N=N+" "+T(B,K({legal:!0})),ie(B)}if(N.length&&M.push(m(N)),typeof p.Result!="undefined"&&M.push(p.Result),c===0)return u.join("")+M.join(" ");for(var _=function(){return u.length>0&&u[u.length-1]===" "?(u.pop(),!0):!1},R=function(k,Y){for(var O of Y.split(" "))if(!!O){if(k+O.length>c){for(;_();)k--;u.push(l),k=0}u.push(O),k+=O.length,u.push(" "),k++}return _()&&k--,k},E=0,d=0;d<M.length;d++){if(E+M[d].length>c&&M[d].includes("{")){E=R(E,M[d]);continue}E+M[d].length>c&&d!==0?(u[u.length-1]===" "&&u.pop(),u.push(l),E=0):d!==0&&(u.push(" "),E++),u.push(M[d]),E+=M[d].length}return u.join("")},load_pgn:function(i,l){var c=typeof l!="undefined"&&"sloppy"in l?l.sloppy:!1;function u(x){return x.replace(/\\/g,"\\")}function h(x,Q){for(var fe=typeof Q=="object"&&typeof Q.newline_char=="string"?Q.newline_char:`\r?
`,Re={},Te=x.split(new RegExp(u(fe))),ye="",Ke="",$e=0;$e<Te.length;$e++)ye=Te[$e].replace(/^\[([A-Z][A-Za-z]*)\s.*\]$/,"$1"),Ke=Te[$e].replace(/^\[[A-Za-z]+\s"(.*)"\ *\]$/,"$1"),Ar(ye).length>0&&(Re[ye]=Ke);return Re}var d=typeof l=="object"&&typeof l.newline_char=="string"?l.newline_char:`\r?
`,m=new RegExp("^(\\[((?:"+u(d)+")|.)*\\])(?:"+u(d)+"){2}"),C=m.test(i)?m.exec(i)[1]:"";I();var M=h(C,l);for(var N in M)re([N,M[N]]);if(M.SetUp==="1"&&!("FEN"in M&&w(M.FEN,!0)))return!1;for(var B=function(x){return Array.from(x).map(function(Q){return Q.charCodeAt(0)<128?Q.charCodeAt(0).toString(16):encodeURIComponent(Q).replace(/\%/g,"").toLowerCase()}).join("")},_=function(x){return x.length==0?"":decodeURIComponent("%"+x.match(/.{1,2}/g).join("%"))},R=function(x){return x=x.replace(new RegExp(u(d),"g")," "),`{${B(x.slice(1,x.length-1))}}`},E=function(x){if(x.startsWith("{")&&x.endsWith("}"))return _(x.slice(1,x.length-1))},k=i.replace(C,"").replace(new RegExp(`({[^}]*})+?|;([^${u(d)}]*)`,"g"),function(x,Q,fe){return Q!==void 0?R(Q):" "+R(`{${fe.slice(1)}}`)}).replace(new RegExp(u(d),"g")," "),Y=/(\([^\(\)]+\))+?/g;Y.test(k);)k=k.replace(Y,"");k=k.replace(/\d+\.(\.\.)?/g,""),k=k.replace(/\.\.\./g,""),k=k.replace(/\$\d+/g,"");var O=Ar(k).split(new RegExp(/\s+/));O=O.join(",").replace(/,,+/g,",").split(",");for(var j="",X="",ae=0;ae<O.length;ae++){var Ae=E(O[ae]);if(Ae!==void 0){b[D()]=Ae;continue}if(j=dr(O[ae],c),j==null)if(Dt.indexOf(O[ae])>-1)X=O[ae];else return!1;else X="",ie(j)}return X&&Object.keys(p).length&&!p.Result&&re(["Result",X]),!0},header:function(){return re(arguments)},turn:function(){return t},move:function(i,l){var c=typeof l!="undefined"&&"sloppy"in l?l.sloppy:!1,u=null;if(typeof i=="string")u=dr(i,c);else if(typeof i=="object"){for(var h=K(),d=0,m=h.length;d<m;d++)if(i.from===W(h[d].from)&&i.to===W(h[d].to)&&(!("promotion"in h[d])||i.promotion===h[d].promotion)){u=h[d];break}}if(!u)return null;var C=Oe(u);return ie(u),C},undo:function(){var i=ue();return i?Oe(i):null},clear:function(){return g()},put:function(i,l){return Pe(i,l)},get:function(i){return ce(i)},ascii(){for(var i=`   +------------------------+
`,l=P.a8;l<=P.h1;l++){if(De(l)===0&&(i+=" "+"87654321"[ge(l)]+" |"),r[l]==null)i+=" . ";else{var c=r[l].type,u=r[l].color,h=u===te?c.toUpperCase():c.toLowerCase();i+=" "+h+" "}l+1&136&&(i+=`|
`,l+=8)}return i+=`   +------------------------+
`,i+="     a  b  c  d  e  f  g  h",i},remove:function(i){return G(i)},perft:function(i){return pr(i)},square_color:function(i){if(i in P){var l=P[i];return(ge(l)+De(l))%2===0?"light":"dark"}return null},history:function(i){for(var l=[],c=[],u=typeof i!="undefined"&&("verbose"in i)&&i.verbose;v.length>0;)l.push(ue());for(;l.length>0;){var h=l.pop();u?c.push(Oe(h)):c.push(T(h,K({legal:!0}))),ie(h)}return c},get_comment:function(){return b[D()]},set_comment:function(i){b[D()]=i.replace("{","[").replace("}","]")},delete_comment:function(){var i=b[D()];return delete b[D()],i},get_comments:function(){return A(),Object.keys(b).map(function(i){return{fen:i,comment:b[i]}})},delete_comments:function(){return A(),Object.keys(b).map(function(i){var l=b[i];return delete b[i],{fen:i,comment:l}})}}},Jt=Mr({props:{position:null,orientation:null,destinations:null},emits:["ready","move"],setup(e,{emit:r}){const{position:n,orientation:t="white",destinations:o}=e;async function a(g,A){if(g=="a0"||A=="a0"||!s)return;if(o){let S=s.state.pieces.get(g);S&&(s.state.pieces.delete(g),s.state.pieces.set(A,S)),f.load(`${s.getFen()} ${f.turn()=="w"?"b":"w"} - - 0 1`)}else f.move({from:g,to:A,promotion:"q"},{sloppy:!0});s.set({turnColor:f.turn()==="w"?"white":"black",fen:f.fen(),check:f.in_check(),lastMove:[g,A],movable:{color:f.turn()==="w"?"white":"black",dests:new Map}});let I;r("move",S=>I=S,f,s);let w=await I;w?setTimeout(()=>a(w.from,w.to)):s.set({movable:{dests:p()}})}let s,f=Yt(n),v={fen:f.fen().split(" ")[0],orientation:t,premovable:{enabled:!1},turnColor:f.turn()==="w"?"white":"black",movable:{free:!1,color:f.turn()==="w"?"white":"black",dests:new Map,events:{after:a}}};function p(){if(o)return o(f);let g=new Map;for(let A of Zt){let I=f.moves({square:A,verbose:!0});I.length&&g.set(A,I.map(({to:w})=>w))}return g}async function b(g){s=g,r("ready",s,f);let A;r("move",w=>A=w,f,s);let I=await A;I?setTimeout(()=>a(I.from,I.to)):s.set({turnColor:f.turn()==="w"?"white":"black",check:f.in_check(),movable:{color:f.turn()==="w"?"white":"black",dests:p()}})}return(g,A)=>(Rr(),xr(qt,{config:mn(v),onReady:b},{nav:Ye(()=>[Nr(g.$slots,"nav")]),_:3},8,["config"]))}});export{Zt as S,Jt as _};
