import{_ as un,d as Tr,e as fn,l as dn,x as pn,o as Mr,c as xr,w as Ye,h as Rr,a as hn,D as vn,u as gn}from"./index.49075e57.js";const mn=["white","black"],rr=["a","b","c","d","e","f","g","h"],nr=["1","2","3","4","5","6","7","8"],bn=[...nr].reverse(),tr=Array.prototype.concat(...rr.map(e=>nr.map(r=>e+r))),Z=e=>tr[8*e[0]+e[1]],N=e=>[e.charCodeAt(0)-97,e.charCodeAt(1)-49],Nr=tr.map(N);function wn(e){let r;const n=()=>(r===void 0&&(r=e()),r);return n.clear=()=>{r=void 0},n}const yn=()=>{let e;return{start(){e=performance.now()},cancel(){e=void 0},stop(){if(!e)return 0;const r=performance.now()-e;return e=void 0,r}}},or=e=>e==="white"?"black":"white",De=(e,r)=>{const n=e[0]-r[0],t=e[1]-r[1];return n*n+t*t},Xe=(e,r)=>e.role===r.role&&e.color===r.color,Le=e=>(r,n)=>[(n?r[0]:7-r[0])*e.width/8,(n?7-r[1]:r[1])*e.height/8],te=(e,r)=>{e.style.transform=`translate(${r[0]}px,${r[1]}px)`},qr=(e,r,n=1)=>{e.style.transform=`translate(${r[0]}px,${r[1]}px) scale(${n})`},ir=(e,r)=>{e.style.visibility=r?"visible":"hidden"},Ce=e=>{var r;if(e.clientX||e.clientX===0)return[e.clientX,e.clientY];if(!((r=e.targetTouches)===null||r===void 0)&&r[0])return[e.targetTouches[0].clientX,e.targetTouches[0].clientY]},Dr=e=>e.buttons===2||e.button===2,le=(e,r)=>{const n=document.createElement(e);return r&&(n.className=r),n};function Ir(e,r,n){const t=N(e);return r||(t[0]=7-t[0],t[1]=7-t[1]),[n.left+n.width*t[0]/8+n.width/16,n.top+n.height*(7-t[1])/8+n.height/16]}function Se(e,r){return Math.abs(e-r)}function _n(e){return(r,n,t,o)=>Se(r,t)<2&&(e==="white"?o===n+1||n<=1&&o===n+2&&r===t:o===n-1||n>=6&&o===n-2&&r===t)}const Lr=(e,r,n,t)=>{const o=Se(e,n),a=Se(r,t);return o===1&&a===2||o===2&&a===1},Or=(e,r,n,t)=>Se(e,n)===Se(r,t),Kr=(e,r,n,t)=>e===n||r===t,$r=(e,r,n,t)=>Or(e,r,n,t)||Kr(e,r,n,t);function Sn(e,r,n){return(t,o,a,s)=>Se(t,a)<2&&Se(o,s)<2||n&&o===s&&o===(e==="white"?0:7)&&(t===4&&(a===2&&r.includes(0)||a===6&&r.includes(7))||r.includes(a))}function Cn(e,r){const n=r==="white"?"1":"8",t=[];for(const[o,a]of e)o[1]===n&&a.color===r&&a.role==="rook"&&t.push(N(o)[0]);return t}function Br(e,r,n){const t=e.get(r);if(!t)return[];const o=N(r),a=t.role,s=a==="pawn"?_n(t.color):a==="knight"?Lr:a==="bishop"?Or:a==="rook"?Kr:a==="queen"?$r:Sn(t.color,Cn(e,t.color),n);return Nr.filter(f=>(o[0]!==f[0]||o[1]!==f[1])&&s(o[0],o[1],f[0],f[1])).map(Z)}function H(e,...r){e&&setTimeout(()=>e(...r),1)}function kn(e){e.orientation=or(e.orientation),e.animation.current=e.draggable.current=e.selected=void 0}function Pn(e,r){for(const[n,t]of r)t?e.pieces.set(n,t):e.pieces.delete(n)}function En(e,r){if(e.check=void 0,r===!0&&(r=e.turnColor),r)for(const[n,t]of e.pieces)t.role==="king"&&t.color===r&&(e.check=n)}function An(e,r,n,t){we(e),e.premovable.current=[r,n],H(e.premovable.events.set,r,n,t)}function be(e){e.premovable.current&&(e.premovable.current=void 0,H(e.premovable.events.unset))}function Tn(e,r,n){be(e),e.predroppable.current={role:r,key:n},H(e.predroppable.events.set,r,n)}function we(e){const r=e.predroppable;r.current&&(r.current=void 0,H(r.events.unset))}function Mn(e,r,n){if(!e.autoCastle)return!1;const t=e.pieces.get(r);if(!t||t.role!=="king")return!1;const o=N(r),a=N(n);if(o[1]!==0&&o[1]!==7||o[1]!==a[1])return!1;o[0]===4&&!e.pieces.has(n)&&(a[0]===6?n=Z([7,a[1]]):a[0]===2&&(n=Z([0,a[1]])));const s=e.pieces.get(n);return!s||s.color!==t.color||s.role!=="rook"?!1:(e.pieces.delete(r),e.pieces.delete(n),o[0]<a[0]?(e.pieces.set(Z([6,a[1]]),t),e.pieces.set(Z([5,a[1]]),s)):(e.pieces.set(Z([2,a[1]]),t),e.pieces.set(Z([3,a[1]]),s)),!0)}function Ur(e,r,n){const t=e.pieces.get(r),o=e.pieces.get(n);if(r===n||!t)return!1;const a=o&&o.color!==t.color?o:void 0;return n===e.selected&&V(e),H(e.events.move,r,n,a),Mn(e,r,n)||(e.pieces.set(n,t),e.pieces.delete(r)),e.lastMove=[r,n],e.check=void 0,H(e.events.change),a||!0}function ar(e,r,n,t){if(e.pieces.has(n))if(t)e.pieces.delete(n);else return!1;return H(e.events.dropNewPiece,r,n),e.pieces.set(n,r),e.lastMove=[n],e.check=void 0,H(e.events.change),e.movable.dests=void 0,e.turnColor=or(e.turnColor),!0}function Qr(e,r,n){const t=Ur(e,r,n);return t&&(e.movable.dests=void 0,e.turnColor=or(e.turnColor),e.animation.current=void 0),t}function Wr(e,r,n){if(lr(e,r,n)){const t=Qr(e,r,n);if(t){const o=e.hold.stop();V(e);const a={premove:!1,ctrlKey:e.stats.ctrlKey,holdTime:o};return t!==!0&&(a.captured=t),H(e.movable.events.after,r,n,a),!0}}else if(Rn(e,r,n))return An(e,r,n,{ctrlKey:e.stats.ctrlKey}),V(e),!0;return V(e),!1}function Hr(e,r,n,t){const o=e.pieces.get(r);o&&(xn(e,r,n)||t)?(e.pieces.delete(r),ar(e,o,n,t),H(e.movable.events.afterNewPiece,o.role,n,{premove:!1,predrop:!1})):o&&Nn(e,r,n)?Tn(e,o.role,n):(be(e),we(e)),e.pieces.delete(r),V(e)}function Je(e,r,n){if(H(e.events.select,r),e.selected){if(e.selected===r&&!e.draggable.enabled){V(e),e.hold.cancel();return}else if((e.selectable.enabled||n)&&e.selected!==r&&Wr(e,e.selected,r)){e.stats.dragged=!1;return}}(zr(e,r)||cr(e,r))&&(Fr(e,r),e.hold.start())}function Fr(e,r){e.selected=r,cr(e,r)?e.premovable.dests=Br(e.pieces,r,e.premovable.castle):e.premovable.dests=void 0}function V(e){e.selected=void 0,e.premovable.dests=void 0,e.hold.cancel()}function zr(e,r){const n=e.pieces.get(r);return!!n&&(e.movable.color==="both"||e.movable.color===n.color&&e.turnColor===n.color)}function lr(e,r,n){var t,o;return r!==n&&zr(e,r)&&(e.movable.free||!!(!((o=(t=e.movable.dests)===null||t===void 0?void 0:t.get(r))===null||o===void 0)&&o.includes(n)))}function xn(e,r,n){const t=e.pieces.get(r);return!!t&&(r===n||!e.pieces.has(n))&&(e.movable.color==="both"||e.movable.color===t.color&&e.turnColor===t.color)}function cr(e,r){const n=e.pieces.get(r);return!!n&&e.premovable.enabled&&e.movable.color===n.color&&e.turnColor!==n.color}function Rn(e,r,n){return r!==n&&cr(e,r)&&Br(e.pieces,r,e.premovable.castle).includes(n)}function Nn(e,r,n){const t=e.pieces.get(r),o=e.pieces.get(n);return!!t&&(!o||o.color!==e.movable.color)&&e.predroppable.enabled&&(t.role!=="pawn"||n[1]!=="1"&&n[1]!=="8")&&e.movable.color===t.color&&e.turnColor!==t.color}function qn(e,r){const n=e.pieces.get(r);return!!n&&e.draggable.enabled&&(e.movable.color==="both"||e.movable.color===n.color&&(e.turnColor===n.color||e.premovable.enabled))}function Dn(e){const r=e.premovable.current;if(!r)return!1;const n=r[0],t=r[1];let o=!1;if(lr(e,n,t)){const a=Qr(e,n,t);if(a){const s={premove:!0};a!==!0&&(s.captured=a),H(e.movable.events.after,n,t,s),o=!0}}return be(e),o}function In(e,r){const n=e.predroppable.current;let t=!1;if(!n)return!1;if(r(n)){const o={role:n.role,color:e.movable.color};ar(e,o,n.key)&&(H(e.movable.events.afterNewPiece,n.role,n.key,{premove:!1,predrop:!0}),t=!0)}return we(e),t}function sr(e){be(e),we(e),V(e)}function hr(e){e.movable.color=e.movable.dests=e.animation.current=void 0,sr(e)}function ke(e,r,n){let t=Math.floor(8*(e[0]-n.left)/n.width);r||(t=7-t);let o=7-Math.floor(8*(e[1]-n.top)/n.height);return r||(o=7-o),t>=0&&t<8&&o>=0&&o<8?Z([t,o]):void 0}function Ln(e,r,n,t){const o=N(e),a=Nr.filter(h=>$r(o[0],o[1],h[0],h[1])||Lr(o[0],o[1],h[0],h[1])),f=a.map(h=>Ir(Z(h),n,t)).map(h=>De(r,h)),[,v]=f.reduce((h,b,g)=>h[0]<b?h:[b,g],[f[0],0]);return Z(a[v])}function F(e){return e.orientation==="white"}const jr="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR",On={p:"pawn",r:"rook",n:"knight",b:"bishop",q:"queen",k:"king"},Kn={pawn:"p",rook:"r",knight:"n",bishop:"b",queen:"q",king:"k"};function Gr(e){e==="start"&&(e=jr);const r=new Map;let n=7,t=0;for(const o of e)switch(o){case" ":case"[":return r;case"/":if(--n,n<0)return r;t=0;break;case"~":{const a=r.get(Z([t-1,n]));a&&(a.promoted=!0);break}default:{const a=o.charCodeAt(0);if(a<57)t+=a-48;else{const s=o.toLowerCase();r.set(Z([t,n]),{role:On[s],color:o===s?"black":"white"}),++t}}}return r}function $n(e){return bn.map(r=>rr.map(n=>{const t=e.get(n+r);if(t){let o=Kn[t.role];return t.color==="white"&&(o=o.toUpperCase()),t.promoted&&(o+="~"),o}else return"1"}).join("")).join("/").replace(/1{2,}/g,r=>r.length.toString())}function Zr(e,r){r.animation&&(ur(e.animation,r.animation),(e.animation.duration||0)<70&&(e.animation.enabled=!1))}function Vr(e,r){var n,t;if(!((n=r.movable)===null||n===void 0)&&n.dests&&(e.movable.dests=void 0),!((t=r.drawable)===null||t===void 0)&&t.autoShapes&&(e.drawable.autoShapes=[]),ur(e,r),r.fen&&(e.pieces=Gr(r.fen),e.drawable.shapes=[]),"check"in r&&En(e,r.check||!1),"lastMove"in r&&!r.lastMove?e.lastMove=void 0:r.lastMove&&(e.lastMove=r.lastMove),e.selected&&Fr(e,e.selected),Zr(e,r),!e.movable.rookCastle&&e.movable.dests){const o=e.movable.color==="white"?"1":"8",a="e"+o,s=e.movable.dests.get(a),f=e.pieces.get(a);if(!s||!f||f.role!=="king")return;e.movable.dests.set(a,s.filter(v=>!(v==="a"+o&&s.includes("c"+o))&&!(v==="h"+o&&s.includes("g"+o))))}}function ur(e,r){for(const n in r)vr(e[n])&&vr(r[n])?ur(e[n],r[n]):e[n]=r[n]}function vr(e){return typeof e=="object"}function _e(e,r){return r.animation.enabled?Qn(e,r):he(e,r)}function he(e,r){const n=e(r);return r.dom.redraw(),n}function ze(e,r){return{key:e,pos:N(e),piece:r}}function Bn(e,r){return r.sort((n,t)=>De(e.pos,n.pos)-De(e.pos,t.pos))[0]}function Un(e,r){const n=new Map,t=[],o=new Map,a=[],s=[],f=new Map;let v,h,b;for(const[g,T]of e)f.set(g,ze(g,T));for(const g of tr)v=r.pieces.get(g),h=f.get(g),v?h?Xe(v,h.piece)||(a.push(h),s.push(ze(g,v))):s.push(ze(g,v)):h&&a.push(h);for(const g of s)h=Bn(g,a.filter(T=>Xe(g.piece,T.piece))),h&&(b=[h.pos[0]-g.pos[0],h.pos[1]-g.pos[1]],n.set(g.key,b.concat(b)),t.push(h.key));for(const g of a)t.includes(g.key)||o.set(g.key,g.piece);return{anims:n,fadings:o}}function Yr(e,r){const n=e.animation.current;if(n===void 0){e.dom.destroyed||e.dom.redrawNow();return}const t=1-(r-n.start)*n.frequency;if(t<=0)e.animation.current=void 0,e.dom.redrawNow();else{const o=Wn(t);for(const a of n.plan.anims.values())a[2]=a[0]*o,a[3]=a[1]*o;e.dom.redrawNow(!0),requestAnimationFrame((a=performance.now())=>Yr(e,a))}}function Qn(e,r){const n=new Map(r.pieces),t=e(r),o=Un(n,r);if(o.anims.size||o.fadings.size){const a=r.animation.current&&r.animation.current.start;r.animation.current={start:performance.now(),frequency:1/r.animation.duration,plan:o},a||Yr(r,performance.now())}else r.dom.redraw();return t}function Wn(e){return e<.5?4*e*e*e:(e-1)*(2*e-2)*(2*e-2)+1}const Hn=["green","red","blue","yellow"];function Fn(e,r){if(r.touches&&r.touches.length>1)return;r.stopPropagation(),r.preventDefault(),r.ctrlKey?V(e):sr(e);const n=Ce(r),t=ke(n,F(e),e.dom.bounds());!t||(e.drawable.current={orig:t,pos:n,brush:Zn(r),snapToValidMove:e.drawable.defaultSnapToValidMove},Xr(e))}function Xr(e){requestAnimationFrame(()=>{const r=e.drawable.current;if(r){const n=ke(r.pos,F(e),e.dom.bounds());n||(r.snapToValidMove=!1);const t=r.snapToValidMove?Ln(r.orig,r.pos,F(e),e.dom.bounds()):n;t!==r.mouseSq&&(r.mouseSq=t,r.dest=t!==r.orig?t:void 0,e.dom.redrawNow()),Xr(e)}})}function zn(e,r){e.drawable.current&&(e.drawable.current.pos=Ce(r))}function jn(e){const r=e.drawable.current;r&&(r.mouseSq&&Vn(e.drawable,r),Jr(e))}function Jr(e){e.drawable.current&&(e.drawable.current=void 0,e.dom.redraw())}function Gn(e){e.drawable.shapes.length&&(e.drawable.shapes=[],e.dom.redraw(),en(e.drawable))}function Zn(e){var r;const n=(e.shiftKey||e.ctrlKey)&&Dr(e),t=e.altKey||e.metaKey||((r=e.getModifierState)===null||r===void 0?void 0:r.call(e,"AltGraph"));return Hn[(n?1:0)+(t?2:0)]}function Vn(e,r){const n=o=>o.orig===r.orig&&o.dest===r.dest,t=e.shapes.find(n);t&&(e.shapes=e.shapes.filter(o=>!n(o))),(!t||t.brush!==r.brush)&&e.shapes.push(r),en(e)}function en(e){e.onChange&&e.onChange(e.shapes)}function Yn(e,r){if(!r.isTrusted||r.button!==void 0&&r.button!==0||r.touches&&r.touches.length>1)return;const n=e.dom.bounds(),t=Ce(r),o=ke(t,F(e),n);if(!o)return;const a=e.pieces.get(o),s=e.selected;!s&&e.drawable.enabled&&(e.drawable.eraseOnClick||!a||a.color!==e.turnColor)&&Gn(e),r.cancelable!==!1&&(!r.touches||e.blockTouchScroll||a||s||Xn(e,t))&&r.preventDefault();const f=!!e.premovable.current,v=!!e.predroppable.current;e.stats.ctrlKey=r.ctrlKey,e.selected&&lr(e,e.selected,o)?_e(g=>Je(g,o),e):Je(e,o);const h=e.selected===o,b=nn(e,o);if(a&&b&&h&&qn(e,o)){e.draggable.current={orig:o,piece:a,origPos:t,pos:t,started:e.draggable.autoDistance&&e.stats.dragged,element:b,previouslySelected:s,originTarget:r.target,keyHasChanged:!1},b.cgDragging=!0,b.classList.add("dragging");const g=e.dom.elements.ghost;g&&(g.className=`ghost ${a.color} ${a.role}`,te(g,Le(n)(N(o),F(e))),ir(g,!0)),fr(e)}else f&&be(e),v&&we(e);e.dom.redraw()}function Xn(e,r){const n=F(e),t=e.dom.bounds(),o=Math.pow(t.width/8,2);for(const a of e.pieces.keys()){const s=Ir(a,n,t);if(De(s,r)<=o)return!0}return!1}function Jn(e,r,n,t){const o="a0";e.pieces.set(o,r),e.dom.redraw();const a=Ce(n);e.draggable.current={orig:o,piece:r,origPos:a,pos:a,started:!0,element:()=>nn(e,o),originTarget:n.target,newPiece:!0,force:!!t,keyHasChanged:!1},fr(e)}function fr(e){requestAnimationFrame(()=>{var r;const n=e.draggable.current;if(!n)return;!((r=e.animation.current)===null||r===void 0)&&r.plan.anims.has(n.orig)&&(e.animation.current=void 0);const t=e.pieces.get(n.orig);if(!t||!Xe(t,n.piece))Ue(e);else if(!n.started&&De(n.pos,n.origPos)>=Math.pow(e.draggable.distance,2)&&(n.started=!0),n.started){if(typeof n.element=="function"){const a=n.element();if(!a)return;a.cgDragging=!0,a.classList.add("dragging"),n.element=a}const o=e.dom.bounds();te(n.element,[n.pos[0]-o.left-o.width/16,n.pos[1]-o.top-o.height/16]),n.keyHasChanged||(n.keyHasChanged=n.orig!==ke(n.pos,F(e),o))}fr(e)})}function et(e,r){e.draggable.current&&(!r.touches||r.touches.length<2)&&(e.draggable.current.pos=Ce(r))}function rt(e,r){const n=e.draggable.current;if(!n)return;if(r.type==="touchend"&&r.cancelable!==!1&&r.preventDefault(),r.type==="touchend"&&n.originTarget!==r.target&&!n.newPiece){e.draggable.current=void 0;return}be(e),we(e);const t=Ce(r)||n.pos,o=ke(t,F(e),e.dom.bounds());o&&n.started&&n.orig!==o?n.newPiece?Hr(e,n.orig,o,n.force):(e.stats.ctrlKey=r.ctrlKey,Wr(e,n.orig,o)&&(e.stats.dragged=!0)):n.newPiece?e.pieces.delete(n.orig):e.draggable.deleteOnDropOff&&!o&&(e.pieces.delete(n.orig),H(e.events.change)),(n.orig===n.previouslySelected||n.keyHasChanged)&&(n.orig===o||!o)?V(e):e.selectable.enabled||V(e),rn(e),e.draggable.current=void 0,e.dom.redraw()}function Ue(e){const r=e.draggable.current;r&&(r.newPiece&&e.pieces.delete(r.orig),e.draggable.current=void 0,V(e),rn(e),e.dom.redraw())}function rn(e){const r=e.dom.elements;r.ghost&&ir(r.ghost,!1)}function nn(e,r){let n=e.dom.elements.board.firstChild;for(;n;){if(n.cgKey===r&&n.tagName==="PIECE")return n;n=n.nextSibling}}function nt(e,r){e.exploding={stage:1,keys:r},e.dom.redraw(),setTimeout(()=>{gr(e,2),setTimeout(()=>gr(e,void 0),120)},120)}function gr(e,r){e.exploding&&(r?e.exploding.stage=r:e.exploding=void 0,e.dom.redraw())}function tt(e,r){function n(){kn(e),r()}return{set(t){t.orientation&&t.orientation!==e.orientation&&n(),Zr(e,t),(t.fen?_e:he)(o=>Vr(o,t),e)},state:e,getFen:()=>$n(e.pieces),toggleOrientation:n,setPieces(t){_e(o=>Pn(o,t),e)},selectSquare(t,o){t?_e(a=>Je(a,t,o),e):e.selected&&(V(e),e.dom.redraw())},move(t,o){_e(a=>Ur(a,t,o),e)},newPiece(t,o){_e(a=>ar(a,t,o),e)},playPremove(){if(e.premovable.current){if(_e(Dn,e))return!0;e.dom.redraw()}return!1},playPredrop(t){if(e.predroppable.current){const o=In(e,t);return e.dom.redraw(),o}return!1},cancelPremove(){he(be,e)},cancelPredrop(){he(we,e)},cancelMove(){he(t=>{sr(t),Ue(t)},e)},stop(){he(t=>{hr(t),Ue(t)},e)},explode(t){nt(e,t)},setAutoShapes(t){he(o=>o.drawable.autoShapes=t,e)},setShapes(t){he(o=>o.drawable.shapes=t,e)},getKeyAtDomPos(t){return ke(t,F(e),e.dom.bounds())},redrawAll:r,dragNewPiece(t,o,a){Jn(e,t,o,a)},destroy(){hr(e),e.dom.unbind&&e.dom.unbind(),e.dom.destroyed=!0}}}function ot(){return{pieces:Gr(jr),orientation:"white",turnColor:"white",coordinates:!0,ranksPosition:"right",autoCastle:!0,viewOnly:!1,disableContextMenu:!1,addPieceZIndex:!1,addDimensionsCssVars:!1,blockTouchScroll:!1,pieceKey:!1,highlight:{lastMove:!0,check:!0},animation:{enabled:!0,duration:200},movable:{free:!0,color:"both",showDests:!0,events:{},rookCastle:!0},premovable:{enabled:!0,showDests:!0,castle:!0,events:{}},predroppable:{enabled:!1,events:{}},draggable:{enabled:!0,distance:3,autoDistance:!0,showGhost:!0,deleteOnDropOff:!1},dropmode:{active:!1},selectable:{enabled:!0},stats:{dragged:!("ontouchstart"in window)},events:{},drawable:{enabled:!0,visible:!0,defaultSnapToValidMove:!0,eraseOnClick:!0,shapes:[],autoShapes:[],brushes:{green:{key:"g",color:"#15781B",opacity:1,lineWidth:10},red:{key:"r",color:"#882020",opacity:1,lineWidth:10},blue:{key:"b",color:"#003088",opacity:1,lineWidth:10},yellow:{key:"y",color:"#e68f00",opacity:1,lineWidth:10},paleBlue:{key:"pb",color:"#003088",opacity:.4,lineWidth:15},paleGreen:{key:"pg",color:"#15781B",opacity:.4,lineWidth:15},paleRed:{key:"pr",color:"#882020",opacity:.4,lineWidth:15},paleGrey:{key:"pgr",color:"#4a4a4a",opacity:.35,lineWidth:15}},prevSvgHash:""},hold:yn()}}function er(e,r,n){const t=new Map,o=[];for(const f of e)t.set(f.hash,!1);let a=r.firstChild,s;for(;a;)s=a.getAttribute("cgHash"),t.has(s)?t.set(s,!0):o.push(a),a=a.nextSibling;for(const f of o)r.removeChild(f);for(const f of e)t.get(f.hash)||r.appendChild(n(f))}function ee(e){return document.createElementNS("http://www.w3.org/2000/svg",e)}function it(e,r,n){const t=e.drawable,o=t.current,a=o&&o.mouseSq?o:void 0,s=new Map,f=e.dom.bounds(),v=t.autoShapes.filter(w=>!w.piece);for(const w of t.shapes.concat(v).concat(a?[a]:[]))w.dest&&s.set(w.dest,(s.get(w.dest)||0)+1);const h=t.shapes.concat(v).map(w=>({shape:w,current:!1,hash:mr(w,s,!1,f)}));a&&h.push({shape:a,current:!0,hash:mr(a,s,!0,f)});const b=h.map(w=>w.hash).join(";");if(b===e.drawable.prevSvgHash)return;e.drawable.prevSvgHash=b;const g=r.querySelector("defs"),T=r.querySelector("g"),q=n.querySelector("g");at(t,h,g),er(h.filter(w=>!w.shape.customSvg),T,w=>br(e,w,t.brushes,s,f)),er(h.filter(w=>w.shape.customSvg),q,w=>br(e,w,t.brushes,s,f))}function at(e,r,n){const t=new Map;let o;for(const f of r)f.shape.dest&&(o=e.brushes[f.shape.brush],f.shape.modifiers&&(o=tn(o,f.shape.modifiers)),t.set(o.key,o));const a=new Set;let s=n.firstChild;for(;s;)a.add(s.getAttribute("cgKey")),s=s.nextSibling;for(const[f,v]of t.entries())a.has(f)||n.appendChild(pt(v))}function mr({orig:e,dest:r,brush:n,piece:t,modifiers:o,customSvg:a},s,f,v){return[v.width,v.height,f,e,r,n,r&&(s.get(r)||0)>1,t&&lt(t),o&&ct(o),a&&st(a)].filter(h=>h).join(",")}function lt(e){return[e.color,e.role,e.scale].filter(r=>r).join(",")}function ct(e){return""+(e.lineWidth||"")}function st(e){let r=0;for(let n=0;n<e.length;n++)r=(r<<5)-r+e.charCodeAt(n)>>>0;return"custom-"+r.toString()}function br(e,{shape:r,current:n,hash:t},o,a,s){let f;const v=wr(N(r.orig),e.orientation);if(r.customSvg)f=ut(r.customSvg,v,s);else if(r.dest){let h=o[r.brush];r.modifiers&&(h=tn(h,r.modifiers)),f=dt(h,v,wr(N(r.dest),e.orientation),n,(a.get(r.dest)||0)>1,s)}else f=ft(o[r.brush],v,n,s);return f.setAttribute("cgHash",t),f}function ut(e,r,n){const[t,o]=Qe(r,n),a=me(ee("g"),{transform:`translate(${t},${o})`}),s=me(ee("svg"),{width:1,height:1,viewBox:"0 0 100 100"});return a.appendChild(s),s.innerHTML=e,a}function ft(e,r,n,t){const o=Qe(r,t),a=ht(),s=(t.width+t.height)/(4*Math.max(t.width,t.height));return me(ee("circle"),{stroke:e.color,"stroke-width":a[n?0:1],fill:"none",opacity:on(e,n),cx:o[0],cy:o[1],r:s-a[1]/2})}function dt(e,r,n,t,o,a){const s=gt(o&&!t),f=Qe(r,a),v=Qe(n,a),h=v[0]-f[0],b=v[1]-f[1],g=Math.atan2(b,h),T=Math.cos(g)*s,q=Math.sin(g)*s;return me(ee("line"),{stroke:e.color,"stroke-width":vt(e,t),"stroke-linecap":"round","marker-end":"url(#arrowhead-"+e.key+")",opacity:on(e,t),x1:f[0],y1:f[1],x2:v[0]-T,y2:v[1]-q})}function pt(e){const r=me(ee("marker"),{id:"arrowhead-"+e.key,orient:"auto",markerWidth:4,markerHeight:8,refX:2.05,refY:2.01});return r.appendChild(me(ee("path"),{d:"M0,0 V4 L3,2 Z",fill:e.color})),r.setAttribute("cgKey",e.key),r}function me(e,r){for(const n in r)e.setAttribute(n,r[n]);return e}function wr(e,r){return r==="white"?e:[7-e[0],7-e[1]]}function tn(e,r){return{color:e.color,opacity:Math.round(e.opacity*10)/10,lineWidth:Math.round(r.lineWidth||e.lineWidth),key:[e.key,r.lineWidth].filter(n=>n).join("")}}function ht(){return[3/64,4/64]}function vt(e,r){return(e.lineWidth||10)*(r?.85:1)/64}function on(e,r){return(e.opacity||1)*(r?.9:1)}function gt(e){return(e?20:10)/64}function Qe(e,r){const n=Math.min(1,r.width/r.height),t=Math.min(1,r.height/r.width);return[(e[0]-3.5)*n,(3.5-e[1])*t]}function mt(e,r){e.innerHTML="",e.classList.add("cg-wrap");for(const v of mn)e.classList.toggle("orientation-"+v,r.orientation===v);e.classList.toggle("manipulable",!r.viewOnly);const n=le("cg-container");e.appendChild(n);const t=le("cg-board");n.appendChild(t);let o,a,s;if(r.drawable.visible&&(o=me(ee("svg"),{class:"cg-shapes",viewBox:"-4 -4 8 8",preserveAspectRatio:"xMidYMid slice"}),o.appendChild(ee("defs")),o.appendChild(ee("g")),a=me(ee("svg"),{class:"cg-custom-svgs",viewBox:"-3.5 -3.5 8 8",preserveAspectRatio:"xMidYMid slice"}),a.appendChild(ee("g")),s=le("cg-auto-pieces"),n.appendChild(o),n.appendChild(a),n.appendChild(s)),r.coordinates){const v=r.orientation==="black"?" black":"",h=r.ranksPosition==="left"?" left":"";n.appendChild(yr(nr,"ranks"+v+h)),n.appendChild(yr(rr,"files"+v))}let f;return r.draggable.showGhost&&(f=le("piece","ghost"),ir(f,!1),n.appendChild(f)),{board:t,container:n,wrap:e,ghost:f,svg:o,customSvg:a,autoPieces:s}}function yr(e,r){const n=le("coords",r);let t;for(const o of e)t=le("coord"),t.textContent=o,n.appendChild(t);return n}function bt(e,r){if(!e.dropmode.active)return;be(e),we(e);const n=e.dropmode.piece;if(n){e.pieces.set("a0",n);const t=Ce(r),o=t&&ke(t,F(e),e.dom.bounds());o&&Hr(e,"a0",o)}e.dom.redraw()}function wt(e,r){const n=e.dom.elements.board;if("ResizeObserver"in window&&new ResizeObserver(r).observe(e.dom.elements.wrap),e.viewOnly)return;const t=_t(e);n.addEventListener("touchstart",t,{passive:!1}),n.addEventListener("mousedown",t,{passive:!1}),(e.disableContextMenu||e.drawable.enabled)&&n.addEventListener("contextmenu",o=>o.preventDefault())}function yt(e,r){const n=[];if("ResizeObserver"in window||n.push(Re(document.body,"chessground.resize",r)),!e.viewOnly){const t=_r(e,et,zn),o=_r(e,rt,jn);for(const s of["touchmove","mousemove"])n.push(Re(document,s,t));for(const s of["touchend","mouseup"])n.push(Re(document,s,o));const a=()=>e.dom.bounds.clear();n.push(Re(document,"scroll",a,{capture:!0,passive:!0})),n.push(Re(window,"resize",a,{passive:!0}))}return()=>n.forEach(t=>t())}function Re(e,r,n,t){return e.addEventListener(r,n,t),()=>e.removeEventListener(r,n,t)}function _t(e){return r=>{e.draggable.current?Ue(e):e.drawable.current?Jr(e):r.shiftKey||Dr(r)?e.drawable.enabled&&Fn(e,r):e.viewOnly||(e.dropmode.active?bt(e,r):Yn(e,r))}}function _r(e,r,n){return t=>{e.drawable.current?e.drawable.enabled&&n(e,t):e.viewOnly||r(e,t)}}function St(e){const r=F(e),n=Le(e.dom.bounds()),t=e.dom.elements.board,o=e.pieces,a=e.animation.current,s=a?a.plan.anims:new Map,f=a?a.plan.fadings:new Map,v=e.draggable.current,h=kt(e),b=new Set,g=new Set,T=new Map,q=new Map;let w,S,D,re,L,ce,Pe,G,Ee,K;for(S=t.firstChild;S;){if(w=S.cgKey,an(S))if(D=o.get(w),L=s.get(w),ce=f.get(w),re=S.cgPiece,S.cgDragging&&(!v||v.orig!==w)&&(S.classList.remove("dragging"),te(S,n(N(w),r)),S.cgDragging=!1),!ce&&S.cgFading&&(S.cgFading=!1,S.classList.remove("fading")),D){if(L&&S.cgAnimating&&re===Ne(D)){const M=N(w);M[0]+=L[2],M[1]+=L[3],S.classList.add("anim"),te(S,n(M,r))}else S.cgAnimating&&(S.cgAnimating=!1,S.classList.remove("anim"),te(S,n(N(w),r)),e.addPieceZIndex&&(S.style.zIndex=je(N(w),r)));re===Ne(D)&&(!ce||!S.cgFading)?b.add(w):ce&&re===Ne(ce)?(S.classList.add("fading"),S.cgFading=!0):Ge(T,re,S)}else Ge(T,re,S);else if(ln(S)){const M=S.className;h.get(w)===M?g.add(w):Ge(q,M,S)}S=S.nextSibling}for(const[M,z]of h)if(!g.has(M)){Ee=q.get(z),K=Ee&&Ee.pop();const U=n(N(M),r);if(K)K.cgKey=M,te(K,U);else{const $=le("square",z);$.cgKey=M,te($,U),t.insertBefore($,t.firstChild)}}for(const[M,z]of o)if(L=s.get(M),!b.has(M))if(Pe=T.get(Ne(z)),G=Pe&&Pe.pop(),G){G.cgKey=M,G.cgFading&&(G.classList.remove("fading"),G.cgFading=!1);const U=N(M);e.addPieceZIndex&&(G.style.zIndex=je(U,r)),L&&(G.cgAnimating=!0,G.classList.add("anim"),U[0]+=L[2],U[1]+=L[3]),te(G,n(U,r))}else{const U=Ne(z),$=le("piece",U),se=N(M);$.cgPiece=U,$.cgKey=M,L&&($.cgAnimating=!0,se[0]+=L[2],se[1]+=L[3]),te($,n(se,r)),e.addPieceZIndex&&($.style.zIndex=je(se,r)),t.appendChild($)}for(const M of T.values())Cr(e,M);for(const M of q.values())Cr(e,M)}function Ct(e){const r=F(e),n=Le(e.dom.bounds());let t=e.dom.elements.board.firstChild;for(;t;)(an(t)&&!t.cgAnimating||ln(t))&&te(t,n(N(t.cgKey),r)),t=t.nextSibling}function Sr(e){const r=e.dom.elements.wrap.getBoundingClientRect(),n=e.dom.elements.container,t=r.height/r.width,o=Math.floor(r.width*window.devicePixelRatio/8)*8/window.devicePixelRatio,a=o*t;n.style.width=o+"px",n.style.height=a+"px",e.dom.bounds.clear(),e.addDimensionsCssVars&&(document.documentElement.style.setProperty("--cg-width",o+"px"),document.documentElement.style.setProperty("--cg-height",a+"px"))}function an(e){return e.tagName==="PIECE"}function ln(e){return e.tagName==="SQUARE"}function Cr(e,r){for(const n of r)e.dom.elements.board.removeChild(n)}function je(e,r){const t=e[1];return`${r?3+7-t:3+t}`}function Ne(e){return`${e.color} ${e.role}`}function kt(e){var r;const n=new Map;if(e.lastMove&&e.highlight.lastMove)for(const a of e.lastMove)de(n,a,"last-move");if(e.check&&e.highlight.check&&de(n,e.check,"check"),e.selected&&(de(n,e.selected,"selected"),e.movable.showDests)){const a=(r=e.movable.dests)===null||r===void 0?void 0:r.get(e.selected);if(a)for(const f of a)de(n,f,"move-dest"+(e.pieces.has(f)?" oc":""));const s=e.premovable.dests;if(s)for(const f of s)de(n,f,"premove-dest"+(e.pieces.has(f)?" oc":""))}const t=e.premovable.current;if(t)for(const a of t)de(n,a,"current-premove");else e.predroppable.current&&de(n,e.predroppable.current.key,"current-premove");const o=e.exploding;if(o)for(const a of o.keys)de(n,a,"exploding"+o.stage);return n}function de(e,r,n){const t=e.get(r);t?e.set(r,`${t} ${n}`):e.set(r,n)}function Ge(e,r,n){const t=e.get(r);t?t.push(n):e.set(r,[n])}function Pt(e,r){const t=e.drawable.autoShapes.filter(o=>o.piece).map(o=>({shape:o,hash:Tt(o),current:!1}));er(t,r,o=>At(e,o,e.dom.bounds()))}function Et(e){var r;const n=F(e),t=Le(e.dom.bounds());let o=(r=e.dom.elements.autoPieces)===null||r===void 0?void 0:r.firstChild;for(;o;)qr(o,t(N(o.cgKey),n),o.cgScale),o=o.nextSibling}function At(e,{shape:r,hash:n},t){var o,a,s;const f=r.orig,v=(o=r.piece)===null||o===void 0?void 0:o.role,h=(a=r.piece)===null||a===void 0?void 0:a.color,b=(s=r.piece)===null||s===void 0?void 0:s.scale,g=le("piece",`${v} ${h}`);return g.setAttribute("cgHash",n),g.cgKey=f,g.cgScale=b,qr(g,Le(t)(N(f),F(e)),b),g}function Tt(e){var r,n,t;return[e.orig,(r=e.piece)===null||r===void 0?void 0:r.role,(n=e.piece)===null||n===void 0?void 0:n.color,(t=e.piece)===null||t===void 0?void 0:t.scale].join(",")}function Mt(e,r){const n=ot();Vr(n,r||{});function t(){const o="dom"in n?n.dom.unbind:void 0,a=mt(e,n),s=wn(()=>a.board.getBoundingClientRect()),f=b=>{St(h),a.autoPieces&&Pt(h,a.autoPieces),!b&&a.svg&&it(h,a.svg,a.customSvg)},v=()=>{Sr(h),Ct(h),a.autoPieces&&Et(h)},h=n;return h.dom={elements:a,bounds:s,redraw:xt(f),redrawNow:f,unbind:o},h.drawable.prevSvgHash="",Sr(h),f(!1),wt(h,v),o||(h.dom.unbind=yt(h,v)),h.events.insert&&h.events.insert(a),h}return tt(t(),t)}function xt(e){let r=!1;return()=>{r||(r=!0,requestAnimationFrame(()=>{e(),r=!1}))}}const Rt=Tr({props:{config:null},emits:["ready"],setup(e,{emit:r}){const{config:n}=e;let t=fn(null);function o(){let{value:a}=t;if(a){let s=a.parentElement;s.removeChild(a);let{width:f,height:v}=s.getBoundingClientRect();a.style.width=Math.min(f,v)+"px",a.style.height=Math.min(f,v)+"px",s.appendChild(a)}}return dn(()=>{if(t.value){o(),window.addEventListener("resize",o);let a=Mt(t.value,n);r("ready",a)}}),pn(()=>{window.removeEventListener("resize",o)}),(a,s)=>(Mr(),xr(vn,{"explicit-height":"",flexbox:""},{nav:Ye(()=>[Rr(a.$slots,"nav",{},void 0,!0)]),default:Ye(()=>[hn("div",{ref_key:"boardEl",ref:t,class:"chessboard"},null,512)]),_:3}))}});var Nt=un(Rt,[["__scopeId","data-v-7122605e"]]);const qt="pnbrqkPNBRQK",Ze="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1",Dt=["1-0","0-1","1/2-1/2","*"],Ve={b:[16,32,17,15],w:[-16,-32,-17,-15]},kr={n:[-18,-33,-31,-14,18,33,31,14],b:[-17,-15,17,15],r:[-16,1,16,-1],q:[-17,-16,-15,1,17,16,15,-1],k:[-17,-16,-15,1,17,16,15,-1]},It=[20,0,0,0,0,0,0,24,0,0,0,0,0,0,20,0,0,20,0,0,0,0,0,24,0,0,0,0,0,20,0,0,0,0,20,0,0,0,0,24,0,0,0,0,20,0,0,0,0,0,0,20,0,0,0,24,0,0,0,20,0,0,0,0,0,0,0,0,20,0,0,24,0,0,20,0,0,0,0,0,0,0,0,0,0,20,2,24,2,20,0,0,0,0,0,0,0,0,0,0,0,2,53,56,53,2,0,0,0,0,0,0,24,24,24,24,24,24,56,0,56,24,24,24,24,24,24,0,0,0,0,0,0,2,53,56,53,2,0,0,0,0,0,0,0,0,0,0,0,20,2,24,2,20,0,0,0,0,0,0,0,0,0,0,20,0,0,24,0,0,20,0,0,0,0,0,0,0,0,20,0,0,0,24,0,0,0,20,0,0,0,0,0,0,20,0,0,0,0,24,0,0,0,0,20,0,0,0,0,20,0,0,0,0,0,24,0,0,0,0,0,20,0,0,20,0,0,0,0,0,0,24,0,0,0,0,0,0,20],Lt=[17,0,0,0,0,0,0,16,0,0,0,0,0,0,15,0,0,17,0,0,0,0,0,16,0,0,0,0,0,15,0,0,0,0,17,0,0,0,0,16,0,0,0,0,15,0,0,0,0,0,0,17,0,0,0,16,0,0,0,15,0,0,0,0,0,0,0,0,17,0,0,16,0,0,15,0,0,0,0,0,0,0,0,0,0,17,0,16,0,15,0,0,0,0,0,0,0,0,0,0,0,0,17,16,15,0,0,0,0,0,0,0,1,1,1,1,1,1,1,0,-1,-1,-1,-1,-1,-1,-1,0,0,0,0,0,0,0,-15,-16,-17,0,0,0,0,0,0,0,0,0,0,0,0,-15,0,-16,0,-17,0,0,0,0,0,0,0,0,0,0,-15,0,0,-16,0,0,-17,0,0,0,0,0,0,0,0,-15,0,0,0,-16,0,0,0,-17,0,0,0,0,0,0,-15,0,0,0,0,-16,0,0,0,0,-17,0,0,0,0,-15,0,0,0,0,0,-16,0,0,0,0,0,-17,0,0,-15,0,0,0,0,0,0,-16,0,0,0,0,0,0,-17],Ot={p:0,n:1,b:2,r:3,q:4,k:5},y={NORMAL:1,CAPTURE:2,BIG_PAWN:4,EP_CAPTURE:8,PROMOTION:16,KSIDE_CASTLE:32,QSIDE_CASTLE:64},Kt=7,$t=6,Bt=1,Ut=0,E={a8:0,b8:1,c8:2,d8:3,e8:4,f8:5,g8:6,h8:7,a7:16,b7:17,c7:18,d7:19,e7:20,f7:21,g7:22,h7:23,a6:32,b6:33,c6:34,d6:35,e6:36,f6:37,g6:38,h6:39,a5:48,b5:49,c5:50,d5:51,e5:52,f5:53,g5:54,h5:55,a4:64,b4:65,c4:66,d4:67,e4:68,f4:69,g4:70,h4:71,a3:80,b3:81,c3:82,d3:83,e3:84,f3:85,g3:86,h3:87,a2:96,b2:97,c2:98,d2:99,e2:100,f2:101,g2:102,h2:103,a1:112,b1:113,c1:114,d1:115,e1:116,f1:117,g1:118,h1:119},pe={w:[{square:E.a1,flag:y.QSIDE_CASTLE},{square:E.h1,flag:y.KSIDE_CASTLE}],b:[{square:E.a8,flag:y.QSIDE_CASTLE},{square:E.h8,flag:y.KSIDE_CASTLE}]};function Qt(e,r){for(var n=e.from,t=e.to,o=e.piece,a=0,s=0,f=0,v=0,h=r.length;v<h;v++){var b=r[v].from,g=r[v].to,T=r[v].piece;o===T&&n!==b&&t===g&&(a++,ge(n)===ge(b)&&s++,Ie(n)===Ie(b)&&f++)}return a>0?s>0&&f>0?W(n):f>0?W(n).charAt(1):W(n).charAt(0):""}function Wt(e){var r=e.charAt(0);if(r>="a"&&r<="h"){var n=e.match(/[a-h]\d.*[a-h]\d/);return n?void 0:ne}return r=r.toLowerCase(),r==="o"?Me:r}function Ht(){for(var e=`   +------------------------+
`,r=E.a8;r<=E.h1;r++){if(Ie(r)===0&&(e+=" "+"87654321"[ge(r)]+" |"),board[r]==null)e+=" . ";else{var n=board[r].type,t=board[r].color,o=t===oe?n.toUpperCase():n.toLowerCase();e+=" "+o+" "}r+1&136&&(e+=`|
`,r+=8)}return e+=`   +------------------------+
`,e+=`     a  b  c  d  e  f  g  h
`,e}function Pr(e){return e.replace(/=/,"").replace(/[+#]?[?!]*$/,"")}function ge(e){return e>>4}function Ie(e){return e&15}function W(e){var r=Ie(e),n=ge(e);return"abcdefgh".substring(r,r+1)+"87654321".substring(n,n+1)}function qe(e){return e===oe?ve:oe}function Ft(e){return"0123456789".indexOf(e)!==-1}function cn(e){var r=e instanceof Array?[]:{};for(var n in e)typeof n=="object"?r[n]=cn(e[n]):r[n]=e[n];return r}function Er(e){return e.replace(/^\s+|\s+$/g,"")}const ve="b",oe="w",J=-1,ne="p",Ar="n",Be="b",zt="r",jt="q",Me="k",Gt=function(){for(var e=[],r=E.a8;r<=E.h1;r++){if(r&136){r+=7;continue}e.push(W(r))}return e}(),Zt={NORMAL:"n",CAPTURE:"c",BIG_PAWN:"b",EP_CAPTURE:"e",PROMOTION:"p",KSIDE_CASTLE:"k",QSIDE_CASTLE:"q"},Vt=function(e){var r=new Array(128),n={w:J,b:J},t=oe,o={w:0,b:0},a=J,s=0,f=1,v=[],h={},b={};w(typeof e=="undefined"?Ze:e);function g(i){typeof i=="undefined"&&(i=!1),r=new Array(128),n={w:J,b:J},t=oe,o={w:0,b:0},a=J,s=0,f=1,v=[],i||(h={}),b={},L(D())}function T(){for(var i=[],l={},c=function(u){u in b&&(l[u]=b[u])};v.length>0;)i.push(ue());for(c(D());i.length>0;)ie(i.pop()),c(D());b=l}function q(){w(Ze)}function w(i,l){typeof l=="undefined"&&(l=!1);var c=i.split(/\s+/),u=c[0],d=0;if(!S(i).valid)return!1;g(l);for(var p=0;p<u.length;p++){var m=u.charAt(p);if(m==="/")d+=8;else if(Ft(m))d+=parseInt(m,10);else{var C=m<"a"?oe:ve;Pe({type:m.toLowerCase(),color:C},W(d)),d++}}return t=c[1],c[2].indexOf("K")>-1&&(o.w|=y.KSIDE_CASTLE),c[2].indexOf("Q")>-1&&(o.w|=y.QSIDE_CASTLE),c[2].indexOf("k")>-1&&(o.b|=y.KSIDE_CASTLE),c[2].indexOf("q")>-1&&(o.b|=y.QSIDE_CASTLE),a=c[3]==="-"?J:E[c[3]],s=parseInt(c[4],10),f=parseInt(c[5],10),L(D()),!0}function S(i){var l={0:"No errors.",1:"FEN string must contain six space-delimited fields.",2:"6th field (move number) must be a positive integer.",3:"5th field (half move counter) must be a non-negative integer.",4:"4th field (en-passant square) is invalid.",5:"3rd field (castling availability) is invalid.",6:"2nd field (side to move) is invalid.",7:"1st field (piece positions) does not contain 8 '/'-delimited rows.",8:"1st field (piece positions) is invalid [consecutive numbers].",9:"1st field (piece positions) is invalid [invalid piece].",10:"1st field (piece positions) is invalid [row too large].",11:"Illegal en-passant square"},c=i.split(/\s+/);if(c.length!==6)return{valid:!1,error_number:1,error:l[1]};if(isNaN(c[5])||parseInt(c[5],10)<=0)return{valid:!1,error_number:2,error:l[2]};if(isNaN(c[4])||parseInt(c[4],10)<0)return{valid:!1,error_number:3,error:l[3]};if(!/^(-|[abcdefgh][36])$/.test(c[3]))return{valid:!1,error_number:4,error:l[4]};if(!/^(KQ?k?q?|Qk?q?|kq?|q|-)$/.test(c[2]))return{valid:!1,error_number:5,error:l[5]};if(!/^(w|b)$/.test(c[1]))return{valid:!1,error_number:6,error:l[6]};var u=c[0].split("/");if(u.length!==8)return{valid:!1,error_number:7,error:l[7]};for(var d=0;d<u.length;d++){for(var p=0,m=!1,C=0;C<u[d].length;C++)if(isNaN(u[d][C])){if(!/^[prnbqkPRNBQK]$/.test(u[d][C]))return{valid:!1,error_number:9,error:l[9]};p+=1,m=!1}else{if(m)return{valid:!1,error_number:8,error:l[8]};p+=parseInt(u[d][C],10),m=!0}if(p!==8)return{valid:!1,error_number:10,error:l[10]}}return c[3][1]=="3"&&c[1]=="w"||c[3][1]=="6"&&c[1]=="b"?{valid:!1,error_number:11,error:l[11]}:{valid:!0,error_number:0,error:l[0]}}function D(){for(var i=0,l="",c=E.a8;c<=E.h1;c++){if(r[c]==null)i++;else{i>0&&(l+=i,i=0);var u=r[c].color,d=r[c].type;l+=u===oe?d.toUpperCase():d.toLowerCase()}c+1&136&&(i>0&&(l+=i),c!==E.h1&&(l+="/"),i=0,c+=8)}var p="";o[oe]&y.KSIDE_CASTLE&&(p+="K"),o[oe]&y.QSIDE_CASTLE&&(p+="Q"),o[ve]&y.KSIDE_CASTLE&&(p+="k"),o[ve]&y.QSIDE_CASTLE&&(p+="q"),p=p||"-";var m=a===J?"-":W(a);return[l,t,p,m,s,f].join(" ")}function re(i){for(var l=0;l<i.length;l+=2)typeof i[l]=="string"&&typeof i[l+1]=="string"&&(h[i[l]]=i[l+1]);return h}function L(i){v.length>0||(i!==Ze?(h.SetUp="1",h.FEN=i):(delete h.SetUp,delete h.FEN))}function ce(i){var l=r[E[i]];return l?{type:l.type,color:l.color}:null}function Pe(i,l){if(!("type"in i&&"color"in i)||qt.indexOf(i.type.toLowerCase())===-1||!(l in E))return!1;var c=E[l];return i.type==Me&&!(n[i.color]==J||n[i.color]==c)?!1:(r[c]={type:i.type,color:i.color},i.type===Me&&(n[i.color]=c),L(D()),!0)}function G(i){var l=ce(i);return r[E[i]]=null,l&&l.type===Me&&(n[l.color]=J),L(D()),l}function Ee(i,l,c,u,d){var p={color:t,from:l,to:c,flags:u,piece:i[l].type};return d&&(p.flags|=y.PROMOTION,p.promotion=d),i[c]?p.captured=i[c].type:u&y.EP_CAPTURE&&(p.captured=ne),p}function K(i){function l(Ae,R,Q,fe,xe){if(Ae[Q].type===ne&&(ge(fe)===Ut||ge(fe)===Kt))for(var Te=[jt,zt,Be,Ar],ye=0,Ke=Te.length;ye<Ke;ye++)R.push(Ee(Ae,Q,fe,xe,Te[ye]));else R.push(Ee(Ae,Q,fe,xe))}var c=[],u=t,d=qe(u),p={b:Bt,w:$t},m=E.a8,C=E.h1,A=!1,I=typeof i!="undefined"&&"legal"in i?i.legal:!0,x=typeof i!="undefined"&&"piece"in i&&typeof i.piece=="string"?i.piece.toLowerCase():!0;if(typeof i!="undefined"&&"square"in i)if(i.square in E)m=C=E[i.square],A=!0;else return[];for(var _=m;_<=C;_++){if(_&136){_+=7;continue}var B=r[_];if(!(B==null||B.color!==u)){if(B.type===ne&&(x===!0||x===ne)){var k=_+Ve[u][0];if(r[k]==null){l(r,c,_,k,y.NORMAL);var k=_+Ve[u][1];p[u]===ge(_)&&r[k]==null&&l(r,c,_,k,y.BIG_PAWN)}for(P=2;P<4;P++){var k=_+Ve[u][P];k&136||(r[k]!=null&&r[k].color===d?l(r,c,_,k,y.CAPTURE):k===a&&l(r,c,_,a,y.EP_CAPTURE))}}else if(x===!0||x===B.type)for(var P=0,Y=kr[B.type].length;P<Y;P++)for(var O=kr[B.type][P],k=_;k+=O,!(k&136);){if(r[k]==null)l(r,c,_,k,y.NORMAL);else{if(r[k].color===u)break;l(r,c,_,k,y.CAPTURE);break}if(B.type==="n"||B.type==="k")break}}}if((x===!0||x===Me)&&(!A||C===n[u])){if(o[u]&y.KSIDE_CASTLE){var j=n[u],X=j+2;r[j+1]==null&&r[X]==null&&!z(d,n[u])&&!z(d,j+1)&&!z(d,X)&&l(r,c,n[u],X,y.KSIDE_CASTLE)}if(o[u]&y.QSIDE_CASTLE){var j=n[u],X=j-2;r[j-1]==null&&r[j-2]==null&&r[j-3]==null&&!z(d,n[u])&&!z(d,j-1)&&!z(d,X)&&l(r,c,n[u],X,y.QSIDE_CASTLE)}}if(!I)return c;for(var ae=[],_=0,Y=c.length;_<Y;_++)ie(c[_]),U(u)||ae.push(c[_]),ue();return ae}function M(i,l){var c="";if(i.flags&y.KSIDE_CASTLE)c="O-O";else if(i.flags&y.QSIDE_CASTLE)c="O-O-O";else{if(i.piece!==ne){var u=Qt(i,l);c+=i.piece.toUpperCase()+u}i.flags&(y.CAPTURE|y.EP_CAPTURE)&&(i.piece===ne&&(c+=W(i.from)[0]),c+="x"),c+=W(i.to),i.flags&y.PROMOTION&&(c+="="+i.promotion.toUpperCase())}return ie(i),$()&&(se()?c+="#":c+="+"),ue(),c}function z(i,l){for(var c=E.a8;c<=E.h1;c++){if(c&136){c+=7;continue}if(!(r[c]==null||r[c].color!==i)){var u=r[c],d=c-l,p=d+119;if(It[p]&1<<Ot[u.type]){if(u.type===ne){if(d>0){if(u.color===oe)return!0}else if(u.color===ve)return!0;continue}if(u.type==="n"||u.type==="k")return!0;for(var m=Lt[p],C=c+m,A=!1;C!==l;){if(r[C]!=null){A=!0;break}C+=m}if(!A)return!0}}}return!1}function U(i){return z(qe(i),n[i])}function $(){return U(t)}function se(){return $()&&K().length===0}function We(){return!$()&&K().length===0}function He(){for(var i={},l=[],c=0,u=0,d=E.a8;d<=E.h1;d++){if(u=(u+1)%2,d&136){d+=7;continue}var p=r[d];p&&(i[p.type]=p.type in i?i[p.type]+1:1,p.type===Be&&l.push(u),c++)}if(c===2)return!0;if(c===3&&(i[Be]===1||i[Ar]===1))return!0;if(c===i[Be]+2){for(var m=0,C=l.length,d=0;d<C;d++)m+=l[d];if(m===0||m===C)return!0}return!1}function Fe(){for(var i=[],l={},c=!1;;){var u=ue();if(!u)break;i.push(u)}for(;;){var d=D().split(" ").slice(0,4).join(" ");if(l[d]=d in l?l[d]+1:1,l[d]>=3&&(c=!0),!i.length)break;ie(i.pop())}return c}function sn(i){v.push({move:i,kings:{b:n.b,w:n.w},turn:t,castling:{b:o.b,w:o.w},ep_square:a,half_moves:s,move_number:f})}function ie(i){var l=t,c=qe(l);if(sn(i),r[i.to]=r[i.from],r[i.from]=null,i.flags&y.EP_CAPTURE&&(t===ve?r[i.to-16]=null:r[i.to+16]=null),i.flags&y.PROMOTION&&(r[i.to]={type:i.promotion,color:l}),r[i.to].type===Me){if(n[r[i.to].color]=i.to,i.flags&y.KSIDE_CASTLE){var u=i.to-1,d=i.to+1;r[u]=r[d],r[d]=null}else if(i.flags&y.QSIDE_CASTLE){var u=i.to+1,d=i.to-2;r[u]=r[d],r[d]=null}o[l]=""}if(o[l]){for(var p=0,m=pe[l].length;p<m;p++)if(i.from===pe[l][p].square&&o[l]&pe[l][p].flag){o[l]^=pe[l][p].flag;break}}if(o[c]){for(var p=0,m=pe[c].length;p<m;p++)if(i.to===pe[c][p].square&&o[c]&pe[c][p].flag){o[c]^=pe[c][p].flag;break}}i.flags&y.BIG_PAWN?t==="b"?a=i.to-16:a=i.to+16:a=J,i.piece===ne||i.flags&(y.CAPTURE|y.EP_CAPTURE)?s=0:s++,t===ve&&f++,t=qe(t)}function ue(){var i=v.pop();if(i==null)return null;var l=i.move;n=i.kings,t=i.turn,o=i.castling,a=i.ep_square,s=i.half_moves,f=i.move_number;var c=t,u=qe(t);if(r[l.from]=r[l.to],r[l.from].type=l.piece,r[l.to]=null,l.flags&y.CAPTURE)r[l.to]={type:l.captured,color:u};else if(l.flags&y.EP_CAPTURE){var d;c===ve?d=l.to-16:d=l.to+16,r[d]={type:ne,color:u}}if(l.flags&(y.KSIDE_CASTLE|y.QSIDE_CASTLE)){var p,m;l.flags&y.KSIDE_CASTLE?(p=l.to+1,m=l.to-1):l.flags&y.QSIDE_CASTLE&&(p=l.to-2,m=l.to+1),r[p]=r[m],r[m]=null}return l}function dr(i,l){var c=Pr(i),u=!1;if(l){var d=c.match(/([pnbrqkPNBRQK])?([a-h][1-8])x?-?([a-h][1-8])([qrbnQRBN])?/);if(d){var p=d[1],m=d[2],C=d[3],A=d[4];m.length==1&&(u=!0)}else{var d=c.match(/([pnbrqkPNBRQK])?([a-h]?[1-8]?)x?-?([a-h][1-8])([qrbnQRBN])?/);if(d){var p=d[1],m=d[2],C=d[3],A=d[4];if(m.length==1)var u=!0}}}for(var I=Wt(c),x=K({legal:!0,piece:p||I}),_=0,B=x.length;_<B;_++){if(c===Pr(M(x[_],x)))return x[_];if(l&&d){if((!p||p.toLowerCase()==x[_].piece)&&E[m]==x[_].from&&E[C]==x[_].to&&(!A||A.toLowerCase()==x[_].promotion))return x[_];if(u){var k=W(x[_].from);if((!p||p.toLowerCase()==x[_].piece)&&E[C]==x[_].to&&(m==k[0]||m==k[1])&&(!A||A.toLowerCase()==x[_].promotion))return x[_]}}}return null}function Oe(i){var l=cn(i);l.san=M(l,K({legal:!0})),l.to=W(l.to),l.from=W(l.from);var c="";for(var u in y)y[u]&l.flags&&(c+=Zt[u]);return l.flags=c,l}function pr(i){for(var l=K({legal:!1}),c=0,u=t,d=0,p=l.length;d<p;d++){if(ie(l[d]),!U(u))if(i-1>0){var m=pr(i-1);c+=m}else c++;ue()}return c}return{load:function(i){return w(i)},reset:function(){return q()},moves:function(i){for(var l=K(i),c=[],u=0,d=l.length;u<d;u++)typeof i!="undefined"&&"verbose"in i&&i.verbose?c.push(Oe(l[u])):c.push(M(l[u],K({legal:!0})));return c},in_check:function(){return $()},in_checkmate:function(){return se()},in_stalemate:function(){return We()},in_draw:function(){return s>=100||We()||He()||Fe()},insufficient_material:function(){return He()},in_threefold_repetition:function(){return Fe()},game_over:function(){return s>=100||se()||We()||He()||Fe()},validate_fen:function(i){return S(i)},fen:function(){return D()},board:function(){for(var i=[],l=[],c=E.a8;c<=E.h1;c++)r[c]==null?l.push(null):l.push({square:W(c),type:r[c].type,color:r[c].color}),c+1&136&&(i.push(l),l=[],c+=8);return i},pgn:function(i){var l=typeof i=="object"&&typeof i.newline_char=="string"?i.newline_char:`
`,c=typeof i=="object"&&typeof i.max_width=="number"?i.max_width:0,u=[],d=!1;for(var p in h)u.push("["+p+' "'+h[p]+'"]'+l),d=!0;d&&v.length&&u.push(l);for(var m=function(P){var Y=b[D()];if(typeof Y!="undefined"){var O=P.length>0?" ":"";P=`${P}${O}{${Y}}`}return P},C=[];v.length>0;)C.push(ue());var A=[],I="";for(C.length===0&&A.push(m(""));C.length>0;){I=m(I);var x=C.pop();!v.length&&x.color==="b"?I=f+". ...":x.color==="w"&&(I.length&&A.push(I),I=f+"."),I=I+" "+M(x,K({legal:!0})),ie(x)}if(I.length&&A.push(m(I)),typeof h.Result!="undefined"&&A.push(h.Result),c===0)return u.join("")+A.join(" ");for(var _=function(){return u.length>0&&u[u.length-1]===" "?(u.pop(),!0):!1},B=function(P,Y){for(var O of Y.split(" "))if(!!O){if(P+O.length>c){for(;_();)P--;u.push(l),P=0}u.push(O),P+=O.length,u.push(" "),P++}return _()&&P--,P},k=0,p=0;p<A.length;p++){if(k+A[p].length>c&&A[p].includes("{")){k=B(k,A[p]);continue}k+A[p].length>c&&p!==0?(u[u.length-1]===" "&&u.pop(),u.push(l),k=0):p!==0&&(u.push(" "),k++),u.push(A[p]),k+=A[p].length}return u.join("")},load_pgn:function(i,l){var c=typeof l!="undefined"&&"sloppy"in l?l.sloppy:!1;function u(R){return R.replace(/\\/g,"\\")}function d(R,Q){for(var fe=typeof Q=="object"&&typeof Q.newline_char=="string"?Q.newline_char:`\r?
`,xe={},Te=R.split(new RegExp(u(fe))),ye="",Ke="",$e=0;$e<Te.length;$e++)ye=Te[$e].replace(/^\[([A-Z][A-Za-z]*)\s.*\]$/,"$1"),Ke=Te[$e].replace(/^\[[A-Za-z]+\s"(.*)"\ *\]$/,"$1"),Er(ye).length>0&&(xe[ye]=Ke);return xe}var p=typeof l=="object"&&typeof l.newline_char=="string"?l.newline_char:`\r?
`,m=new RegExp("^(\\[((?:"+u(p)+")|.)*\\])(?:"+u(p)+"){2}"),C=m.test(i)?m.exec(i)[1]:"";q();var A=d(C,l);for(var I in A)re([I,A[I]]);if(A.SetUp==="1"&&!("FEN"in A&&w(A.FEN,!0)))return!1;for(var x=function(R){return Array.from(R).map(function(Q){return Q.charCodeAt(0)<128?Q.charCodeAt(0).toString(16):encodeURIComponent(Q).replace(/\%/g,"").toLowerCase()}).join("")},_=function(R){return R.length==0?"":decodeURIComponent("%"+R.match(/.{1,2}/g).join("%"))},B=function(R){return R=R.replace(new RegExp(u(p),"g")," "),`{${x(R.slice(1,R.length-1))}}`},k=function(R){if(R.startsWith("{")&&R.endsWith("}"))return _(R.slice(1,R.length-1))},P=i.replace(C,"").replace(new RegExp(`({[^}]*})+?|;([^${u(p)}]*)`,"g"),function(R,Q,fe){return Q!==void 0?B(Q):" "+B(`{${fe.slice(1)}}`)}).replace(new RegExp(u(p),"g")," "),Y=/(\([^\(\)]+\))+?/g;Y.test(P);)P=P.replace(Y,"");P=P.replace(/\d+\.(\.\.)?/g,""),P=P.replace(/\.\.\./g,""),P=P.replace(/\$\d+/g,"");var O=Er(P).split(new RegExp(/\s+/));O=O.join(",").replace(/,,+/g,",").split(",");for(var j="",X="",ae=0;ae<O.length;ae++){var Ae=k(O[ae]);if(Ae!==void 0){b[D()]=Ae;continue}if(j=dr(O[ae],c),j==null)if(Dt.indexOf(O[ae])>-1)X=O[ae];else return!1;else X="",ie(j)}return X&&Object.keys(h).length&&!h.Result&&re(["Result",X]),!0},header:function(){return re(arguments)},ascii:function(){return Ht()},turn:function(){return t},move:function(i,l){var c=typeof l!="undefined"&&"sloppy"in l?l.sloppy:!1,u=null;if(typeof i=="string")u=dr(i,c);else if(typeof i=="object"){for(var d=K(),p=0,m=d.length;p<m;p++)if(i.from===W(d[p].from)&&i.to===W(d[p].to)&&(!("promotion"in d[p])||i.promotion===d[p].promotion)){u=d[p];break}}if(!u)return null;var C=Oe(u);return ie(u),C},undo:function(){var i=ue();return i?Oe(i):null},clear:function(){return g()},put:function(i,l){return Pe(i,l)},get:function(i){return ce(i)},remove:function(i){return G(i)},perft:function(i){return pr(i)},square_color:function(i){if(i in E){var l=E[i];return(ge(l)+Ie(l))%2===0?"light":"dark"}return null},history:function(i){for(var l=[],c=[],u=typeof i!="undefined"&&("verbose"in i)&&i.verbose;v.length>0;)l.push(ue());for(;l.length>0;){var d=l.pop();u?c.push(Oe(d)):c.push(M(d,K({legal:!0}))),ie(d)}return c},get_comment:function(){return b[D()]},set_comment:function(i){b[D()]=i.replace("{","[").replace("}","]")},delete_comment:function(){var i=b[D()];return delete b[D()],i},get_comments:function(){return T(),Object.keys(b).map(function(i){return{fen:i,comment:b[i]}})},delete_comments:function(){return T(),Object.keys(b).map(function(i){var l=b[i];return delete b[i],{fen:i,comment:l}})}}},Xt=Tr({props:{position:null,orientation:null,destinations:null},emits:["ready","move"],setup(e,{emit:r}){const{position:n,orientation:t="white",destinations:o}=e;async function a(g,T){if(g=="a0"||T=="a0"||!s)return;if(o){let S=s.state.pieces.get(g);S&&(s.state.pieces.delete(g),s.state.pieces.set(T,S)),f.load(`${s.getFen()} ${f.turn()=="w"?"b":"w"} - - 0 1`)}else f.move({from:g,to:T,promotion:"q"},{sloppy:!0});s.set({turnColor:f.turn()==="w"?"white":"black",fen:f.fen(),check:f.in_check(),lastMove:[g,T],movable:{color:f.turn()==="w"?"white":"black",dests:new Map}});let q;r("move",S=>q=S,f,s);let w=await q;w?setTimeout(()=>a(w.from,w.to)):s.set({movable:{dests:h()}})}let s,f=Vt(n),v={fen:f.fen().split(" ")[0],orientation:t,premovable:{enabled:!1},turnColor:f.turn()==="w"?"white":"black",movable:{free:!1,color:f.turn()==="w"?"white":"black",dests:new Map,events:{after:a}}};function h(){if(o)return o(f);let g=new Map;for(let T of Gt){let q=f.moves({square:T,verbose:!0});q.length&&g.set(T,q.map(({to:w})=>w))}return g}async function b(g){s=g,r("ready",s,f);let T;r("move",w=>T=w,f,s);let q=await T;q?setTimeout(()=>a(q.from,q.to)):s.set({turnColor:f.turn()==="w"?"white":"black",check:f.in_check(),movable:{color:f.turn()==="w"?"white":"black",dests:h()}})}return(g,T)=>(Mr(),xr(Nt,{config:gn(v),onReady:b},{nav:Ye(()=>[Rr(g.$slots,"nav")]),_:3},8,["config"]))}});export{Gt as S,Xt as _};
